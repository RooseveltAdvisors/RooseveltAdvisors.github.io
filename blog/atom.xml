<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="atom.xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://jonroosevelt.com/blog</id>
    <title>Jon Roosevelt Blog</title>
    <updated>2026-01-25T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://jonroosevelt.com/blog"/>
    <subtitle>Jon Roosevelt Blog</subtitle>
    <icon>https://jonroosevelt.com/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[How AI Transformed My Second Brain from Passive to Active]]></title>
        <id>https://jonroosevelt.com/blog/2026/01/25/ai-second-brain</id>
        <link href="https://jonroosevelt.com/blog/2026/01/25/ai-second-brain"/>
        <updated>2026-01-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Discover how AI turned my Obsidian vault from a passive archive into an active thinking partner through explicit thinking modes, mobile deep work, and fuzzy interface philosophy.]]></summary>
        <content type="html"><![CDATA[<p>For years, I maintained what Tiago Forte calls a "second brain" - a carefully organized Obsidian vault using the PARA method (Projects, Areas, Resources, Archives). I captured meeting notes, research findings, and fleeting thoughts. I tagged everything meticulously. I created bidirectional links between related concepts.</p>
<p>And yet, for all this effort, my second brain remained fundamentally passive. It was a graveyard of good intentions - a place where ideas went to be buried, not born.</p>
<p>Then AI changed everything. Not by replacing my system, but by becoming the thinking partner that transformed my archive into an active workspace for thought. Here's how.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem-with-passive-knowledge-management">The Problem with Passive Knowledge Management<a href="https://jonroosevelt.com/blog/2026/01/25/ai-second-brain#the-problem-with-passive-knowledge-management" class="hash-link" aria-label="Direct link to The Problem with Passive Knowledge Management" title="Direct link to The Problem with Passive Knowledge Management">​</a></h2>
<p>Traditional second brain systems excel at capture and retrieval. You save information, organize it, and resurface it when needed. This works brilliantly for reference material - that API documentation you need occasionally, or your preferred stack overflow answers.</p>
<p>But passive systems fail at the most important work: thinking. When you're wrestling with a complex problem, you don't just need to retrieve facts. You need a partner who can help you:</p>
<ul>
<li>Synthesize scattered observations into coherent insights</li>
<li>Challenge assumptions you didn't realize you were making</li>
<li>Connect ideas across different domains</li>
<li>Articulate vague intuitions into clear frameworks</li>
</ul>
<p>This is where AI becomes transformative - not as a tool, but as a collaborator that meets you where you are.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="thinking-mode-vs-writing-mode">Thinking Mode vs Writing Mode<a href="https://jonroosevelt.com/blog/2026/01/25/ai-second-brain#thinking-mode-vs-writing-mode" class="hash-link" aria-label="Direct link to Thinking Mode vs Writing Mode" title="Direct link to Thinking Mode vs Writing Mode">​</a></h2>
<p>The single most important distinction I've discovered is explicitly separating <strong>Thinking Mode</strong> from <strong>Writing Mode</strong> when working with AI.</p>
<p>In <strong>Thinking Mode</strong>, the goal is exploration and synthesis. I give Claude access to my entire vault from the root directory and say: "We're in thinking mode - help me understand X, but don't create any artifacts yet." This prevents the AI from prematurely jumping to polished outputs when I'm still figuring out what I actually believe.</p>
<p>The conversation becomes genuinely exploratory. I can share half-formed thoughts, contradictory observations, or tentative connections. The AI helps me see patterns I missed, identifies gaps in my reasoning, and asks questions that push my thinking forward. No pressure to produce anything - just thinking together.</p>
<p><strong>Writing Mode</strong> comes later, after the thinking is done. Only then do I ask for structured outputs - blog posts, documentation, presentations, or code. By this point, the content practically writes itself because the hard work of thinking has already happened.</p>
<p>This distinction sounds simple, but it's profound. Before I made this explicit, AI sessions felt rushed and superficial. Now they feel like genuine intellectual partnership.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-fuzzy-interface-philosophy">The Fuzzy Interface Philosophy<a href="https://jonroosevelt.com/blog/2026/01/25/ai-second-brain#the-fuzzy-interface-philosophy" class="hash-link" aria-label="Direct link to The Fuzzy Interface Philosophy" title="Direct link to The Fuzzy Interface Philosophy">​</a></h2>
<p>One reason this works so well is what I call the "fuzzy interface" - AI adapts to whatever workflow you already have, rather than forcing you into rigid structures.</p>
<p>My Obsidian vault isn't perfectly organized. I have notes scattered across projects, areas, and resources. Some are polished, some are fragments. The linking is inconsistent. There are typos and half-finished thoughts everywhere.</p>
<p>And that's fine. AI doesn't need pristine inputs. It thrives on messy, organic knowledge graphs because it can find connections and patterns regardless of how well you've organized things.</p>
<p>This means you can start getting value immediately, without first spending months perfecting your system. The AI meets you where you are - whether you're using Obsidian, Notion, plain text files, or even just a directory of unorganized PDFs.</p>
<p>The fuzzy interface also extends to conversation style. Sometimes I write formal queries. Sometimes I paste raw notes with minimal context. Sometimes I just say "I'm confused about X" and let the conversation unfold naturally. All of these work because the AI adapts to your communication style rather than requiring you to learn its syntax.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="daily-progress-summaries">Daily Progress Summaries<a href="https://jonroosevelt.com/blog/2026/01/25/ai-second-brain#daily-progress-summaries" class="hash-link" aria-label="Direct link to Daily Progress Summaries" title="Direct link to Daily Progress Summaries">​</a></h2>
<p>One of my favorite workflows is ending each day by asking AI to synthesize what I learned. I'll share the day's meeting notes, research findings, and scattered observations, then ask: "What are the key insights here? What patterns do you see? What should I think about tomorrow?"</p>
<p>The AI acts as a mirror that reflects back the signal hidden in the noise. Often I discover I learned something important that I didn't consciously recognize. Or I see how three separate conversations were actually circling the same core problem.</p>
<p>These daily summaries compound over time. They become a running narrative of your intellectual journey - not just what you learned, but how your thinking evolved. Looking back over weeks or months of summaries reveals meta-patterns about your interests, blind spots, and growth areas.</p>
<p>This is active knowledge management. Not just capturing information, but continuously synthesizing it into actionable insight.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mobile-deep-work-the-underappreciated-revolution">Mobile Deep Work: The Underappreciated Revolution<a href="https://jonroosevelt.com/blog/2026/01/25/ai-second-brain#mobile-deep-work-the-underappreciated-revolution" class="hash-link" aria-label="Direct link to Mobile Deep Work: The Underappreciated Revolution" title="Direct link to Mobile Deep Work: The Underappreciated Revolution">​</a></h2>
<p>Perhaps the most transformative change has been using voice AI for research during otherwise "wasted" time - primarily my daily commute and exercise routines.</p>
<p>I regularly have 2-hour voice sessions with Claude while driving. I can't type, I can't take notes, I can't even look at a screen. But I can think out loud, ask questions, hear synthesized responses, and develop complex ideas through conversation.</p>
<p>This enables genuine deep work on mobile in a way that was previously impossible. Before voice AI, commute time was for podcasts or music - passive consumption. Now it's prime thinking time.</p>
<p>The key is trusting that you don't need to capture every word. The conversation itself does the work of clarifying your thinking. Later, when you're back at your computer, you can ask the AI to help you reconstruct and formalize what you discovered.</p>
<p>This mobile deep work capability is radically underappreciated in discussions about AI tools. Everyone focuses on coding assistants and writing tools - desktop use cases. But the ability to engage in substantive intellectual work while walking, driving, or exercising might be the bigger productivity unlock for knowledge workers.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-para">Integration with PARA<a href="https://jonroosevelt.com/blog/2026/01/25/ai-second-brain#integration-with-para" class="hash-link" aria-label="Direct link to Integration with PARA" title="Direct link to Integration with PARA">​</a></h2>
<p>My second brain still uses Tiago Forte's PARA method - Projects, Areas, Resources, Archives - but AI has changed how I interact with it.</p>
<p><strong>Projects</strong> become collaborative workspaces. When starting a new project, I'll share relevant background from my vault and have a thinking mode session to clarify goals, identify risks, and plan next steps. The AI helps me pull together scattered context that would take hours to manually synthesize.</p>
<p><strong>Areas</strong> get regular AI-assisted reviews. Every few weeks, I'll share all my notes on an area of responsibility and ask: "What's changing here? What patterns should I notice? What's being neglected?" This turns areas from static reference material into living, evolving knowledge bases.</p>
<p><strong>Resources</strong> become queryable. Instead of manually searching through saved articles and research, I can ask questions like "What have I learned about database scaling?" and get synthesized answers drawn from across my resources.</p>
<p><strong>Archives</strong> get mined for insights. Old project notes that would otherwise be forgotten become valuable source material. The AI can surface relevant historical context when I'm working on similar problems months or years later.</p>
<p>PARA provides the organizational structure, but AI provides the intelligence layer that makes the structure truly useful.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="starting-your-own-ai-enhanced-second-brain">Starting Your Own AI-Enhanced Second Brain<a href="https://jonroosevelt.com/blog/2026/01/25/ai-second-brain#starting-your-own-ai-enhanced-second-brain" class="hash-link" aria-label="Direct link to Starting Your Own AI-Enhanced Second Brain" title="Direct link to Starting Your Own AI-Enhanced Second Brain">​</a></h2>
<p>If you want to transform your own knowledge management system from passive to active, here are the key principles:</p>
<ol>
<li>
<p><strong>Start from the root</strong> - Give AI access to your entire knowledge base, not just individual files. Context is everything.</p>
</li>
<li>
<p><strong>Separate thinking from writing</strong> - Explicitly declare "thinking mode" when exploring ideas. Only switch to "writing mode" when you're ready for outputs.</p>
</li>
<li>
<p><strong>Embrace messiness</strong> - Don't wait for perfect organization. AI works with whatever you have right now.</p>
</li>
<li>
<p><strong>Daily synthesis</strong> - End each day with a brief session asking AI to identify key learnings and patterns.</p>
</li>
<li>
<p><strong>Use voice for mobile deep work</strong> - Your commute and exercise time can become premium thinking time with voice AI.</p>
</li>
<li>
<p><strong>Ask for context, not just answers</strong> - The goal isn't quick responses, it's deeper understanding through conversation.</p>
</li>
<li>
<p><strong>Review regularly</strong> - Use AI to periodically review entire areas of your knowledge base, identifying trends and gaps you'd otherwise miss.</p>
</li>
</ol>
<p>The shift from passive archive to active thinking partner isn't about adding new tools or complexity. It's about introducing an intelligence layer that helps you actually think with your collected knowledge, rather than just storing it.</p>
<p>Your second brain doesn't need to be bigger. It needs to be more alive. And that's exactly what AI enables.</p>
<hr>
<p><em>What's your experience with AI-enhanced knowledge management? I'd love to hear how you're using AI to think, not just to write. Reach out and let me know what's working for you.</em></p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Productivity" term="Productivity"/>
        <category label="Second Brain" term="Second Brain"/>
        <category label="Knowledge Management" term="Knowledge Management"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The Burden of Being: Why Responsibility Might Be the Antidote to Modern Nihilism]]></title>
        <id>https://jonroosevelt.com/blog/burden-of-being</id>
        <link href="https://jonroosevelt.com/blog/burden-of-being"/>
        <updated>2026-01-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[When someone asks you what makes life meaningful, the reflexive answer is usually something about happiness, fulfillment, or pleasure. But Jordan Peterson argues we're asking the wrong question. The better question isn't "what makes you happy?" It's "what burden are you willing to carry?" This reframing — from happiness-seeking to responsibility-accepting — might be the most important psychological insight of our generation.]]></summary>
        <content type="html"><![CDATA[<p>When someone asks you what makes life meaningful, the reflexive answer is usually something about happiness, fulfillment, or pleasure. But Jordan Peterson argues we're asking the wrong question. The better question isn't "what makes you happy?" It's "what burden are you willing to carry?" This reframing — from happiness-seeking to responsibility-accepting — might be the most important psychological insight of our generation.</p>
<p><img decoding="async" loading="lazy" alt="The burden of being and the search for meaning through responsibility" src="https://jonroosevelt.com/assets/images/hero-banner-eb82018eb308b56ff0833ef9050496d8.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem-with-pursuing-happiness">The Problem with Pursuing Happiness<a href="https://jonroosevelt.com/blog/burden-of-being#the-problem-with-pursuing-happiness" class="hash-link" aria-label="Direct link to The Problem with Pursuing Happiness" title="Direct link to The Problem with Pursuing Happiness">​</a></h2>
<p>Our culture is obsessed with optimization. We optimize our diets, our sleep, our productivity systems, our relationships. The implicit assumption is that if we just get the formula right, we'll achieve some stable state of contentment. But Peterson, drawing on existentialist philosophy and clinical psychology, argues this entire framework is backwards.</p>
<p><strong>"It's in responsibility that most people find the meaning that sustains them through life."</strong></p>
<p>This isn't a moral prescription. It's an empirical observation. When Peterson worked as a clinical psychologist, he noticed that his patients' depression and anxiety didn't correlate with their objective circumstances. People with objectively comfortable lives would be paralyzed by meaninglessness. People enduring significant hardship would demonstrate remarkable resilience. The difference wasn't circumstances — it was whether they felt they were carrying a meaningful burden.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="distress-is-built-into-being">Distress is Built Into Being<a href="https://jonroosevelt.com/blog/burden-of-being#distress-is-built-into-being" class="hash-link" aria-label="Direct link to Distress is Built Into Being" title="Direct link to Distress is Built Into Being">​</a></h2>
<p>The existentialists understood something modern psychology often forgets: consciousness itself is a burden. Self-awareness means you know you'll die. You know you'll fail. You know that entropy increases and everything deteriorates. These aren't cognitive distortions you can therapy away. They're fundamental features of being conscious.</p>
<p>Heidegger called it "thrownness" — you didn't ask to exist, but here you are, thrown into a world you didn't design, forced to make choices without adequate knowledge. Sartre emphasized that freedom itself is a burden because it means you're responsible for what you become. Kierkegaard described the "dizziness of freedom" — the vertigo of realizing you could do anything, which paradoxically makes it harder to do something.</p>
<p>Peterson synthesizes this into a practical framework: <strong>distress is the default state. The question isn't how to eliminate it. It's what you're willing to endure it for.</strong></p>
<p>This is why "self-care" culture often backfires. It operates on the assumption that if you just reduce stressors enough, you'll be okay. But the existential stressors can't be reduced. They're structural features of consciousness. What you need isn't less stress — it's stress in service of something meaningful.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-death-of-god-and-the-meaning-crisis">The Death of God and the Meaning Crisis<a href="https://jonroosevelt.com/blog/burden-of-being#the-death-of-god-and-the-meaning-crisis" class="hash-link" aria-label="Direct link to The Death of God and the Meaning Crisis" title="Direct link to The Death of God and the Meaning Crisis">​</a></h2>
<p>Nietzsche's famous proclamation "God is dead" wasn't celebrating atheism. It was diagnosing a crisis. For thousands of years, religious frameworks provided a pre-packaged answer to the meaning question. Your suffering had purpose because God had a plan. Your responsibilities were clear because they were divinely ordained. Your actions mattered because they had eternal consequences.</p>
<p>When that framework collapsed — not through rational argumentation but through cultural drift — it left a vacuum. Nietzsche saw what was coming: without the religious structure, people would split into two camps. Some would retreat into nihilism, concluding that if there's no God, nothing matters. Others would try to fill the void with political ideologies, eventually leading to totalitarianism.</p>
<p>His solution was radical: if there are no pre-existing values, you have to create your own. The Übermensch isn't a superior person — it's someone who can bear the weight of self-created meaning without collapsing into nihilism or grasping for authoritarian certainty.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dostoevskys-counter-move">Dostoevsky's Counter-Move<a href="https://jonroosevelt.com/blog/burden-of-being#dostoevskys-counter-move" class="hash-link" aria-label="Direct link to Dostoevsky's Counter-Move" title="Direct link to Dostoevsky's Counter-Move">​</a></h2>
<p>Dostoevsky approached the same problem from the opposite direction. In <em>The Brothers Karamazov</em>, he explored whether morality could survive without God. His answer was essentially "no, but the attempt to live as if it could is what makes us human."</p>
<p>The Grand Inquisitor chapter presents the argument in its starkest form: most people don't want freedom. They want security, certainty, and someone to tell them what to do. Christ offers freedom and responsibility. The Inquisitor offers bread and obedience. And the Inquisitor's case is compelling — people demonstrably do prefer comfortable submission to burdensome freedom.</p>
<p>Dostoevsky's characters who abandon God don't become enlightened rationalists. They become monsters (Raskolnikov) or paralyzed intellectuals (Ivan). His implicit argument: you can't derive meaning from pure reason. You need something transcendent, even if you can't rationally justify it.</p>
<p>Peterson's synthesis is to take Dostoevsky's insight about the necessity of transcendent meaning and combine it with Nietzsche's insight about the necessity of self-created values. <strong>You need a transcendent narrative, but you have to choose it voluntarily. It can't be imposed.</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-you-put-up-against-suffering">What You Put Up Against Suffering<a href="https://jonroosevelt.com/blog/burden-of-being#what-you-put-up-against-suffering" class="hash-link" aria-label="Direct link to What You Put Up Against Suffering" title="Direct link to What You Put Up Against Suffering">​</a></h2>
<p><strong>"What you put up against suffering is meaning."</strong></p>
<p>This is Peterson's central claim, and it's worth unpacking carefully. He's not saying suffering is optional if you find the right meaning. Suffering is inevitable. Consciousness guarantees it. The question is whether you meet that suffering with something that makes it bearable.</p>
<p>And the paradox is that meaning doesn't come from reducing suffering — it comes from taking on additional voluntary suffering in service of something you value.</p>
<p>This is the logic of sacrifice that appears across cultures. You give up something in the present for something you value more in the future. The immigrant who works three jobs to put their kids through college isn't delusional. They're not happy in the moment. But they have something to put up against the suffering that makes it meaningful rather than meaningless.</p>
<p>The alternative — optimizing for comfort, avoiding all unnecessary burden, pursuing happiness directly — doesn't lead to happiness. It leads to fragility, because you have no practice bearing weight. When inevitable suffering arrives (death of a loved one, illness, failure), you have no psychological structure to process it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-responsibility-framework">The Responsibility Framework<a href="https://jonroosevelt.com/blog/burden-of-being#the-responsibility-framework" class="hash-link" aria-label="Direct link to The Responsibility Framework" title="Direct link to The Responsibility Framework">​</a></h2>
<p>Peterson's practical framework emerges from this philosophical foundation:</p>
<ol>
<li><strong>Life is suffering</strong> (Buddhist first noble truth, existentialist thrownness)</li>
<li><strong>Meaning is the antidote to suffering</strong> (not happiness, not comfort, not security)</li>
<li><strong>Responsibility is the primary source of meaning</strong> (not pleasure, not status, not achievement)</li>
<li><strong>Therefore: voluntarily accept the largest responsibility you can bear</strong></li>
</ol>
<p>This is why "find your passion" is bad advice. Passion is ephemeral. Responsibility is structural. The question isn't what excites you — it's what burden you're willing to carry.</p>
<p>For the parent, it's the burden of shaping another consciousness. For the entrepreneur, it's the burden of creating value where none existed. For the scientist, it's the burden of incrementally pushing back ignorance. For the soldier, it's the burden of protecting others at potential cost to yourself.</p>
<p>The specific domain doesn't matter. What matters is that you've voluntarily accepted that the burden is yours to carry, and that carrying it well is how you orient yourself in a universe that doesn't care whether you exist.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-individual-responsibility-critique">The Individual Responsibility Critique<a href="https://jonroosevelt.com/blog/burden-of-being#the-individual-responsibility-critique" class="hash-link" aria-label="Direct link to The Individual Responsibility Critique" title="Direct link to The Individual Responsibility Critique">​</a></h2>
<p>But here's where the critique becomes important: Peterson's emphasis on individual responsibility can veer into what sociologists call "atomistic individualism" — the idea that all outcomes are purely the result of individual choices, ignoring structural constraints.</p>
<p>This is the danger in statements like "clean your room before you criticize the world." It can be interpreted as: all problems are ultimately individual character problems. If you're poor, it's because you're not responsible enough. If you're depressed, it's because you haven't accepted enough responsibility. If you're oppressed, it's because you haven't stood up for yourself sufficiently.</p>
<p>This isn't just philosophically suspect — it's psychologically damaging. It converts structural problems into personal failings. The person born into generational poverty doesn't have the same capacity to "bear responsibility" as someone with inherited wealth and social capital. Telling them their suffering is because they haven't taken on enough responsibility is adding moral injury to material deprivation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-balance-individual-and-collective">The Balance: Individual and Collective<a href="https://jonroosevelt.com/blog/burden-of-being#the-balance-individual-and-collective" class="hash-link" aria-label="Direct link to The Balance: Individual and Collective" title="Direct link to The Balance: Individual and Collective">​</a></h2>
<p>The corrective isn't to abandon individual responsibility. It's to recognize that responsibility operates at multiple scales simultaneously.</p>
<p>You're responsible for how you respond to your circumstances — but you're not responsible for the circumstances themselves. You're responsible for developing your capabilities — but you're not responsible for the initial distribution of capability. You're responsible for making the best of your situation — but that doesn't mean the situation itself is just.</p>
<p>The existentialists understood this better than Peterson sometimes gives them credit for. Sartre's concept of "being-in-situation" captures it: you're free, but your freedom is always situated within constraints you didn't choose. Your responsibility is to your freedom within those constraints, not to the constraints themselves.</p>
<p>And crucially: part of taking responsibility for your own life can mean working to change structural conditions that make responsibility harder for others. The immigrant who works to give their children opportunities is taking individual responsibility. The civil rights activist who works to remove barriers so others can take responsibility for their lives is doing the same thing at a different scale.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-responsibility-actually-looks-like">What Responsibility Actually Looks Like<a href="https://jonroosevelt.com/blog/burden-of-being#what-responsibility-actually-looks-like" class="hash-link" aria-label="Direct link to What Responsibility Actually Looks Like" title="Direct link to What Responsibility Actually Looks Like">​</a></h2>
<p>In practice, taking on responsibility doesn't mean becoming a martyr or a workaholic. It means making a choice about what you're willing to be responsible for, and then structuring your life around that choice.</p>
<p>For some people, it's raising children well. For others, it's building a business that employs people. For others, it's teaching, or healing, or creating art that shifts how people see the world. The specific form doesn't matter. What matters is that you've made a commitment and you honor it even when it's difficult.</p>
<p>This is different from ambition. Ambition is "I want to achieve X." Responsibility is "I'm willing to carry the burden of Y." Ambition focuses on outcomes. Responsibility focuses on process and commitment.</p>
<p>And here's what Peterson gets right: the people who seem most resilient, most psychologically integrated, most capable of weathering hardship — they're not the ones with the easiest lives. They're the ones who've found something they consider worth suffering for.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-practical-test">The Practical Test<a href="https://jonroosevelt.com/blog/burden-of-being#the-practical-test" class="hash-link" aria-label="Direct link to The Practical Test" title="Direct link to The Practical Test">​</a></h2>
<p>How do you know if you've found a meaningful responsibility? Peterson suggests a simple test: <strong>Does thinking about it make your life feel heavier or lighter?</strong></p>
<p>If the thought of your responsibility makes your life feel oppressively heavy, you're probably carrying the wrong burden, or carrying it badly, or it wasn't actually voluntary. This is suffering, not sacrifice.</p>
<p>If the thought of your responsibility makes your life feel purposefully heavy — like you're carrying something difficult but worthwhile — that's meaningful burden. The weight is real, but it's not oppressive.</p>
<p>And counterintuitively, accepting that weight often makes life feel lighter overall, because you stop wasting energy avoiding it or resenting it or pretending it doesn't exist.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="where-this-leaves-us">Where This Leaves Us<a href="https://jonroosevelt.com/blog/burden-of-being#where-this-leaves-us" class="hash-link" aria-label="Direct link to Where This Leaves Us" title="Direct link to Where This Leaves Us">​</a></h2>
<p>Modern culture's answer to the meaning crisis has largely been to deny there's a problem. We're told to pursue happiness, optimize our lives, practice self-care, manifest our desires. These aren't wrong exactly — they're just insufficient. They don't address the fundamental existential problem: consciousness itself is burdensome, suffering is inevitable, and you need something to make that bearable.</p>
<p>Peterson's framework — that responsibility is the antidote — is compelling precisely because it matches observed reality. People with tremendous responsibility often report high life satisfaction. People with minimal responsibility often report meaninglessness. This holds across cultures, across socioeconomic levels, across personality types.</p>
<p>But the framework only works if we hold three things in tension:</p>
<ol>
<li><strong>Individual agency is real</strong> — you can choose how to respond to your circumstances</li>
<li><strong>Structural constraints are real</strong> — those circumstances aren't equally distributed or equally fair</li>
<li><strong>Meaning comes from the intersection</strong> — from taking maximum responsibility within your actual situation, not an idealized one</li>
</ol>
<p>The danger of overemphasizing individual responsibility is that it becomes victim-blaming. The danger of overemphasizing structural constraints is that it becomes learned helplessness. The psychologically healthy position is to hold both: acknowledge the constraints, take responsibility for what's actually within your control, and work to expand what's controllable for yourself and others.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-existential-wager">The Existential Wager<a href="https://jonroosevelt.com/blog/burden-of-being#the-existential-wager" class="hash-link" aria-label="Direct link to The Existential Wager" title="Direct link to The Existential Wager">​</a></h2>
<p>Ultimately, embracing responsibility as a response to nihilism is a wager. You're betting that meaning created through voluntary commitment is sufficient to make life bearable, even without cosmic reassurance that it "really" matters.</p>
<p>Kierkegaard called this the leap of faith. You can't rationally prove that your commitments are objectively meaningful. But you can choose to live as if they are, and discover that the living-as-if creates its own justification.</p>
<p>This is different from delusion. You're not pretending the universe cares about your projects. You're recognizing that <strong>your caring about them is what makes them meaningful</strong>, and that this self-created meaning is the only kind available to conscious beings who can see through cosmic narratives.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="practical-applications">Practical Applications<a href="https://jonroosevelt.com/blog/burden-of-being#practical-applications" class="hash-link" aria-label="Direct link to Practical Applications" title="Direct link to Practical Applications">​</a></h2>
<p>If you take this framework seriously, the question becomes: what responsibility can you voluntarily accept that would make your life feel purposefully heavy rather than arbitrarily burdensome?</p>
<ul>
<li>
<p><strong>If you're depressed and directionless</strong>: Take on the smallest responsibility you can imagine honoring. Care for a plant. Show up for a friend consistently. Complete one project. Build from there.</p>
</li>
<li>
<p><strong>If you're overwhelmed by global problems</strong>: Focus on the scale where your actions matter. You can't fix climate change, but you can improve your household's sustainability. You can't eliminate poverty, but you can hire responsibly or support effective organizations.</p>
</li>
<li>
<p><strong>If you're successful but unfulfilled</strong>: Examine whether your achievements came from responsibility or ambition. Achievement without responsibility doesn't generate meaning. Find the burden you're actually willing to carry.</p>
</li>
<li>
<p><strong>If you're burned out</strong>: Distinguish between responsibility you voluntarily accepted and burden imposed from outside. Real responsibility sustains you. Imposed obligation drains you. Sometimes the responsible thing is to shed false responsibilities.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-final-word">The Final Word<a href="https://jonroosevelt.com/blog/burden-of-being#the-final-word" class="hash-link" aria-label="Direct link to The Final Word" title="Direct link to The Final Word">​</a></h2>
<p>Peterson's synthesis of existentialism, psychology, and ancient wisdom won't satisfy everyone. It doesn't provide cosmic reassurance. It doesn't promise that your suffering has objective purpose. It doesn't solve the problem of evil or the apparent absurdity of existence.</p>
<p>What it does is provide a framework for living with those problems instead of being paralyzed by them. And maybe that's the most honest answer available: we're conscious beings thrown into existence without our consent, guaranteed to suffer, capable of seeing through simple narratives, and forced to create meaning in the face of all that.</p>
<p>The burden of being is real. But the capacity to voluntarily take on responsibility — to choose what you're willing to suffer for — might be the closest thing we have to an antidote.</p>
<p><strong>"It's in responsibility that most people find the meaning that sustains them through life."</strong></p>
<p>Not in happiness. Not in comfort. Not in success. In the willing acceptance of a burden you've chosen to carry, in service of something you've decided matters, even though the universe doesn't care either way.</p>
<p>That's the wager. And for many people, it turns out to be enough.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-reading">Further Reading<a href="https://jonroosevelt.com/blog/burden-of-being#further-reading" class="hash-link" aria-label="Direct link to Further Reading" title="Direct link to Further Reading">​</a></h2>
<ul>
<li><em>12 Rules for Life</em> and <em>Beyond Order</em> by Jordan Peterson — Full development of the responsibility framework</li>
<li><em>Man's Search for Meaning</em> by Viktor Frankl — Finding meaning in extreme suffering</li>
<li><em>The Denial of Death</em> by Ernest Becker — How we create meaning to cope with mortality</li>
<li><em>Either/Or</em> by Søren Kierkegaard — The nature of choice and commitment</li>
<li><em>The Brothers Karamazov</em> by Fyodor Dostoevsky — The meaning crisis in its rawest form</li>
<li><em>The Gay Science</em> by Friedrich Nietzsche — The death of God and what comes after</li>
</ul>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Philosophy" term="Philosophy"/>
        <category label="Jordan Peterson" term="Jordan Peterson"/>
        <category label="Existentialism" term="Existentialism"/>
        <category label="Personal Growth" term="Personal Growth"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Two AI Trends Transforming Urgent Care in 2026]]></title>
        <id>https://jonroosevelt.com/blog/ai-urgent-care-trends</id>
        <link href="https://jonroosevelt.com/blog/ai-urgent-care-trends"/>
        <updated>2026-01-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Urgent care operates in a constant state of tension. Providers spend more time documenting visits than examining patients. Front desk staff juggle phone calls, check-ins, and insurance verification while patients pile up in the waiting room. Administrative burden competes with clinical care for every minute of the workday. But two AI technologies are fundamentally changing this calculus in 2026: ambient AI scribes and AI front desk automation. These aren't theoretical innovations — they're deployed systems delivering measurable operational improvements today.]]></summary>
        <content type="html"><![CDATA[<p>Urgent care operates in a constant state of tension. Providers spend more time documenting visits than examining patients. Front desk staff juggle phone calls, check-ins, and insurance verification while patients pile up in the waiting room. Administrative burden competes with clinical care for every minute of the workday. But two AI technologies are fundamentally changing this calculus in 2026: ambient AI scribes and AI front desk automation. These aren't theoretical innovations — they're deployed systems delivering measurable operational improvements today.</p>
<p><img decoding="async" loading="lazy" alt="AI Transforming Urgent Care Operations" src="https://jonroosevelt.com/assets/images/hero-banner-582e5484612bbea721571374d55b837c.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-documentation-crisis">The Documentation Crisis<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#the-documentation-crisis" class="hash-link" aria-label="Direct link to The Documentation Crisis" title="Direct link to The Documentation Crisis">​</a></h2>
<p>Before discussing solutions, we need to understand the problem. The modern electronic medical record (EMR) was supposed to streamline clinical documentation. Instead, it's become the primary source of provider burnout.</p>
<p>The statistics are stark:</p>
<ul>
<li><strong>Providers spend 37% of patient encounter time on EMR work</strong> — typing notes, clicking checkboxes, ordering labs, coding diagnoses</li>
<li><strong>For every hour of direct patient care, physicians spend 2 hours on documentation and administrative tasks</strong></li>
<li><strong>Documentation burden is the #1 driver of clinician burnout</strong>, cited more frequently than workload, regulatory burden, or interpersonal conflicts</li>
</ul>
<p>In urgent care specifically, the problem is amplified. Unlike primary care visits where patients schedule 20-30 minute appointments, urgent care encounters are compressed. A provider might see 20-25 patients in a shift. The documentation doesn't decrease — it accumulates. By the end of a shift, providers are routinely 2-3 hours behind on charting.</p>
<p>This isn't just a quality of life issue. It's a clinical risk issue. Delayed documentation leads to:</p>
<ul>
<li><strong>Incomplete clinical notes</strong> that omit critical details</li>
<li><strong>Coding errors</strong> that result in claim denials and lost revenue</li>
<li><strong>Medico-legal exposure</strong> when documentation doesn't reflect the care delivered</li>
<li><strong>Provider burnout and turnover</strong>, forcing clinics into expensive locum staffing arrangements</li>
</ul>
<p>The traditional response has been hiring medical scribes — administrative staff who shadow providers and document encounters. This helps, but it's expensive, requires training, adds a third person to every exam room, and still relies on human typing speed and attention span.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trend-1-ambient-ai-scribes">Trend 1: Ambient AI Scribes<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#trend-1-ambient-ai-scribes" class="hash-link" aria-label="Direct link to Trend 1: Ambient AI Scribes" title="Direct link to Trend 1: Ambient AI Scribes">​</a></h2>
<p>Ambient AI scribes fundamentally change the documentation workflow. Instead of the provider typing or dictating to a human scribe, an AI system listens to the natural conversation between provider and patient, understands the clinical context, and automatically generates structured documentation in the EMR.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-they-work">How They Work<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#how-they-work" class="hash-link" aria-label="Direct link to How They Work" title="Direct link to How They Work">​</a></h3>
<p>The technology stack typically includes:</p>
<ol>
<li><strong>Microphone capture</strong> — Discrete recording device in exam room (often a smartphone or dedicated device on the provider's belt)</li>
<li><strong>Speech-to-text transcription</strong> — Converting conversation audio to text transcript</li>
<li><strong>Natural language processing (NLP)</strong> — Understanding clinical context, extracting relevant information (chief complaint, history of present illness, physical exam findings, assessment, plan)</li>
<li><strong>EMR integration</strong> — Automatically populating appropriate fields in the electronic medical record</li>
<li><strong>Provider review and sign-off</strong> — Clinician reviews AI-generated note, makes edits, and finalizes</li>
</ol>
<p>The key word is <strong>ambient</strong>. The provider doesn't dictate in a structured format. They have a normal conversation with the patient: "Tell me what brought you in today." "Where does it hurt?" "Any fever or chills?" The AI listens, understands, and documents.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-impact-70-reduction-in-documentation-time">The Impact: 70% Reduction in Documentation Time<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#the-impact-70-reduction-in-documentation-time" class="hash-link" aria-label="Direct link to The Impact: 70% Reduction in Documentation Time" title="Direct link to The Impact: 70% Reduction in Documentation Time">​</a></h3>
<p>Real-world deployments show dramatic results:</p>
<ul>
<li><strong>Documentation time reduced by 70%</strong> — Tasks that took 10-12 minutes now take 3-4 minutes</li>
<li><strong>Providers reclaim 1-2 hours per shift</strong> previously spent on after-hours charting</li>
<li><strong>Coding accuracy improves</strong> — AI identifies billable elements providers often miss (review of systems, detailed exam components, complexity factors)</li>
<li><strong>Claim denial rates decrease</strong> — More complete documentation supports medical necessity</li>
</ul>
<p>But the most significant impact isn't measured in minutes. It's <strong>eye contact</strong>.</p>
<p>When providers aren't typing, they're looking at patients. They're listening. They're catching the nonverbal cues — the wince when you palpate the abdomen, the hesitation before answering a question about medication adherence, the parent's anxiety that doesn't match the child's mild symptoms.</p>
<p>One urgent care provider described the shift: "For the first time in 15 years, I'm having conversations with patients instead of conversations with my computer. I'm seeing body language. I'm noticing when something doesn't add up. And I'm not staying two hours after my shift to finish notes."</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-considerations">Implementation Considerations<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#implementation-considerations" class="hash-link" aria-label="Direct link to Implementation Considerations" title="Direct link to Implementation Considerations">​</a></h3>
<p>Ambient AI scribes sound transformative — and they are — but implementation requires careful planning.</p>
<p><strong>HIPAA Compliance and Data Security</strong></p>
<p>Patient conversations contain highly sensitive information. Any AI system processing this data must be:</p>
<ul>
<li><strong>HIPAA compliant</strong> with Business Associate Agreements (BAAs) in place</li>
<li><strong>Encrypted in transit and at rest</strong> — Audio recordings and transcripts must be secured</li>
<li><strong>Access-controlled</strong> — Only authorized personnel should access recordings</li>
<li><strong>Retention-limited</strong> — Audio files should be deleted after note generation, not stored indefinitely</li>
</ul>
<p>Most enterprise vendors (Nuance DAX, Suki, Abridge) have architected their systems with these requirements from day one. But smaller vendors or open-source solutions may require additional security hardening.</p>
<p><strong>Patient Consent and Transparency</strong></p>
<p>While HIPAA doesn't strictly require patient consent for AI documentation (it falls under "healthcare operations"), transparency builds trust.</p>
<p>Best practices:</p>
<ul>
<li><strong>Signage in exam rooms</strong> — "This room uses AI-assisted documentation to improve care"</li>
<li><strong>Verbal notification</strong> — "I'm using an AI assistant to help with documentation today, so I can focus on you. Is that okay?"</li>
<li><strong>Opt-out option</strong> — Allow patients to decline AI documentation if they prefer</li>
</ul>
<p>In practice, patient pushback is minimal. Most patients appreciate that the technology means more provider attention and better documentation.</p>
<p><strong>Provider Training and Trust Building</strong></p>
<p>The biggest implementation barrier isn't technology — it's clinician trust.</p>
<p>Providers need to believe that:</p>
<ol>
<li>The AI won't miss critical clinical information</li>
<li>The generated notes will withstand legal scrutiny</li>
<li>The system won't make embarrassing errors (wrong patient name, incorrect diagnoses, nonsensical statements)</li>
<li>They won't spend more time fixing AI mistakes than they saved on typing</li>
</ol>
<p>Building this trust requires:</p>
<ul>
<li><strong>Phased rollout</strong> — Start with 2-3 enthusiastic early adopters, not a forced enterprise deployment</li>
<li><strong>Side-by-side comparison</strong> — For the first 2 weeks, generate both human-typed notes and AI notes to compare quality</li>
<li><strong>Daily feedback loops</strong> — Clinicians report errors or omissions; vendor improves models in response</li>
<li><strong>Visible time savings</strong> — Track and share documentation time metrics so providers see the impact</li>
</ul>
<p>At one urgent care network, skeptical providers became advocates after seeing their charting backlog disappear. As one physician put it: "I went home on time for the first time in three years. This isn't hype — it's real."</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="coding-accuracy-and-revenue-impact">Coding Accuracy and Revenue Impact<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#coding-accuracy-and-revenue-impact" class="hash-link" aria-label="Direct link to Coding Accuracy and Revenue Impact" title="Direct link to Coding Accuracy and Revenue Impact">​</a></h3>
<p>An unexpected benefit: AI scribes improve billing and coding accuracy.</p>
<p>Providers routinely under-code encounters because they don't document every billable element. An AI system trained on coding guidelines identifies:</p>
<ul>
<li><strong>Review of systems elements</strong> that support higher-complexity codes</li>
<li><strong>Detailed exam components</strong> that justify 99214 instead of 99213 (20-30% reimbursement difference)</li>
<li><strong>Time-based billing opportunities</strong> when counseling or care coordination exceed face-to-face time</li>
</ul>
<p>One urgent care group reported a <strong>12% increase in average reimbursement per encounter</strong> after deploying ambient AI scribes — not from upcoding, but from accurately capturing the work already being performed.</p>
<p>Over 10,000 patient encounters annually, this translates to hundreds of thousands in recovered revenue. The AI scribe ROI becomes positive within months, even before accounting for reduced scribing costs or improved provider retention.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trend-2-ai-front-desk-automation">Trend 2: AI Front Desk Automation<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#trend-2-ai-front-desk-automation" class="hash-link" aria-label="Direct link to Trend 2: AI Front Desk Automation" title="Direct link to Trend 2: AI Front Desk Automation">​</a></h2>
<p>While ambient AI scribes transform the clinical side of urgent care, AI front desk automation addresses the administrative bottleneck on the patient access side.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-front-desk-problem">The Front Desk Problem<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#the-front-desk-problem" class="hash-link" aria-label="Direct link to The Front Desk Problem" title="Direct link to The Front Desk Problem">​</a></h3>
<p>Urgent care front desk staff are responsible for:</p>
<ul>
<li><strong>Patient check-in and registration</strong> — Verifying identity, contact info, emergency contacts</li>
<li><strong>Insurance verification</strong> — Confirming coverage, copays, deductibles</li>
<li><strong>Payment collection</strong> — Copays, past balances, self-pay arrangements</li>
<li><strong>Appointment scheduling</strong> — Coordinating with clinic capacity and provider schedules</li>
<li><strong>Phone triage</strong> — Answering "Are you open?" "Do you take my insurance?" "How long is the wait?"</li>
<li><strong>In-person patient support</strong> — Directions to exam rooms, questions about forms, managing frustrated patients</li>
</ul>
<p>This is too much for one person. Most clinics staff 2-3 front desk employees during peak hours. But even this isn't enough during flu season or when multiple walk-ins arrive simultaneously.</p>
<p>The result: phones go to voicemail, online inquiries get delayed responses, patients wait 10-15 minutes just to check in, and staff experience high turnover due to stress and low pay.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ai-front-desk-systems-247-automated-engagement">AI Front Desk Systems: 24/7 Automated Engagement<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#ai-front-desk-systems-247-automated-engagement" class="hash-link" aria-label="Direct link to AI Front Desk Systems: 24/7 Automated Engagement" title="Direct link to AI Front Desk Systems: 24/7 Automated Engagement">​</a></h3>
<p>AI front desk automation handles the repetitive, high-volume tasks that consume staff time while adding minimal clinical value.</p>
<p><strong>Core capabilities:</strong></p>
<p><strong>1. Automated Scheduling and Check-In</strong></p>
<ul>
<li><strong>Online self-scheduling</strong> with real-time availability updates integrated with EMR</li>
<li><strong>SMS-based check-in</strong> — Patient texts arrival, AI confirms and notifies staff</li>
<li><strong>Paperwork pre-completion</strong> — Patients fill out intake forms via mobile link before arrival</li>
<li><strong>Wait time estimates</strong> — AI pulls current queue status from EMR and provides accurate wait times</li>
</ul>
<p><strong>2. Insurance Verification and Eligibility Checks</strong></p>
<ul>
<li><strong>Automated insurance verification</strong> via payer APIs</li>
<li><strong>Benefit explanation</strong> — AI explains copay, deductible, coverage limits in plain language</li>
<li><strong>Pre-registration</strong> — Insurance verified before patient arrives, reducing check-in time</li>
</ul>
<p><strong>3. Payment Processing and Collections</strong></p>
<ul>
<li><strong>Automated payment reminders</strong> — SMS/email for outstanding balances</li>
<li><strong>Self-service payment portals</strong> — Patients pay via text link (credit card, HSA/FSA, payment plans)</li>
<li><strong>Copay collection at check-in</strong> — Automated prompts ensure copays are collected before visit</li>
</ul>
<p><strong>4. Phone and Chat Support</strong></p>
<ul>
<li><strong>AI-powered phone answering</strong> — Handles common questions (hours, location, insurance, services)</li>
<li><strong>Intelligent routing</strong> — Complex questions escalated to human staff; routine inquiries resolved by AI</li>
<li><strong>Multi-language support</strong> — Spanish, Mandarin, and other languages without requiring multilingual staff</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-operational-impact">The Operational Impact<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#the-operational-impact" class="hash-link" aria-label="Direct link to The Operational Impact" title="Direct link to The Operational Impact">​</a></h3>
<p>One urgent care network deployed AI front desk automation across 15 locations. The results:</p>
<ul>
<li><strong>Phone answer rate increased from 68% to 94%</strong> — Fewer missed calls means more patients scheduled</li>
<li><strong>Check-in time reduced by 40%</strong> — Self-service check-in and pre-completed paperwork accelerate patient flow</li>
<li><strong>Staff reassignment</strong> — Front desk employees shifted to higher-value tasks (prior authorization support, complex billing inquiries, patient experience improvement)</li>
<li><strong>After-hours scheduling increased 35%</strong> — Patients can schedule at 10 PM when clinics are closed; appointments auto-populate in EMR by morning</li>
</ul>
<p>The key insight: AI doesn't eliminate front desk jobs. It <strong>removes the repetitive work</strong> so staff can focus on complex interactions that actually require human judgment, empathy, and problem-solving.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="balancing-automation-with-human-touch">Balancing Automation with Human Touch<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#balancing-automation-with-human-touch" class="hash-link" aria-label="Direct link to Balancing Automation with Human Touch" title="Direct link to Balancing Automation with Human Touch">​</a></h3>
<p>The risk of AI front desk systems is dehumanization. Healthcare is personal. Patients calling with chest pain, worried parents with sick children, elderly patients confused about insurance — these interactions need human empathy, not scripted chatbot responses.</p>
<p>The solution is <strong>tiered automation</strong>:</p>
<p><strong>Tier 1: Fully Automated (Low Stakes, High Volume)</strong></p>
<ul>
<li>"What are your hours?"</li>
<li>"Where are you located?"</li>
<li>"Do you take [insurance]?"</li>
<li>"How long is the wait right now?"</li>
<li>"Can I schedule an appointment?"</li>
</ul>
<p>These queries consume 60-70% of front desk volume but require zero clinical judgment. AI handles them perfectly.</p>
<p><strong>Tier 2: AI-Assisted (Moderate Complexity)</strong></p>
<ul>
<li>Insurance eligibility questions with edge cases</li>
<li>Payment plan negotiations</li>
<li>Appointment rescheduling with constraints</li>
<li>Routing patients to appropriate care level (urgent care vs. ED vs. primary care)</li>
</ul>
<p>AI surfaces relevant information, suggests responses, but a human staff member makes the final decision and communicates with the patient.</p>
<p><strong>Tier 3: Human-Only (High Stakes, Complex)</strong></p>
<ul>
<li>Emotional or distressed patients</li>
<li>Complex medical questions</li>
<li>Billing disputes requiring judgment calls</li>
<li>Complaints or service recovery situations</li>
</ul>
<p>AI immediately routes these to human staff with full context (caller history, previous visits, issue summary).</p>
<p>The goal isn't to automate everything. It's to <strong>automate the noise so humans can focus on what matters</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="patient-acceptance-and-trust">Patient Acceptance and Trust<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#patient-acceptance-and-trust" class="hash-link" aria-label="Direct link to Patient Acceptance and Trust" title="Direct link to Patient Acceptance and Trust">​</a></h3>
<p>Early skepticism around AI front desk systems focused on patient resistance. Would patients accept speaking to an AI? Would elderly patients struggle with text-based check-in?</p>
<p>Real-world data says: patients don't care about the AI. They care about <strong>speed and convenience</strong>.</p>
<ul>
<li><strong>Younger patients (18-45) prefer digital self-service</strong> — They'd rather text to check in than talk to a front desk staff member</li>
<li><strong>Older patients (65+) appreciate phone support</strong> — As long as the AI voice is clear and responsive, they engage just fine. If they need help, they're routed to a human immediately.</li>
<li><strong>Language barriers decrease</strong> — AI systems with multi-language support often outperform English-only human staff for non-English speakers</li>
</ul>
<p>One urgent care operator summarized it: "Patients don't come to urgent care for a relationship with the front desk. They come for fast, convenient healthcare. If AI gets them to a provider faster, they're thrilled."</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-implementation-challenge-start-with-low-stakes-use-cases">The Implementation Challenge: Start with Low-Stakes Use Cases<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#the-implementation-challenge-start-with-low-stakes-use-cases" class="hash-link" aria-label="Direct link to The Implementation Challenge: Start with Low-Stakes Use Cases" title="Direct link to The Implementation Challenge: Start with Low-Stakes Use Cases">​</a></h2>
<p>Both ambient AI scribes and AI front desk automation are transforming urgent care — but implementation requires a deliberate, risk-managed approach.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="begin-with-documentation-not-diagnosis">Begin with Documentation, Not Diagnosis<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#begin-with-documentation-not-diagnosis" class="hash-link" aria-label="Direct link to Begin with Documentation, Not Diagnosis" title="Direct link to Begin with Documentation, Not Diagnosis">​</a></h3>
<p>The critical principle: <strong>Start with low-stakes AI applications before moving to high-stakes clinical decisions</strong>.</p>
<p><strong>Low-stakes AI use cases:</strong></p>
<ul>
<li>Documentation (ambient scribes)</li>
<li>Scheduling and appointment management</li>
<li>Insurance verification</li>
<li>Patient FAQs and wayfinding</li>
</ul>
<p>These applications have high volume, low risk, and measurable ROI. If the AI makes a mistake, the consequences are minimal — a provider corrects a documentation error, a staff member reschedules an appointment, a patient calls back for clarification.</p>
<p><strong>High-stakes AI use cases (not ready for primetime):</strong></p>
<ul>
<li>Differential diagnosis generation</li>
<li>Treatment recommendations</li>
<li>Clinical decision support for high-risk conditions</li>
<li>Triage decisions (should this patient go to the ED?)</li>
</ul>
<p>These require clinical judgment, carry legal liability, and have unclear regulatory status. The technology exists, but the risk-benefit calculus doesn't yet justify deployment in most urgent care settings.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="legal-liability-the-unresolved-question">Legal Liability: The Unresolved Question<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#legal-liability-the-unresolved-question" class="hash-link" aria-label="Direct link to Legal Liability: The Unresolved Question" title="Direct link to Legal Liability: The Unresolved Question">​</a></h3>
<p>One of the most thoughtful critiques of healthcare AI comes from Peter A. Kolbert, JD, a healthcare attorney:</p>
<blockquote>
<p>"From a risk standpoint, the challenge is that the brilliant innovators driving healthcare technology often don't understand that the ultimate endpoint of every patient interaction is liability."</p>
</blockquote>
<p>This is the central tension in healthcare AI deployment.</p>
<p><strong>What happens when AI-assisted documentation omits a critical finding that leads to a missed diagnosis?</strong></p>
<p>Is the provider liable for not catching the omission? Is the vendor liable for the AI error? Is the clinic liable for deploying the technology?</p>
<p>The case law doesn't exist yet. The regulatory framework is evolving. The FDA has issued guidance on AI as a medical device, but much of healthcare AI falls into gray areas.</p>
<p><strong>What we know today:</strong></p>
<ul>
<li><strong>Providers remain legally responsible for all documentation</strong> — Even if AI generates the note, the clinician must review and attest to accuracy</li>
<li><strong>Vendors carry product liability</strong> — But contract terms often limit liability to software defects, not clinical outcomes</li>
<li><strong>Standard of care is shifting</strong> — As AI becomes ubiquitous, failing to use AI tools may eventually constitute substandard care (similar to how not using EMRs became indefensible)</li>
</ul>
<p><strong>Practical risk mitigation:</strong></p>
<ol>
<li><strong>Always have a human in the loop</strong> — No AI system should make autonomous clinical decisions</li>
<li><strong>Document AI use transparently</strong> — Note in the medical record when AI tools were used and who reviewed outputs</li>
<li><strong>Maintain robust quality assurance</strong> — Regularly audit AI-generated documentation for accuracy and completeness</li>
<li><strong>Purchase adequate malpractice and cyber liability insurance</strong> — Ensure policies cover AI-assisted workflows</li>
<li><strong>Follow vendor best practices</strong> — Use enterprise-grade, HIPAA-compliant systems with established track records</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="building-clinician-trust-the-real-barrier">Building Clinician Trust: The Real Barrier<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#building-clinician-trust-the-real-barrier" class="hash-link" aria-label="Direct link to Building Clinician Trust: The Real Barrier" title="Direct link to Building Clinician Trust: The Real Barrier">​</a></h3>
<p>Technology readiness isn't the bottleneck. Clinician trust is.</p>
<p>Physicians and nurse practitioners who've spent decades developing their clinical intuition are skeptical of black-box AI systems. This skepticism is healthy — it's what keeps patients safe.</p>
<p>Building trust requires:</p>
<p><strong>Transparency About How AI Works</strong></p>
<p>Don't position AI as magic. Explain:</p>
<ul>
<li>What data the AI was trained on</li>
<li>How it processes information</li>
<li>What its limitations are</li>
<li>When it might fail</li>
</ul>
<p><strong>Demonstrable Accuracy</strong></p>
<p>Clinicians need proof that AI tools are reliable:</p>
<ul>
<li>Publish internal validation studies</li>
<li>Share error rates and performance metrics</li>
<li>Show side-by-side comparisons (AI vs. human performance)</li>
<li>Let clinicians test the system in low-risk scenarios before relying on it</li>
</ul>
<p><strong>Control and Override Capability</strong></p>
<p>Clinicians must always be able to override AI outputs:</p>
<ul>
<li>Edit AI-generated documentation</li>
<li>Reject AI suggestions</li>
<li>Turn off the AI system entirely if they prefer</li>
</ul>
<p>The moment AI feels coercive ("You must use this system"), trust evaporates.</p>
<p><strong>Visible Time Savings and Quality Improvements</strong></p>
<p>Trust accelerates when clinicians personally experience benefits:</p>
<ul>
<li>"I finished charting during my shift for the first time in months."</li>
<li>"The AI caught a diagnosis code that increased reimbursement by $40."</li>
<li>"I actually made eye contact with my patient instead of staring at the computer."</li>
</ul>
<p>These stories, shared peer-to-peer, are more persuasive than any vendor pitch.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next-the-2026-2027-horizon">What's Next: The 2026-2027 Horizon<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#whats-next-the-2026-2027-horizon" class="hash-link" aria-label="Direct link to What's Next: The 2026-2027 Horizon" title="Direct link to What's Next: The 2026-2027 Horizon">​</a></h2>
<p>Ambient AI scribes and AI front desk automation are the mature, deployable technologies of 2026. But the next wave of AI innovation in urgent care is already emerging.</p>
<p><strong>Clinical Decision Support for Undifferentiated Patients</strong></p>
<p>Urgent care sees patients with vague complaints: "I don't feel well." "I'm tired all the time." "Something's wrong but I don't know what."</p>
<p>AI systems trained on millions of encounters can surface differential diagnoses providers might not consider:</p>
<ul>
<li>"Based on the patient's age, symptoms, and exam findings, consider thyroid dysfunction — 23% of similar presentations in the training data."</li>
<li>"Patient's reported symptoms align with heart failure exacerbation — consider BNP testing."</li>
</ul>
<p>This isn't diagnosis — it's <strong>hypothesis generation</strong>. The provider still makes all clinical decisions, but AI expands the differential.</p>
<p><strong>Predictive Triage: Who Needs to Be Seen vs. Who Can Self-Care</strong></p>
<p>Patients often don't know if their symptoms require urgent care, primary care, or no care at all.</p>
<p>AI triage tools (text or voice-based) can guide patients:</p>
<ul>
<li>"Your symptoms suggest a mild viral illness. Self-care at home is appropriate. Here's what to watch for."</li>
<li>"Your symptoms could indicate appendicitis. You should seek care at an emergency department within the next 2 hours."</li>
<li>"Your symptoms are consistent with strep throat. An urgent care visit today is recommended."</li>
</ul>
<p>This <strong>reduces inappropriate ED utilization</strong> (expensive, crowded) and <strong>increases urgent care utilization</strong> (appropriate care level, better margins).</p>
<p><strong>Real-Time Coding and Billing Optimization</strong></p>
<p>AI systems that monitor the encounter in real time can prompt providers mid-visit:</p>
<ul>
<li>"You've discussed 8 review of systems elements. Documenting 2 more would support a 99214 code."</li>
<li>"You've spent 18 minutes on counseling. Consider time-based billing for higher reimbursement."</li>
</ul>
<p>This isn't about upcoding — it's about <strong>accurately capturing the complexity of care delivered</strong>.</p>
<p><strong>Post-Visit Automated Follow-Up</strong></p>
<p>AI can handle post-visit workflows:</p>
<ul>
<li>Sending discharge instructions tailored to the diagnosis</li>
<li>Scheduling follow-up appointments with primary care</li>
<li>Checking in 48 hours later: "How are your symptoms? Did the medication help?"</li>
<li>Identifying patients who need callback (symptoms not improving, medication side effects, no prescription fill)</li>
</ul>
<p>This <strong>closes the care loop</strong> without consuming provider or nurse time.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-takeaway">The Takeaway<a href="https://jonroosevelt.com/blog/ai-urgent-care-trends#the-takeaway" class="hash-link" aria-label="Direct link to The Takeaway" title="Direct link to The Takeaway">​</a></h2>
<p>Ambient AI scribes and AI front desk automation aren't futuristic technologies — they're deployed today, delivering measurable results across urgent care networks. They work because they solve real operational problems: documentation burden and administrative overload.</p>
<p>The key to successful implementation is starting with low-stakes applications, building clinician trust through transparency and demonstrated accuracy, and maintaining human oversight over all clinical decisions.</p>
<p>The legal and liability questions aren't fully resolved. The technology will continue to improve. But the trajectory is clear: AI is becoming infrastructure in healthcare, as fundamental as the EMR itself.</p>
<p>The urgent care operators who embrace these tools thoughtfully — with attention to patient privacy, clinical accuracy, and staff experience — will deliver better care, reduce burnout, and operate more sustainably. The operators who ignore AI will find themselves unable to compete on efficiency, unable to retain clinicians, and unable to meet patient expectations for convenience and responsiveness.</p>
<p>The question isn't whether AI will transform urgent care. It's whether you'll lead the transformation or be disrupted by it.</p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Healthcare" term="Healthcare"/>
        <category label="AI" term="AI"/>
        <category label="Urgent Care" term="Urgent Care"/>
        <category label="Operations" term="Operations"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The 4-Line Architecture That Beat Complex AI Frameworks]]></title>
        <id>https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks</id>
        <link href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks"/>
        <updated>2026-01-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Claude Code's entire architecture is fundamentally just one while loop. Not as a simplification—literally. While competitors build orchestration frameworks with task queues, agent hierarchies, and complex state machines, Anthropic shipped a CLI that writes 90% of its own code using the simplest possible control flow.]]></summary>
        <content type="html"><![CDATA[<p>Claude Code's entire architecture is fundamentally just one while loop. Not as a simplification—literally. While competitors build orchestration frameworks with task queues, agent hierarchies, and complex state machines, Anthropic shipped a CLI that writes 90% of its own code using the simplest possible control flow.</p>
<p>This isn't dumbing down the problem. It's a philosophical stance on what AI agent architecture should be: trust the model, don't over-engineer around limitations, and recognize that simplicity scales better than complexity.</p>
<p><img decoding="async" loading="lazy" alt="Simple Architecture" src="https://jonroosevelt.com/assets/images/hero-banner-7c54ec4cbb91c5c92f694164c595c34b.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-philosophy-simple-is-better-than-complex">The Philosophy: Simple is Better Than Complex<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#the-philosophy-simple-is-better-than-complex" class="hash-link" aria-label="Direct link to The Philosophy: Simple is Better Than Complex" title="Direct link to The Philosophy: Simple is Better Than Complex">​</a></h2>
<p>When I first examined Claude Code's architecture, I expected layers of abstractions. What I found was closer to a Unix pipeline than a microservices mesh. The core execution loop looks approximately like this:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> task_complete</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    user_input </span><span class="token operator">=</span><span class="token plain"> get_input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    model_response </span><span class="token operator">=</span><span class="token plain"> call_claude</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    results </span><span class="token operator">=</span><span class="token plain"> execute_tools</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">model_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tool_calls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Four lines. One loop. That's it.</p>
<p>This violates everything we've learned about "proper" AI agent architecture. Where's the planning layer? The reflection mechanism? The multi-agent coordination? The sophisticated memory management?</p>
<p>The answer: trust the model to handle it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="counter-to-industry-trends">Counter to Industry Trends<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#counter-to-industry-trends" class="hash-link" aria-label="Direct link to Counter to Industry Trends" title="Direct link to Counter to Industry Trends">​</a></h2>
<p>Compare this to what the industry has been building. OpenAI's Codex-based systems layer complexity on complexity:</p>
<ul>
<li><strong>Orchestration frameworks</strong> that route tasks between specialized agents</li>
<li><strong>Planning modules</strong> that decompose problems into dependency graphs</li>
<li><strong>Verification layers</strong> that check code before execution</li>
<li><strong>State machines</strong> that manage agent lifecycles</li>
<li><strong>Message queues</strong> that coordinate async operations</li>
</ul>
<p>All of this infrastructure exists because the underlying assumption is: the model isn't smart enough, so we need systems to compensate.</p>
<p>Claude Code takes the opposite bet: Claude Sonnet 4.5 is smart enough. Give it tools, give it context, and get out of the way.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bash-as-universal-adapter">Bash as Universal Adapter<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#bash-as-universal-adapter" class="hash-link" aria-label="Direct link to Bash as Universal Adapter" title="Direct link to Bash as Universal Adapter">​</a></h2>
<p>The most elegant decision in Claude Code isn't what it includes—it's what it excludes. Instead of implementing 100 specialized tools (read_file, write_file, list_directory, search_code, run_tests, git_commit, etc.), Claude Code provides one flexible tool: Bash.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Not this:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> tools </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  readFileTool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  writeFileTool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  searchFileTool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  gitTool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  npmTool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dockerTool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// ... 94 more tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// This:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> tools </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">bashTool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Why does this work? Because Bash is already a universal adapter. Every operation you need—file manipulation, process management, network requests, version control—already has a battle-tested CLI tool. Claude learns to compose these tools instead of learning bespoke APIs.</p>
<p>The benefits compound:</p>
<ol>
<li><strong>Zero maintenance burden</strong> - Bash tools evolve independently, Claude Code inherits improvements for free</li>
<li><strong>Infinite extensibility</strong> - Any CLI tool is immediately available without framework changes</li>
<li><strong>Familiar mental model</strong> - Developers already know these tools, so agent behavior is predictable</li>
<li><strong>Cross-platform compatibility</strong> - Standard Unix tools work everywhere</li>
<li><strong>Composability</strong> - Tools chain naturally (<code>grep | sed | awk</code> vs implementing search + transform + extract separately)</li>
</ol>
<p>When you give Claude Code a task like "find all TypeScript files importing React and count their lines," it doesn't need a specialized code analysis tool. It just runs:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">find . -name "*.ts" -exec grep -l "import.*React" {} \; | xargs wc -l</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is the Unix philosophy applied to AI agents: do one thing well (Bash execution), and compose to handle complexity.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="context-management-philosophy">Context Management Philosophy<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#context-management-philosophy" class="hash-link" aria-label="Direct link to Context Management Philosophy" title="Direct link to Context Management Philosophy">​</a></h2>
<p>Here's where Claude Code diverges most dramatically from competitors: context strategy.</p>
<p>Most AI agent frameworks obsess over preserving every detail. They build elaborate memory systems—short-term, long-term, episodic, semantic. They implement retrieval mechanisms that surface relevant past interactions. They maintain persistent knowledge graphs.</p>
<p>Claude Code's philosophy: <strong>The longer the context, the stupider the agent.</strong></p>
<p>This sounds counterintuitive. Don't agents get smarter with more information? Yes, to a point. Then they get confused. They overthink. They chase irrelevant patterns. They hallucinate connections that don't exist.</p>
<p>Claude Code aggressively prunes context. Each interaction gets a clean slate with minimal carry-forward. Only essential state survives between turns:</p>
<ul>
<li>Current working directory</li>
<li>Recent file contents (only what's been read)</li>
<li>Last few commands and their outputs</li>
<li>Explicit user instructions</li>
</ul>
<p>That's it. No elaborate memory systems. No sophisticated retrieval. Just enough context to maintain continuity, then reset.</p>
<p>The result: Claude Code stays focused. It doesn't get lost in its own history. It doesn't over-optimize for edge cases from three days ago. It solves the current problem with fresh eyes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trust-the-model-dont-engineer-around-it">Trust the Model, Don't Engineer Around It<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#trust-the-model-dont-engineer-around-it" class="hash-link" aria-label="Direct link to Trust the Model, Don't Engineer Around It" title="Direct link to Trust the Model, Don't Engineer Around It">​</a></h2>
<p>This philosophy shows up everywhere in Claude Code's design decisions:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-planning-layer">No Planning Layer<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#no-planning-layer" class="hash-link" aria-label="Direct link to No Planning Layer" title="Direct link to No Planning Layer">​</a></h3>
<p>Competitors implement explicit planning phases. The agent must first decompose the task, build a dependency graph, identify risks, then execute.</p>
<p>Claude Code: just start. The model is smart enough to plan implicitly while working. If it needs to think through architecture, it will. If the task is obvious, it won't waste time.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-verification-layer">No Verification Layer<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#no-verification-layer" class="hash-link" aria-label="Direct link to No Verification Layer" title="Direct link to No Verification Layer">​</a></h3>
<p>Many frameworks require code to pass through verification before execution. Static analysis checks. Security audits. Confirmation prompts.</p>
<p>Claude Code: execute and observe. If something breaks, the model sees the error and fixes it. This turns out to be faster than trying to verify everything upfront. The model learns from failures more effectively than from pre-execution checks.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-multi-agent-coordination">No Multi-Agent Coordination<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#no-multi-agent-coordination" class="hash-link" aria-label="Direct link to No Multi-Agent Coordination" title="Direct link to No Multi-Agent Coordination">​</a></h3>
<p>Current AI agent research focuses heavily on multi-agent systems. Specialized agents for different domains, communicating through protocols, voting on decisions.</p>
<p>Claude Code: one agent, one model. Specialization happens through tool selection and context framing, not agent proliferation. One coherent intelligence working on the problem beats a committee of narrow specialists.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-state-machines">No State Machines<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#no-state-machines" class="hash-link" aria-label="Direct link to No State Machines" title="Direct link to No State Machines">​</a></h3>
<p>Frameworks like LangChain implement elaborate state machines to manage agent lifecycles: initialize → plan → execute → reflect → update.</p>
<p>Claude Code: the while loop is the state machine. The model decides when to gather information, when to take action, when to verify, when to complete. State transitions happen naturally in the conversation flow, not through enforced checkpoints.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-90-self-written-stat">The 90% Self-Written Stat<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#the-90-self-written-stat" class="hash-link" aria-label="Direct link to The 90% Self-Written Stat" title="Direct link to The 90% Self-Written Stat">​</a></h2>
<p>Perhaps the most remarkable aspect: Claude Code wrote 90% of its own implementation. This isn't marketing spin—it's a natural consequence of the architecture.</p>
<p>When your system is simple enough that the AI can understand it, the AI can extend it. The development loop becomes:</p>
<ol>
<li>Human: "We need a feature to handle X"</li>
<li>Claude: <em>reads codebase, understands architecture, implements feature</em></li>
<li>Human: <em>reviews, merges</em></li>
</ol>
<p>This works because Claude Code's architecture has minimal abstraction layers. There's no framework-specific DSL to learn. No elaborate object hierarchies to navigate. Just straightforward TypeScript implementing a simple control loop.</p>
<p>The implications are profound. As Claude models improve, Claude Code improves—not through manual development, but through self-modification. The tool evolves with the model that powers it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="comparison-openai-codex-architecture">Comparison: OpenAI Codex Architecture<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#comparison-openai-codex-architecture" class="hash-link" aria-label="Direct link to Comparison: OpenAI Codex Architecture" title="Direct link to Comparison: OpenAI Codex Architecture">​</a></h2>
<p>Let's contrast with OpenAI's approach. Codex-based systems (like GitHub Copilot's agent features) typically implement:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">CodexAgent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">planner </span><span class="token operator">=</span><span class="token plain"> TaskPlanner</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">executor </span><span class="token operator">=</span><span class="token plain"> CodeExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">verifier </span><span class="token operator">=</span><span class="token plain"> CodeVerifier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">memory </span><span class="token operator">=</span><span class="token plain"> MemoryManager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">coordinator </span><span class="token operator">=</span><span class="token plain"> AgentCoordinator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">handle_task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Phase 1: Planning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        plan </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">planner</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Phase 2: Validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        validated_plan </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">verifier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">check_plan</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">plan</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Phase 3: Execution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> step </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> validated_plan</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">steps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Check memory for similar past tasks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            similar </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">memory</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">retrieve_similar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Execute with coordination</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">coordinator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">execute_with_agents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                step</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                context</span><span class="token operator">=</span><span class="token plain">similar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Verify result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">verifier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">check_result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">handle_failure</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Update memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">memory</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">store</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Phase 4: Reflection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">memory</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">reflect_on_task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Compare this to Claude Code:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ClaudeCode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">handle_task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        context </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">is_complete</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> claude</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">messages</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                messages</span><span class="token operator">=</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                tools</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">bash_tool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> read_tool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> write_tool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tool_calls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">execute_tools</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tool_calls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The Codex approach assumes the model needs extensive scaffolding. The Claude approach assumes the model is the scaffolding.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="when-simplicity-fails">When Simplicity Fails<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#when-simplicity-fails" class="hash-link" aria-label="Direct link to When Simplicity Fails" title="Direct link to When Simplicity Fails">​</a></h2>
<p>To be fair, this architectural philosophy has limitations:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="long-running-tasks">Long-Running Tasks<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#long-running-tasks" class="hash-link" aria-label="Direct link to Long-Running Tasks" title="Direct link to Long-Running Tasks">​</a></h3>
<p>For tasks spanning hours or days, Claude Code's stateless approach struggles. There's no checkpoint system, no resume mechanism. If execution fails midway through a 100-step migration, you start over.</p>
<p>Complex frameworks win here with their state persistence and recovery mechanisms.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-domain-expertise">Multi-Domain Expertise<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#multi-domain-expertise" class="hash-link" aria-label="Direct link to Multi-Domain Expertise" title="Direct link to Multi-Domain Expertise">​</a></h3>
<p>When a task requires specialized knowledge from multiple domains (legal + technical + financial), a single generalist agent may underperform compared to a team of specialized agents.</p>
<p>The multi-agent frameworks have an advantage for truly cross-functional work.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="audit-requirements">Audit Requirements<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#audit-requirements" class="hash-link" aria-label="Direct link to Audit Requirements" title="Direct link to Audit Requirements">​</a></h3>
<p>In regulated industries, you need detailed logs of decision-making. Why did the agent choose option A over B? What information informed this choice?</p>
<p>Claude Code's implicit reasoning is harder to audit than frameworks with explicit planning phases that log decision rationale.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resource-optimization">Resource Optimization<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#resource-optimization" class="hash-link" aria-label="Direct link to Resource Optimization" title="Direct link to Resource Optimization">​</a></h3>
<p>When running hundreds of agents in parallel, sophisticated orchestration frameworks can optimize resource allocation, queue management, and load balancing.</p>
<p>Claude Code's simple loop doesn't optimize for multi-tenancy or resource efficiency at scale.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-it-works-anyway">Why It Works Anyway<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#why-it-works-anyway" class="hash-link" aria-label="Direct link to Why It Works Anyway" title="Direct link to Why It Works Anyway">​</a></h2>
<p>Despite these limitations, Claude Code's architecture succeeds because it optimizes for the common case:</p>
<ul>
<li><strong>Most tasks are short-lived</strong> (minutes to hours, not days)</li>
<li><strong>Most tasks are single-domain</strong> (write code, debug issue, refactor module)</li>
<li><strong>Most developers prefer transparency</strong> over auditability</li>
<li><strong>Most use cases are single-user</strong> (developer with their CLI)</li>
</ul>
<p>For this 80% use case, the simple architecture outperforms complex alternatives. It's faster to build, easier to understand, simpler to debug, and more reliable in production.</p>
<p>And when you do need the complex features, you can always layer them on top. The simple foundation supports extension better than a complex foundation supports simplification.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="architectural-principles">Architectural Principles<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#architectural-principles" class="hash-link" aria-label="Direct link to Architectural Principles" title="Direct link to Architectural Principles">​</a></h2>
<p>What can we extract as general principles from Claude Code's design?</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-prefer-implicit-over-explicit">1. Prefer Implicit Over Explicit<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#1-prefer-implicit-over-explicit" class="hash-link" aria-label="Direct link to 1. Prefer Implicit Over Explicit" title="Direct link to 1. Prefer Implicit Over Explicit">​</a></h3>
<p>Let the model handle planning, verification, and coordination implicitly rather than building explicit systems for each. Trust model intelligence over framework intelligence.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-minimize-abstraction-layers">2. Minimize Abstraction Layers<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#2-minimize-abstraction-layers" class="hash-link" aria-label="Direct link to 2. Minimize Abstraction Layers" title="Direct link to 2. Minimize Abstraction Layers">​</a></h3>
<p>Every abstraction layer between the model and the task adds latency, complexity, and failure modes. Keep the path short.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-use-existing-tools">3. Use Existing Tools<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#3-use-existing-tools" class="hash-link" aria-label="Direct link to 3. Use Existing Tools" title="Direct link to 3. Use Existing Tools">​</a></h3>
<p>Don't build bespoke AI agent tools. Integrate existing CLI tools that are already robust, well-documented, and familiar to users.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-context-is-a-budget-not-a-resource">4. Context is a Budget, Not a Resource<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#4-context-is-a-budget-not-a-resource" class="hash-link" aria-label="Direct link to 4. Context is a Budget, Not a Resource" title="Direct link to 4. Context is a Budget, Not a Resource">​</a></h3>
<p>More context isn't always better. Be aggressive about pruning irrelevant information to keep the model focused.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-fail-fast-and-observe">5. Fail Fast and Observe<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#5-fail-fast-and-observe" class="hash-link" aria-label="Direct link to 5. Fail Fast and Observe" title="Direct link to 5. Fail Fast and Observe">​</a></h3>
<p>Rather than preventing failures through elaborate verification, let failures happen quickly, observe them, and recover. The model learns more from errors than from prevention.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-one-loop-not-many-states">6. One Loop, Not Many States<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#6-one-loop-not-many-states" class="hash-link" aria-label="Direct link to 6. One Loop, Not Many States" title="Direct link to 6. One Loop, Not Many States">​</a></h3>
<p>Complex state machines create cognitive overhead for both developers and models. A simple loop with implicit state transitions is easier to reason about.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="practical-takeaways">Practical Takeaways<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#practical-takeaways" class="hash-link" aria-label="Direct link to Practical Takeaways" title="Direct link to Practical Takeaways">​</a></h2>
<p>If you're building AI agent systems, consider:</p>
<p><strong>Start Simple</strong>: Implement the minimal viable control loop first. Add complexity only when you hit actual limitations, not anticipated ones.</p>
<p><strong>Trust Your Model</strong>: If you're using frontier models (GPT-4, Claude 3.5+, Gemini Ultra), they're smarter than your orchestration framework. Give them good tools and get out of the way.</p>
<p><strong>Prune Aggressively</strong>: More context usually means worse performance. Keep only what's immediately relevant.</p>
<p><strong>Use Bash</strong>: Seriously. Before implementing a specialized tool, check if a Bash command would work. You'll be surprised how often it does.</p>
<p><strong>Measure Simplicity</strong>: Track the lines of code in your agent framework. If it's growing faster than capabilities, something's wrong.</p>
<p><strong>Let the AI Maintain Itself</strong>: If your architecture is simple enough, the AI should be able to extend and modify it. This is a forcing function for clarity.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-philosophy-wins">The Philosophy Wins<a href="https://jonroosevelt.com/blog/four-line-architecture-beat-complex-ai-frameworks#the-philosophy-wins" class="hash-link" aria-label="Direct link to The Philosophy Wins" title="Direct link to The Philosophy Wins">​</a></h2>
<p>Claude Code's architecture isn't about cutting corners or shipping an MVP. It's a deliberate philosophical stance: <strong>simple systems scale better than complex ones when powered by sufficiently capable models.</strong></p>
<p>This inverts the traditional engineering wisdom. We're used to building systems that compensate for weak components. When you have weak CPUs, you build elaborate caching layers. When you have unreliable networks, you build sophisticated retry mechanisms. When you have buggy code, you build comprehensive test suites.</p>
<p>But what do you do when the component is extremely capable? When the model can plan, verify, and coordinate on its own?</p>
<p>You get out of the way. You provide the minimal interface—tools, context, and a control loop. Then you trust.</p>
<p>That's the bet Claude Code makes. Based on the results—a tool that developers actually use, that maintains itself, that handles real-world complexity—it's a bet that paid off.</p>
<p>The four-line architecture beat the complex frameworks not by matching their features, but by recognizing most of those features aren't necessary when you trust the model to be smart.</p>
<p>Sometimes the most sophisticated thing you can build is something simple.</p>
<hr>
<p><em>Jon Roosevelt is an AI architect and healthcare technology executive. He builds production AI systems at scale and thinks deeply about what makes software maintainable, reliable, and actually useful. This analysis is based on examining Claude Code's behavior, architecture patterns, and public documentation—not insider information.</em></p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Software Engineering" term="Software Engineering"/>
        <category label="Architecture" term="Architecture"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building an AI Patient Chatbot for Urgent Care with n8n, GPT-4, and Langfuse]]></title>
        <id>https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care</id>
        <link href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[When patients call or message an urgent care clinic, they're usually asking the same questions: "What are your hours?" "Do you take my insurance?" "How long is the wait right now?" These repetitive inquiries consume staff time that could be spent on clinical care. We built an AI-powered patient chatbot to handle these interactions automatically — and instrumented it with full observability so we can monitor quality in production.]]></summary>
        <content type="html"><![CDATA[<p>When patients call or message an urgent care clinic, they're usually asking the same questions: "What are your hours?" "Do you take my insurance?" "How long is the wait right now?" These repetitive inquiries consume staff time that could be spent on clinical care. We built an AI-powered patient chatbot to handle these interactions automatically — and instrumented it with full observability so we can monitor quality in production.</p>
<p><img decoding="async" loading="lazy" alt="AI Patient Chatbot Architecture" src="https://jonroosevelt.com/assets/images/hero-banner-ea09ebc14d439f10f3e55e4adbdc63ef.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem">The Problem<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#the-problem" class="hash-link" aria-label="Direct link to The Problem" title="Direct link to The Problem">​</a></h2>
<p>Our urgent care clinics were fielding dozens of routine inquiries daily — phone calls, website messages, and walk-up questions that all had predictable answers. Front desk staff were context-switching between patient check-in, phone calls, and live chat, degrading the experience for everyone.</p>
<p>We needed a system that could:</p>
<ul>
<li>Answer common patient questions accurately and instantly</li>
<li>Escalate complex queries to human staff</li>
<li>Integrate with our real-time queue management system</li>
<li>Provide full traceability for quality monitoring</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-overview">Architecture Overview<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#architecture-overview" class="hash-link" aria-label="Direct link to Architecture Overview" title="Direct link to Architecture Overview">​</a></h2>
<p>The system is built on three core technologies:</p>
<table><thead><tr><th>Component</th><th>Technology</th><th>Purpose</th></tr></thead><tbody><tr><td>Workflow Engine</td><td>n8n (self-hosted)</td><td>Orchestrates the conversation flow</td></tr><tr><td>AI Model</td><td>OpenAI GPT-4</td><td>Generates contextual responses</td></tr><tr><td>Observability</td><td>Langfuse</td><td>Traces every interaction for quality review</td></tr><tr><td>Queue Data</td><td>Clockwise.MD API</td><td>Real-time wait times and patient status</td></tr><tr><td>Escalation</td><td>Microsoft Teams</td><td>Staff alerts for complex queries</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-n8n">Why n8n?<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#why-n8n" class="hash-link" aria-label="Direct link to Why n8n?" title="Direct link to Why n8n?">​</a></h3>
<p>We chose n8n as our orchestration layer for several reasons:</p>
<ol>
<li><strong>Visual workflow design</strong> — non-technical staff can understand and modify flows</li>
<li><strong>Self-hosted</strong> — patient data never leaves our infrastructure</li>
<li><strong>Extensible</strong> — easy to add new tools, APIs, and decision branches</li>
<li><strong>Version controlled</strong> — workflows are exportable and auditable</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-conversation-flow">The Conversation Flow<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#the-conversation-flow" class="hash-link" aria-label="Direct link to The Conversation Flow" title="Direct link to The Conversation Flow">​</a></h3>
<p>The chatbot workflow handles patient messages through a structured pipeline:</p>
<ol>
<li><strong>Message intake</strong> — Patient sends a question via web chat</li>
<li><strong>Context enrichment</strong> — System pulls current clinic hours, wait times, and service availability from Clockwise.MD</li>
<li><strong>AI response generation</strong> — GPT-4 generates a response using clinic-specific context and conversation history</li>
<li><strong>Langfuse trace logging</strong> — Every interaction is traced with input, output, latency, and token usage</li>
<li><strong>Escalation check</strong> — If confidence is low or the query is complex, route to human staff via Teams</li>
<li><strong>Response delivery</strong> — Patient receives the answer in under 5 seconds</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="langfuse-the-observability-layer">Langfuse: The Observability Layer<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#langfuse-the-observability-layer" class="hash-link" aria-label="Direct link to Langfuse: The Observability Layer" title="Direct link to Langfuse: The Observability Layer">​</a></h2>
<p>In healthcare, you can't deploy an AI system and hope for the best. Every response needs to be auditable, and you need to catch quality issues before patients do.</p>
<p>Langfuse gives us:</p>
<ul>
<li><strong>Full conversation traces</strong> — See exactly what context was provided and what the model generated</li>
<li><strong>Latency monitoring</strong> — Track response times to ensure the &lt;5 second SLA</li>
<li><strong>Token usage tracking</strong> — Monitor costs per interaction</li>
<li><strong>Quality scoring</strong> — Flag responses that may need human review</li>
<li><strong>Session replay</strong> — Review full patient conversations for training and improvement</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-we-monitor">What We Monitor<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#what-we-monitor" class="hash-link" aria-label="Direct link to What We Monitor" title="Direct link to What We Monitor">​</a></h3>
<p>From our Langfuse dashboard, we track:</p>
<ul>
<li><strong>Response accuracy</strong> — Are answers factually correct about hours, services, insurance?</li>
<li><strong>Escalation rate</strong> — What percentage of queries require human intervention? (target: &lt;10%)</li>
<li><strong>Patient satisfaction signals</strong> — Follow-up questions that indicate confusion or frustration</li>
<li><strong>Edge cases</strong> — Novel questions that the system hasn't seen before</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="real-world-results">Real-World Results<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#real-world-results" class="hash-link" aria-label="Direct link to Real-World Results" title="Direct link to Real-World Results">​</a></h2>
<p>After deploying the chatbot across our clinic network:</p>
<table><thead><tr><th>Metric</th><th>Result</th></tr></thead><tbody><tr><td>Response time</td><td>&lt;5 seconds (achieved)</td></tr><tr><td>Accuracy target</td><td>&gt;95% (monitoring)</td></tr><tr><td>Staff escalation rate</td><td>&lt;10% (measuring)</td></tr><tr><td>Common queries handled</td><td>Hours, insurance, wait times, services, locations</td></tr></tbody></table>
<p>The biggest win isn't the metrics — it's that front desk staff can focus on the patients standing in front of them instead of answering the phone to say "Yes, we're open until 8 PM."</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="handling-edge-cases">Handling Edge Cases<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#handling-edge-cases" class="hash-link" aria-label="Direct link to Handling Edge Cases" title="Direct link to Handling Edge Cases">​</a></h2>
<p>The system is designed to fail gracefully:</p>
<ul>
<li><strong>Unknown questions</strong> → Acknowledge the limitation, offer to connect with staff</li>
<li><strong>Medical advice requests</strong> → Firm redirect: "I can't provide medical advice, but our providers can help when you visit"</li>
<li><strong>Emotional/urgent situations</strong> → Immediate escalation to human staff</li>
<li><strong>Multi-language queries</strong> → Spanish support in development</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lessons-learned">Lessons Learned<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#lessons-learned" class="hash-link" aria-label="Direct link to Lessons Learned" title="Direct link to Lessons Learned">​</a></h2>
<p><strong>1. Context quality matters more than model quality.</strong> GPT-4 gives mediocre answers with mediocre context. Feed it accurate, current clinic data and it's excellent.</p>
<p><strong>2. Observability is not optional in healthcare AI.</strong> Langfuse paid for itself the first week when we caught a response that listed outdated holiday hours.</p>
<p><strong>3. Staff trust requires transparency.</strong> Showing clinical staff the Langfuse traces — letting them see exactly what the bot says — built confidence faster than any demo.</p>
<p><strong>4. Start narrow, expand carefully.</strong> We launched with just hours/location/insurance queries. Each new domain (wait times, services, booking) was added only after validating the previous one.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What's Next<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#whats-next" class="hash-link" aria-label="Direct link to What's Next" title="Direct link to What's Next">​</a></h2>
<ul>
<li><strong>Appointment booking integration</strong> — Let the chatbot actually schedule visits, not just answer questions about them</li>
<li><strong>Insurance verification</strong> — Pre-check coverage before the patient arrives</li>
<li><strong>Multi-location support</strong> — Scale across our clinic network with location-specific context</li>
<li><strong>Post-visit surveys</strong> — Automated follow-up to capture patient feedback</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-takeaway">The Takeaway<a href="https://jonroosevelt.com/blog/ai-patient-chatbot-urgent-care#the-takeaway" class="hash-link" aria-label="Direct link to The Takeaway" title="Direct link to The Takeaway">​</a></h2>
<p>Building an AI chatbot for healthcare isn't fundamentally different from building one for any industry — the technology stack is the same. What's different is the <strong>bar for reliability and auditability</strong>. In healthcare, a wrong answer about clinic hours is an inconvenience. A wrong answer about services or insurance could send a patient to the wrong place at the wrong time.</p>
<p>The combination of n8n for orchestration, GPT-4 for intelligence, and Langfuse for observability gives us the confidence to deploy AI in a clinical setting while maintaining the transparency that healthcare demands.</p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Healthcare" term="Healthcare"/>
        <category label="n8n" term="n8n"/>
        <category label="Workflow Automation" term="Workflow Automation"/>
        <category label="Observability" term="Observability"/>
        <category label="Chatbot" term="Chatbot"/>
        <category label="Patient Experience" term="Patient Experience"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The Delayed Prescription Strategy: How to Reduce Antibiotic Use 62% While Maintaining Patient Satisfaction]]></title>
        <id>https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care</id>
        <link href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Every urgent care provider knows the pressure. A parent brings in a child with an ear infection. The exam is ambiguous — it could be viral, could be bacterial. You know antibiotics probably won't help, but the parent is expecting a prescription. You have 30 seconds to make a decision before the next patient. So you prescribe. This pattern, multiplied across thousands of encounters daily, is why 46% of urgent care antibiotics are medically unnecessary — and why antibiotic resistance is one of the CDC's top public health threats.]]></summary>
        <content type="html"><![CDATA[<p>Every urgent care provider knows the pressure. A parent brings in a child with an ear infection. The exam is ambiguous — it could be viral, could be bacterial. You know antibiotics probably won't help, but the parent is expecting a prescription. You have 30 seconds to make a decision before the next patient. So you prescribe. This pattern, multiplied across thousands of encounters daily, is why 46% of urgent care antibiotics are medically unnecessary — and why antibiotic resistance is one of the CDC's top public health threats.</p>
<p><img decoding="async" loading="lazy" alt="Antibiotic Stewardship Strategy" src="https://jonroosevelt.com/assets/images/hero-banner-108e1cca6051d872f8c85867f097adb4.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<p>There's a better way. The delayed prescription strategy — supported by multiple Cochrane systematic reviews and real-world implementations — achieves a 62% reduction in antibiotic consumption while maintaining 86% patient satisfaction. This isn't theoretical. It's evidence-based, operationally practical, and legally defensible.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-antibiotic-pressure-problem">The Antibiotic Pressure Problem<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#the-antibiotic-pressure-problem" class="hash-link" aria-label="Direct link to The Antibiotic Pressure Problem" title="Direct link to The Antibiotic Pressure Problem">​</a></h2>
<p>Urgent care exists at the intersection of patient expectations and clinical reality. Unlike primary care physicians who have longitudinal relationships with families, urgent care providers see patients once, under time pressure, with limited follow-up mechanisms. This creates several compounding pressures:</p>
<p><strong>Patient expectations.</strong> Research shows that when patients expect an antibiotic, they're significantly more likely to receive one — regardless of clinical indication. One study found that perceived patient demand increased prescribing rates by 62%, even when providers knew the infection was likely viral.</p>
<p><strong>Time constraints.</strong> The average urgent care visit lasts 15-18 minutes. Explaining why antibiotics aren't needed, addressing concerns about symptom progression, and building trust takes time that many clinics can't afford.</p>
<p><strong>Defensive medicine.</strong> Providers worry about missing a bacterial infection, particularly in pediatric cases. The fear of a complication — or worse, a malpractice claim — pushes prescribing rates upward.</p>
<p><strong>Lack of follow-up infrastructure.</strong> Unlike primary care, urgent care rarely has robust systems for checking in on patients 48-72 hours later. This makes "watchful waiting" feel irresponsible.</p>
<p>The result? A 2018 Pew Trust analysis found that <strong>46% of antibiotics prescribed in urgent care settings are medically unnecessary</strong>. Respiratory infections account for the majority — conditions like acute bronchitis, viral pharyngitis, and non-specific upper respiratory infections where antibiotics provide no benefit and carry real risks.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-the-evidence-shows">What the Evidence Shows<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#what-the-evidence-shows" class="hash-link" aria-label="Direct link to What the Evidence Shows" title="Direct link to What the Evidence Shows">​</a></h2>
<p>The delayed prescription strategy has been rigorously studied. Cochrane — the gold standard for systematic reviews — analyzed this approach across multiple studies spanning 2017-2023. The findings are compelling.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-core-data">The Core Data<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#the-core-data" class="hash-link" aria-label="Direct link to The Core Data" title="Direct link to The Core Data">​</a></h3>
<p>When providers offer a delayed prescription (with instructions to fill it only if symptoms worsen or fail to improve after 2-3 days):</p>
<ul>
<li><strong>93% of immediate prescriptions get filled</strong> (standard practice)</li>
<li><strong>31% of delayed prescriptions get filled</strong> (delayed strategy)</li>
<li><strong>Net reduction: 62%</strong> in antibiotic consumption</li>
</ul>
<p>Critically, this reduction comes <strong>without compromising patient outcomes</strong>:</p>
<ul>
<li>No increase in complications or secondary infections</li>
<li>No increase in hospitalizations</li>
<li>86% of patients report satisfaction with delayed prescription approach</li>
<li>Return visit rates remain stable</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-it-works-psychologically">Why It Works Psychologically<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#why-it-works-psychologically" class="hash-link" aria-label="Direct link to Why It Works Psychologically" title="Direct link to Why It Works Psychologically">​</a></h3>
<p>The delayed prescription addresses the core anxieties on both sides of the exam table:</p>
<p><strong>For patients:</strong> They leave with a prescription in hand — proof that their concern was taken seriously and a safety net if symptoms worsen. This satisfies the psychological need for "something to show for the visit" without requiring them to actually consume antibiotics.</p>
<p><strong>For providers:</strong> They've ensured access to treatment if needed while avoiding unnecessary prescribing. The prescription serves as a backup plan, reducing the fear of missing a bacterial infection.</p>
<p><strong>For parents:</strong> They have control. Instead of being told "just wait and see," they're given agency: "You'll know in 48 hours if your child needs this. Here's exactly what to watch for."</p>
<p>The intervention works because it <strong>shifts the decision point</strong> from the high-pressure moment in the exam room to 2-3 days later at home, when the clinical picture is clearer and emotions have settled.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-three-tier-clinical-framework">The Three-Tier Clinical Framework<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#the-three-tier-clinical-framework" class="hash-link" aria-label="Direct link to The Three-Tier Clinical Framework" title="Direct link to The Three-Tier Clinical Framework">​</a></h2>
<p>Implementing delayed prescriptions requires clear clinical criteria. Not every infection is a candidate. Here's the decision framework used by successful urgent care networks:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tier-1-immediate-antibiotics">Tier 1: Immediate Antibiotics<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#tier-1-immediate-antibiotics" class="hash-link" aria-label="Direct link to Tier 1: Immediate Antibiotics" title="Direct link to Tier 1: Immediate Antibiotics">​</a></h3>
<p>Prescribe immediately when:</p>
<ul>
<li>Clear bacterial infection with high certainty (e.g., strep pharyngitis with positive rapid test)</li>
<li>High-risk patient populations (immunocompromised, elderly with comorbidities, infants under 6 months)</li>
<li>Severe symptoms requiring immediate treatment (high fever with systemic symptoms, spreading cellulitis, pneumonia with respiratory distress)</li>
<li>Clinical indicators of bacterial etiology (purulent discharge, specific exam findings)</li>
</ul>
<p><strong>Clinical examples:</strong></p>
<ul>
<li>Group A strep pharyngitis (positive rapid test)</li>
<li>Acute otitis media in child under 2 with severe ear pain and bulging tympanic membrane</li>
<li>Cellulitis with spreading erythema and lymphangitis</li>
<li>Community-acquired pneumonia with consolidation on imaging</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tier-2-delayed-prescription-the-sweet-spot">Tier 2: Delayed Prescription (The Sweet Spot)<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#tier-2-delayed-prescription-the-sweet-spot" class="hash-link" aria-label="Direct link to Tier 2: Delayed Prescription (The Sweet Spot)" title="Direct link to Tier 2: Delayed Prescription (The Sweet Spot)">​</a></h3>
<p>Offer delayed prescription when:</p>
<ul>
<li>Clinical uncertainty exists between viral and bacterial etiology</li>
<li>Mild to moderate symptoms without red flags</li>
<li>Self-limiting conditions that may benefit from antibiotics only if symptoms persist beyond natural resolution timeline</li>
<li>Patient or parent expresses strong desire for prescription as "backup"</li>
</ul>
<p><strong>Clinical examples:</strong></p>
<ul>
<li>Acute otitis media in child over 2 with unilateral infection and mild symptoms</li>
<li>Acute sinusitis with symptoms less than 7 days (before bacterial infection becomes likely)</li>
<li>Pharyngitis with negative rapid strep test but patient worried about progression</li>
<li>Uncomplicated urinary tract infection in low-risk adult with minimal symptoms</li>
</ul>
<p><strong>Instructions to patient:</strong></p>
<blockquote>
<p>"This is likely viral and will resolve on its own in 2-3 days. I'm giving you a prescription as a backup. <strong>Only fill it if:</strong></p>
<ul>
<li>Your symptoms get significantly worse in the next 48 hours</li>
<li>You're not improving at all by day 3</li>
<li>You develop new symptoms like high fever, severe pain, or spreading redness</li>
</ul>
<p>Most patients don't need to fill this prescription. We'll check in with you in 48 hours to see how you're doing."</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tier-3-no-antibiotics">Tier 3: No Antibiotics<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#tier-3-no-antibiotics" class="hash-link" aria-label="Direct link to Tier 3: No Antibiotics" title="Direct link to Tier 3: No Antibiotics">​</a></h3>
<p>Withhold prescription entirely when:</p>
<ul>
<li>Clear viral etiology (acute bronchitis, viral URI, most pharyngitis)</li>
<li>Conditions where antibiotics provide no benefit (viral gastroenteritis, influenza without secondary bacterial infection)</li>
<li>Patient education can effectively address concerns</li>
<li>Follow-up mechanisms are robust</li>
</ul>
<p><strong>Clinical examples:</strong></p>
<ul>
<li>Acute bronchitis in otherwise healthy adult (viral 95% of the time)</li>
<li>Common cold / viral URI</li>
<li>Influenza (treat with antivirals if indicated, not antibiotics)</li>
<li>Viral gastroenteritis</li>
</ul>
<p>The key is being able to confidently communicate: <em>"Antibiotics won't help this condition and may cause side effects. Here's what will actually make you feel better."</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-playbook">Implementation Playbook<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#implementation-playbook" class="hash-link" aria-label="Direct link to Implementation Playbook" title="Direct link to Implementation Playbook">​</a></h2>
<p>Evidence is one thing. Actually changing clinical behavior in a high-volume urgent care setting is another. Here's how successful implementations deploy the delayed prescription strategy operationally.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-emr-integration-build-the-infrastructure">1. EMR Integration: Build the Infrastructure<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#1-emr-integration-build-the-infrastructure" class="hash-link" aria-label="Direct link to 1. EMR Integration: Build the Infrastructure" title="Direct link to 1. EMR Integration: Build the Infrastructure">​</a></h3>
<p>The delayed prescription strategy fails if it adds cognitive load or friction. It needs to be easier to do the right thing than the wrong thing.</p>
<p><strong>EMR Template Setup:</strong></p>
<p>Create three smart order sets in your EMR:</p>
<p><strong>Template A: Immediate Antibiotic</strong></p>
<ul>
<li>Standard prescription workflow</li>
<li>Flags for allergy checking, dosing verification</li>
<li>Patient education materials on completing full course</li>
</ul>
<p><strong>Template B: Delayed Prescription</strong> (the critical one)</p>
<ul>
<li>Prescription written but marked "Delayed - Do Not Fill Immediately"</li>
<li>Auto-populated patient instructions with specific criteria for filling</li>
<li>Scheduled follow-up call/text at 48 hours</li>
<li>Documentation template with checkboxes for clinical reasoning</li>
</ul>
<p><strong>Template C: No Antibiotic</strong></p>
<ul>
<li>Symptom management recommendations (hydration, rest, NSAIDs, throat lozenges, etc.)</li>
<li>Red flag symptoms for return visit</li>
<li>Expected timeline for symptom resolution</li>
<li>Patient education materials on why antibiotics aren't indicated</li>
</ul>
<p><strong>Key EMR Features:</strong></p>
<ul>
<li>One-click access to all three templates from encounter screen</li>
<li>Auto-documentation of clinical reasoning for delayed prescriptions (for medico-legal protection)</li>
<li>Integration with pharmacy systems to flag delayed prescriptions clearly</li>
<li>Automated 48-hour follow-up task creation</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-patient-communication-materials">2. Patient Communication Materials<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#2-patient-communication-materials" class="hash-link" aria-label="Direct link to 2. Patient Communication Materials" title="Direct link to 2. Patient Communication Materials">​</a></h3>
<p><strong>Waiting Room Posters:</strong></p>
<p>Simple infographics explaining:</p>
<ul>
<li>Why most coughs, colds, and sore throats don't need antibiotics</li>
<li>Delayed prescriptions as an option</li>
<li>What antibiotics actually treat (and don't treat)</li>
</ul>
<p><strong>Example poster language:</strong></p>
<blockquote>
<p><strong>"Did you know?"</strong></p>
<ul>
<li>Most respiratory infections are caused by viruses</li>
<li>Antibiotics don't work on viruses</li>
<li>Your body fights off most infections in 5-7 days</li>
<li>Unnecessary antibiotics can cause harmful side effects and resistance</li>
</ul>
<p><strong>Your provider may give you a "delayed prescription"</strong> — a safety net prescription to fill only if your symptoms worsen or don't improve in 2-3 days.</p>
</blockquote>
<p><strong>Handout for Delayed Prescriptions:</strong></p>
<p>Every patient leaving with a delayed prescription receives a one-page, color-coded sheet:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">🟢 GREEN ZONE (You're Improving) — Don't fill the prescription</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Symptoms are the same or getting better</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- No new fever</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Energy level returning</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Eating/drinking normally</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">→ Continue symptom management. You're healing naturally.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🟡 YELLOW ZONE (Not Sure) — Call Us</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Symptoms not improving by day 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Mild new symptoms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Unsure if you're getting better</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">→ Call our nurse line: [PHONE]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🔴 RED ZONE (Fill Prescription or Come Back) — Action Needed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Symptoms significantly worse after 48 hours</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- New high fever (&amp;gt;102°F)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Severe pain</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Difficulty breathing or swallowing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Spreading redness/swelling</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">→ Fill the prescription AND call us. If severe, return immediately.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This traffic-light system makes the decision algorithm simple for patients.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-staff-training-and-scripts">3. Staff Training and Scripts<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#3-staff-training-and-scripts" class="hash-link" aria-label="Direct link to 3. Staff Training and Scripts" title="Direct link to 3. Staff Training and Scripts">​</a></h3>
<p>Front desk, nurses, and providers all need aligned messaging.</p>
<p><strong>Front Desk Script (when patient checks in):</strong></p>
<blockquote>
<p>"Just so you know, our providers follow evidence-based guidelines on antibiotics. If your infection is viral, the provider will explain why antibiotics won't help — but they'll give you a plan to feel better. Sometimes they'll give you a prescription to keep on hand, just in case."</p>
</blockquote>
<p>This sets expectations before the patient even enters the exam room.</p>
<p><strong>Provider Script (in exam room):</strong></p>
<p>For Tier 2 cases (delayed prescription candidates):</p>
<blockquote>
<p>"I've examined [patient/your child] carefully. Here's what I found: [clinical findings]. Based on this, I believe this is most likely viral, which means it will resolve on its own in 2-3 days without antibiotics.</p>
<p>However, I know there's always some uncertainty with these infections. So here's what I'm going to do: I'm writing you a prescription for an antibiotic as a backup. <strong>Don't fill it yet.</strong> If symptoms get worse over the next 48 hours or if you're not improving at all by day 3, then fill it and start taking it.</p>
<p>Most parents/patients find they don't need to fill this prescription because their child improves on their own. But this gives you a safety net and saves you a return trip if you do need it.</p>
<p>We'll also check in with you in two days to see how things are going. Does that plan make sense?"</p>
</blockquote>
<p><strong>Nurse Follow-Up Script (48-hour check-in):</strong></p>
<blockquote>
<p>"Hi, this is [Name] from [Urgent Care]. I'm calling to check on [patient] — you were seen two days ago for [condition] and given a delayed prescription. How are symptoms today?</p>
<p>[If improving:] Great! Sounds like you're healing well. You don't need to fill that prescription. Continue symptom management and call us if anything changes.</p>
<p>[If not improving:] Okay, it sounds like symptoms haven't improved. Go ahead and fill that prescription and start taking it today. If you get worse or develop new symptoms, give us a call right away."</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-pharmacy-coordination">4. Pharmacy Coordination<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#4-pharmacy-coordination" class="hash-link" aria-label="Direct link to 4. Pharmacy Coordination" title="Direct link to 4. Pharmacy Coordination">​</a></h3>
<p>Alert local pharmacies that your clinic is implementing delayed prescriptions. Work with them to:</p>
<ul>
<li>Flag delayed prescriptions in their system so they don't auto-fill or proactively call patients</li>
<li>Add patient instructions to prescription label: "Do not fill unless symptoms worsen after 48 hours"</li>
<li>Train pharmacy staff to ask: "Did your provider tell you to fill this right away or wait?" if a patient brings in a delayed prescription within 48 hours</li>
</ul>
<p>Some EMR-pharmacy integrations allow you to set a "do not dispense before [date]" flag.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-quality-metrics-dashboard">5. Quality Metrics Dashboard<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#5-quality-metrics-dashboard" class="hash-link" aria-label="Direct link to 5. Quality Metrics Dashboard" title="Direct link to 5. Quality Metrics Dashboard">​</a></h3>
<p>Track these metrics monthly to monitor success and identify opportunities:</p>
<table><thead><tr><th>Metric</th><th>Target</th><th>Purpose</th></tr></thead><tbody><tr><td>% of respiratory infections receiving immediate antibiotics</td><td>&lt;30%</td><td>Reduce overprescribing</td></tr><tr><td>% of respiratory infections receiving delayed prescriptions</td><td>30-40%</td><td>Appropriate middle tier</td></tr><tr><td>% of delayed prescriptions actually filled</td><td>&lt;35%</td><td>Confirms patient self-selection</td></tr><tr><td>Patient satisfaction scores (delayed prescription patients)</td><td>&gt;85%</td><td>Ensure acceptance</td></tr><tr><td>Return visit rate within 7 days</td><td>Baseline</td><td>Monitor for safety signal</td></tr><tr><td>Complication rate (pneumonia, hospitalization post-visit)</td><td>Baseline</td><td>Ensure no adverse outcomes</td></tr></tbody></table>
<p>Set up automated monthly reports from your EMR to track these without manual effort.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="addressing-staff-and-patient-concerns">Addressing Staff and Patient Concerns<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#addressing-staff-and-patient-concerns" class="hash-link" aria-label="Direct link to Addressing Staff and Patient Concerns" title="Direct link to Addressing Staff and Patient Concerns">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="staff-concerns">Staff Concerns<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#staff-concerns" class="hash-link" aria-label="Direct link to Staff Concerns" title="Direct link to Staff Concerns">​</a></h3>
<p><strong>"Patients will be angry if they don't get an antibiotic."</strong></p>
<p>Reality: Studies show 86% patient satisfaction with delayed prescriptions. Patients want certainty more than antibiotics. Giving them clear criteria and a backup plan satisfies this need.</p>
<p><strong>"It takes too much time to explain."</strong></p>
<p>Reality: The conversation takes 90 seconds with a good script. Compare this to the time spent dealing with an angry patient, adverse antibiotic reactions, or follow-up calls from confused patients.</p>
<p><strong>"What if I miss a bacterial infection and the patient gets worse?"</strong></p>
<p>Reality: The delayed prescription ensures patients have access to antibiotics if needed. Clinical decision-making is documented. You're practicing evidence-based medicine, which is the best legal protection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="patient-concerns">Patient Concerns<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#patient-concerns" class="hash-link" aria-label="Direct link to Patient Concerns" title="Direct link to Patient Concerns">​</a></h3>
<p><strong>"But I always need antibiotics for these infections."</strong></p>
<p>Response: "I hear that. Many patients think their infections require antibiotics because that's what's worked in the past. But research shows that most of these infections resolve on their own — the antibiotics you took were just along for the ride. Let's try this approach, and if symptoms worsen, you have the prescription ready."</p>
<p><strong>"I don't want to come back if this gets worse."</strong></p>
<p>Response: "That's exactly why I'm giving you this prescription now. You won't need to come back. If you meet the criteria we discussed, you can fill this and start taking it. We'll also call you in two days to check in."</p>
<p><strong>"I can't afford to miss work if this doesn't get better."</strong></p>
<p>Response: "I understand completely. That's why this approach includes a safety net. If you're not improving in 48 hours, you'll start the antibiotic immediately without needing another visit. And most patients find they're better within 2-3 days without needing the antibiotic at all."</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-to-track-success">Metrics to Track Success<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#metrics-to-track-success" class="hash-link" aria-label="Direct link to Metrics to Track Success" title="Direct link to Metrics to Track Success">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="leading-indicators-monitor-weekly">Leading Indicators (Monitor Weekly)<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#leading-indicators-monitor-weekly" class="hash-link" aria-label="Direct link to Leading Indicators (Monitor Weekly)" title="Direct link to Leading Indicators (Monitor Weekly)">​</a></h3>
<ol>
<li><strong>Delayed prescription adoption rate</strong> — What % of eligible cases receive delayed prescriptions?</li>
<li><strong>Template utilization</strong> — Are providers using the EMR smart order sets?</li>
<li><strong>Follow-up call completion</strong> — Are 48-hour check-ins happening consistently?</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lagging-indicators-monitor-monthly">Lagging Indicators (Monitor Monthly)<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#lagging-indicators-monitor-monthly" class="hash-link" aria-label="Direct link to Lagging Indicators (Monitor Monthly)" title="Direct link to Lagging Indicators (Monitor Monthly)">​</a></h3>
<ol start="4">
<li><strong>Prescription fill rate</strong> — What % of delayed prescriptions are actually filled? (Target: &lt;35%)</li>
<li><strong>Patient satisfaction</strong> — NPS or satisfaction scores for delayed prescription patients (Target: &gt;85%)</li>
<li><strong>Antibiotic prescribing rate</strong> — Total antibiotic prescriptions per respiratory infection encounter (Target: 30-40% reduction over 6 months)</li>
<li><strong>Complication rate</strong> — Incidence of pneumonia, hospitalization, or severe adverse outcomes post-visit (should remain stable)</li>
<li><strong>Return visit rate</strong> — % of patients returning within 7 days (should remain stable or decrease)</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quality-assurance-reviews">Quality Assurance Reviews<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#quality-assurance-reviews" class="hash-link" aria-label="Direct link to Quality Assurance Reviews" title="Direct link to Quality Assurance Reviews">​</a></h3>
<p>Monthly chart audits:</p>
<ul>
<li>Review 10-15 delayed prescription encounters</li>
<li>Verify clinical reasoning was documented</li>
<li>Confirm patient received education materials</li>
<li>Check that 48-hour follow-up occurred</li>
<li>Review cases where delayed prescriptions were filled — were they appropriate?</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="legal-and-malpractice-considerations">Legal and Malpractice Considerations<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#legal-and-malpractice-considerations" class="hash-link" aria-label="Direct link to Legal and Malpractice Considerations" title="Direct link to Legal and Malpractice Considerations">​</a></h2>
<p><strong>The short answer:</strong> Delayed prescriptions are evidence-based practice and legally defensible. They reduce your malpractice risk compared to overprescribing.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="documentation-is-key">Documentation Is Key<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#documentation-is-key" class="hash-link" aria-label="Direct link to Documentation Is Key" title="Direct link to Documentation Is Key">​</a></h3>
<p>When issuing a delayed prescription, document:</p>
<ol>
<li><strong>Clinical findings</strong> — Specific exam findings supporting viral etiology or clinical uncertainty</li>
<li><strong>Reasoning</strong> — "Given mild symptoms, unilateral infection, and age &gt;2 years, delayed prescription offered per evidence-based guidelines"</li>
<li><strong>Patient education</strong> — "Patient instructed to fill prescription only if symptoms worsen or fail to improve after 48-72 hours. Provided written instructions and criteria for filling prescription. Patient verbalized understanding."</li>
<li><strong>Follow-up plan</strong> — "48-hour follow-up call scheduled. Patient instructed on red flag symptoms requiring immediate return."</li>
</ol>
<p>This documentation shows:</p>
<ul>
<li>You performed appropriate clinical assessment</li>
<li>You followed evidence-based guidelines</li>
<li>You provided clear patient instructions</li>
<li>You established appropriate follow-up</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="legal-precedent">Legal Precedent<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#legal-precedent" class="hash-link" aria-label="Direct link to Legal Precedent" title="Direct link to Legal Precedent">​</a></h3>
<p>There is no case law showing increased malpractice liability from delayed prescribing. In fact, overprescribing antibiotics carries its own legal risks:</p>
<ul>
<li>Adverse reactions (C. difficile colitis, allergic reactions, drug interactions)</li>
<li>Contribution to antibiotic resistance (a recognized public health harm)</li>
<li>Failure to follow evidence-based guidelines (standard of care)</li>
</ul>
<p>The CDC, American Academy of Pediatrics, and Infectious Diseases Society of America all support antibiotic stewardship strategies including delayed prescribing.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-to-consult-legalcompliance">When to Consult Legal/Compliance<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#when-to-consult-legalcompliance" class="hash-link" aria-label="Direct link to When to Consult Legal/Compliance" title="Direct link to When to Consult Legal/Compliance">​</a></h3>
<p>Before implementation:</p>
<ul>
<li>Review your malpractice insurance coverage — confirm that following evidence-based guidelines is covered (it always is)</li>
<li>Notify your malpractice carrier of the new protocol (they'll likely be supportive)</li>
<li>Have your clinical leadership and legal team review the delayed prescription templates and patient education materials</li>
<li>Ensure your EMR documentation captures the required elements</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-implementation-timeline">The Implementation Timeline<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#the-implementation-timeline" class="hash-link" aria-label="Direct link to The Implementation Timeline" title="Direct link to The Implementation Timeline">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="month-1-design-and-approval">Month 1: Design and Approval<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#month-1-design-and-approval" class="hash-link" aria-label="Direct link to Month 1: Design and Approval" title="Direct link to Month 1: Design and Approval">​</a></h3>
<ul>
<li>Assemble stakeholder team (clinical leadership, operations, IT, quality improvement)</li>
<li>Draft delayed prescription protocol with decision criteria</li>
<li>Create EMR templates</li>
<li>Design patient education materials</li>
<li>Secure leadership approval</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="month-2-training-and-pilot">Month 2: Training and Pilot<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#month-2-training-and-pilot" class="hash-link" aria-label="Direct link to Month 2: Training and Pilot" title="Direct link to Month 2: Training and Pilot">​</a></h3>
<ul>
<li>Train all clinical staff on protocol, scripts, and EMR workflow</li>
<li>Pilot with 3-5 enthusiastic providers willing to test the approach</li>
<li>Collect feedback and iterate on templates, scripts, and materials</li>
<li>Begin tracking metrics</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="month-3-full-rollout">Month 3: Full Rollout<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#month-3-full-rollout" class="hash-link" aria-label="Direct link to Month 3: Full Rollout" title="Direct link to Month 3: Full Rollout">​</a></h3>
<ul>
<li>Deploy to all providers</li>
<li>Launch patient-facing communications (posters, website, social media)</li>
<li>Coordinate with local pharmacies</li>
<li>Begin 48-hour follow-up calls</li>
<li>Monitor metrics weekly</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="months-4-6-optimization">Months 4-6: Optimization<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#months-4-6-optimization" class="hash-link" aria-label="Direct link to Months 4-6: Optimization" title="Direct link to Months 4-6: Optimization">​</a></h3>
<ul>
<li>Monthly quality reviews</li>
<li>Adjust templates based on provider feedback</li>
<li>Share success stories and data with team</li>
<li>Celebrate wins (antibiotic reduction, high satisfaction scores)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="month-6-sustain-and-scale">Month 6+: Sustain and Scale<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#month-6-sustain-and-scale" class="hash-link" aria-label="Direct link to Month 6+: Sustain and Scale" title="Direct link to Month 6+: Sustain and Scale">​</a></h3>
<ul>
<li>Quarterly audits to ensure sustained adherence</li>
<li>Onboard new providers with standardized training</li>
<li>Publish results internally to reinforce success</li>
<li>Consider expanding to other infection types (UTIs, skin infections)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-takeaway">The Takeaway<a href="https://jonroosevelt.com/blog/delayed-prescription-antibiotic-stewardship-urgent-care#the-takeaway" class="hash-link" aria-label="Direct link to The Takeaway" title="Direct link to The Takeaway">​</a></h2>
<p>The delayed prescription strategy is a rare win-win-win: better clinical outcomes, higher patient satisfaction, and reduced antibiotic resistance. It works because it addresses the psychological and operational realities of urgent care while staying grounded in evidence.</p>
<p>The barrier isn't the science — the Cochrane reviews settled that question. The barrier is implementation: building the EMR infrastructure, training staff, creating patient materials, and tracking metrics.</p>
<p>But for urgent care networks serious about antibiotic stewardship, the playbook is clear. Start with the three-tier framework. Build it into your EMR. Train your team. Track your metrics. In six months, you'll have cut unnecessary antibiotic use by more than half while maintaining the patient trust and satisfaction that keeps your clinics thriving.</p>
<p>The question isn't whether delayed prescriptions work. It's whether you're willing to implement them.</p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Healthcare" term="Healthcare"/>
        <category label="Urgent Care" term="Urgent Care"/>
        <category label="Clinical Operations" term="Clinical Operations"/>
        <category label="Quality Improvement" term="Quality Improvement"/>
        <category label="Evidence-Based Medicine" term="Evidence-Based Medicine"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Why Urgent Care Centers Are Ditching Walk-In-Only: The Hybrid Scheduling Revolution]]></title>
        <id>https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care</id>
        <link href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[The urgent care industry is undergoing a quiet revolution in how patients are seen. The traditional walk-in-only model — once the defining feature of urgent care — is giving way to hybrid scheduling systems that combine appointments with walk-in availability. The results are striking: clinics adopting this approach are seeing wait times drop by over 50% while patient satisfaction climbs to near-perfect ratings.]]></summary>
        <content type="html"><![CDATA[<p>The urgent care industry is undergoing a quiet revolution in how patients are seen. The traditional walk-in-only model — once the defining feature of urgent care — is giving way to hybrid scheduling systems that combine appointments with walk-in availability. The results are striking: clinics adopting this approach are seeing wait times drop by over 50% while patient satisfaction climbs to near-perfect ratings.</p>
<p><img decoding="async" loading="lazy" alt="Hybrid Scheduling in Urgent Care" src="https://jonroosevelt.com/assets/images/hero-banner-95898a6730ecba0ab8d484e523900e17.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem-with-walk-in-only">The Problem with Walk-In-Only<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#the-problem-with-walk-in-only" class="hash-link" aria-label="Direct link to The Problem with Walk-In-Only" title="Direct link to The Problem with Walk-In-Only">​</a></h2>
<p>Walk-in urgent care clinics face a fundamental operational challenge: demand is unpredictable. A sudden rush of 10 patients at 2 PM overwhelms staff, while 4 PM might be completely dead. This "bunching" effect leads to:</p>
<ul>
<li>Long, unpredictable wait times during surges</li>
<li>Idle staff and empty rooms during lulls</li>
<li>Frustrated patients who have no idea when they'll be seen</li>
<li>Lower satisfaction scores despite quality clinical care</li>
</ul>
<p>Research from Ontario found that patients at walk-in clinics reported <strong>significantly lower satisfaction</strong> with their waiting experience compared to scheduled appointment settings — even when the clinical care quality was identical.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-hybrid-model-best-of-both-worlds">The Hybrid Model: Best of Both Worlds<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#the-hybrid-model-best-of-both-worlds" class="hash-link" aria-label="Direct link to The Hybrid Model: Best of Both Worlds" title="Direct link to The Hybrid Model: Best of Both Worlds">​</a></h2>
<p>MD Today Urgent Care in San Diego pioneered a compelling approach: they <strong>limited walk-ins to two per hour</strong> and filled remaining slots with scheduled appointments. The results were dramatic:</p>
<ul>
<li>Average wait times dropped from <strong>39 minutes (walk-ins) to 16 minutes (scheduled patients)</strong> — a 59% reduction</li>
<li>Patient ratings climbed to <strong>4.8 out of 5 stars</strong></li>
<li>Overall volume increased without proportional wait time increases</li>
</ul>
<p>The key insight is that scheduling doesn't mean turning away patients. It means <strong>giving patients options</strong> — walk in now or reserve a spot and skip the wait.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-patients-actually-want">What Patients Actually Want<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#what-patients-actually-want" class="hash-link" aria-label="Direct link to What Patients Actually Want" title="Direct link to What Patients Actually Want">​</a></h2>
<p>Industry data reveals a surprising priority shift. When patients choose an urgent care provider, the #1 factor is <strong>"appointments available right now"</strong> — ranking above bedside manner, insurance acceptance, or even location. Additionally:</p>
<ul>
<li><strong>54% of patients</strong> say online scheduling or check-in is "very important" in choosing a clinic</li>
<li>Patients who can reserve a spot return more frequently than those who can't</li>
<li>Wait time perception is the single largest driver of satisfaction scores</li>
</ul>
<p>Patients don't just want access to care. They want <strong>certainty</strong> about when they'll receive it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-what-works">Implementation: What Works<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#implementation-what-works" class="hash-link" aria-label="Direct link to Implementation: What Works" title="Direct link to Implementation: What Works">​</a></h2>
<p>Based on operational research and real-world implementations, here's what successful hybrid clinics do:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-start-with-buffer-slots">1. Start with Buffer Slots<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#1-start-with-buffer-slots" class="hash-link" aria-label="Direct link to 1. Start with Buffer Slots" title="Direct link to 1. Start with Buffer Slots">​</a></h3>
<p>Don't eliminate walk-ins entirely. Reserve 1-2 slots per hour specifically for unscheduled patients. This maintains the urgent care promise of "come as you are" while bringing order to the rest of the schedule.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-deploy-digital-queue-management">2. Deploy Digital Queue Management<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#2-deploy-digital-queue-management" class="hash-link" aria-label="Direct link to 2. Deploy Digital Queue Management" title="Direct link to 2. Deploy Digital Queue Management">​</a></h3>
<p>Invest in technology that shows patients their place in line. When patients can see "2 people ahead of you" or receive text updates, the perceived wait shrinks dramatically. The uncertainty is what makes waiting painful, not the time itself.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-train-staff-on-expectation-setting">3. Train Staff on Expectation Setting<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#3-train-staff-on-expectation-setting" class="hash-link" aria-label="Direct link to 3. Train Staff on Expectation Setting" title="Direct link to 3. Train Staff on Expectation Setting">​</a></h3>
<p>Front desk staff need consistent scripts: <em>"We'll get you in as soon as possible, but we do have some patients with reserved times this afternoon."</em> Empathy plus transparency prevents most complaints before they start.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-use-data-to-flex-the-schedule">4. Use Data to Flex the Schedule<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#4-use-data-to-flex-the-schedule" class="hash-link" aria-label="Direct link to 4. Use Data to Flex the Schedule" title="Direct link to 4. Use Data to Flex the Schedule">​</a></h3>
<p>Historical patterns reveal that Mondays at 5 PM are always slammed while Wednesdays at 2 PM are quiet. Adjust the appointment-to-walkin ratio dynamically based on these patterns.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-offer-save-my-spot-virtual-queuing">5. Offer "Save My Spot" Virtual Queuing<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#5-offer-save-my-spot-virtual-queuing" class="hash-link" aria-label="Direct link to 5. Offer &quot;Save My Spot&quot; Virtual Queuing" title="Direct link to 5. Offer &quot;Save My Spot&quot; Virtual Queuing">​</a></h3>
<p>The most innovative approach isn't traditional appointments at all — it's virtual waiting. Patients go online, claim a spot in line, and arrive when their turn is near. They're told it's not a guaranteed appointment, but the clinic aims to start within 15 minutes of arrival.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-telemedicine-escape-valve">The Telemedicine Escape Valve<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#the-telemedicine-escape-valve" class="hash-link" aria-label="Direct link to The Telemedicine Escape Valve" title="Direct link to The Telemedicine Escape Valve">​</a></h2>
<p>One emerging pattern: using telehealth as overflow capacity. When walk-in demand exceeds what the physical clinic can handle, offer some patients a video visit immediately. Patients with minor issues often prefer resolving things virtually rather than waiting in a lobby. This creates a <strong>parallel queue</strong> — one physical, one virtual — with staff flexing between them as demand dictates.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-bottom-line">The Bottom Line<a href="https://jonroosevelt.com/blog/hybrid-scheduling-urgent-care#the-bottom-line" class="hash-link" aria-label="Direct link to The Bottom Line" title="Direct link to The Bottom Line">​</a></h2>
<p>The walk-in-only model isn't dead, but it's no longer the default. Clinics that embrace hybrid scheduling are seeing measurable improvements in both operational efficiency and patient satisfaction. The common thread: <strong>give patients certainty about when they'll be seen, while maintaining the flexibility to handle whoever walks through the door.</strong></p>
<p>The operational complexity is real, but the payoff is clear. In a market where patients have more choices than ever, the clinic that respects their time wins.</p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Healthcare" term="Healthcare"/>
        <category label="Operations" term="Operations"/>
        <category label="Urgent Care" term="Urgent Care"/>
        <category label="Scheduling" term="Scheduling"/>
        <category label="Patient Experience" term="Patient Experience"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Machiavelli Was Right: 8 Strategic Principles Every Leader Should Understand]]></title>
        <id>https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders</id>
        <link href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Niccolo Machiavelli has been misunderstood for 500 years. His name has become synonymous with manipulation and ruthlessness, but his actual writings contain some of the most pragmatic leadership insights ever recorded. Strip away the historical drama, and what remains is a framework for understanding why good intentions alone don't produce good outcomes — and what effective leaders do differently.]]></summary>
        <content type="html"><![CDATA[<p>Niccolo Machiavelli has been misunderstood for 500 years. His name has become synonymous with manipulation and ruthlessness, but his actual writings contain some of the most pragmatic leadership insights ever recorded. Strip away the historical drama, and what remains is a framework for understanding why good intentions alone don't produce good outcomes — and what effective leaders do differently.</p>
<p><img decoding="async" loading="lazy" alt="Machiavelli&amp;#39;s Strategic Principles" src="https://jonroosevelt.com/assets/images/hero-banner-9013a227e279bba9df402357bb0105b6.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-core-tension">The Core Tension<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#the-core-tension" class="hash-link" aria-label="Direct link to The Core Tension" title="Direct link to The Core Tension">​</a></h2>
<p>Machiavelli's central insight isn't that leaders should be evil. It's that <strong>pure goodness, applied without strategic awareness, often destroys the very things it aims to protect</strong>. A leader who refuses to make hard decisions in the name of being "nice" may end up causing more harm than the leader who makes the difficult call early.</p>
<p>This isn't an argument for amorality. It's an argument for <strong>moral pragmatism</strong> — understanding that the relationship between intentions and outcomes is far more complex than we'd like to believe.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-strategic-principles-for-modern-leaders">8 Strategic Principles for Modern Leaders<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#8-strategic-principles-for-modern-leaders" class="hash-link" aria-label="Direct link to 8 Strategic Principles for Modern Leaders" title="Direct link to 8 Strategic Principles for Modern Leaders">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-understand-the-difference-between-idealism-and-effectiveness">1. Understand the Difference Between Idealism and Effectiveness<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#1-understand-the-difference-between-idealism-and-effectiveness" class="hash-link" aria-label="Direct link to 1. Understand the Difference Between Idealism and Effectiveness" title="Direct link to 1. Understand the Difference Between Idealism and Effectiveness">​</a></h3>
<p>Machiavelli observed that leaders who governed according to how things <em>should</em> be rather than how things <em>are</em> consistently failed. Modern translation: strategy must be grounded in reality, not in how you wish your market, team, or competitors behaved.</p>
<p><strong>Application</strong>: Before making any strategic decision, ask: "Am I responding to the situation as it actually is, or as I wish it were?"</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-the-cost-of-inaction-is-usually-higher-than-the-cost-of-action">2. The Cost of Inaction is Usually Higher Than the Cost of Action<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#2-the-cost-of-inaction-is-usually-higher-than-the-cost-of-action" class="hash-link" aria-label="Direct link to 2. The Cost of Inaction is Usually Higher Than the Cost of Action" title="Direct link to 2. The Cost of Inaction is Usually Higher Than the Cost of Action">​</a></h3>
<p>One of Machiavelli's most consistent themes is that <strong>delayed decisions compound problems</strong>. A leader who avoids a difficult conversation today creates a crisis next quarter. A business that delays a necessary pivot burns more runway than the pivot would have cost.</p>
<p><strong>Application</strong>: When facing a hard decision, calculate the cost of delay. What gets worse if you wait?</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-consistency-builds-trust-more-than-kindness">3. Consistency Builds Trust More Than Kindness<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#3-consistency-builds-trust-more-than-kindness" class="hash-link" aria-label="Direct link to 3. Consistency Builds Trust More Than Kindness" title="Direct link to 3. Consistency Builds Trust More Than Kindness">​</a></h3>
<p>Machiavelli argued that a leader who is consistently firm earns more respect and loyalty than one who is inconsistently generous. People can adapt to strict rules; they can't adapt to unpredictability.</p>
<p><strong>Application</strong>: Set clear expectations and hold to them. Inconsistent enforcement of standards — being lenient one day and strict the next — erodes team trust faster than being consistently demanding.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-study-how-power-actually-works-not-how-its-described">4. Study How Power Actually Works, Not How It's Described<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#4-study-how-power-actually-works-not-how-its-described" class="hash-link" aria-label="Direct link to 4. Study How Power Actually Works, Not How It's Described" title="Direct link to 4. Study How Power Actually Works, Not How It's Described">​</a></h3>
<p>Society has narratives about leadership that don't match reality. "The best idea wins" isn't how decisions get made in most organizations. Understanding informal power structures, incentive alignment, and stakeholder dynamics is as important as having the right strategy.</p>
<p><strong>Application</strong>: Map the actual decision-making process in your organization. Who influences whom? What are the unstated criteria for success?</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-adaptability-is-more-valuable-than-virtue">5. Adaptability is More Valuable Than Virtue<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#5-adaptability-is-more-valuable-than-virtue" class="hash-link" aria-label="Direct link to 5. Adaptability is More Valuable Than Virtue" title="Direct link to 5. Adaptability is More Valuable Than Virtue">​</a></h3>
<p>Machiavelli noted that leaders who succeeded in one era often failed in the next because they couldn't change their approach. What worked in peacetime didn't work in crisis. What worked in growth mode didn't work in contraction.</p>
<p><strong>Application</strong>: Build flexibility into your leadership style. The approach that earned you your current role may not be what's needed in your next challenge.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-perception-shapes-reality">6. Perception Shapes Reality<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#6-perception-shapes-reality" class="hash-link" aria-label="Direct link to 6. Perception Shapes Reality" title="Direct link to 6. Perception Shapes Reality">​</a></h3>
<p>Whether we like it or not, how actions are perceived matters as much as the actions themselves. A leader who makes the right call but communicates it poorly may achieve worse outcomes than one who makes a mediocre call but brings people along.</p>
<p><strong>Application</strong>: Consider the narrative around your decisions. Communication isn't just informing — it's shaping understanding and building alignment.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-strong-foundations-enable-bold-action">7. Strong Foundations Enable Bold Action<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#7-strong-foundations-enable-bold-action" class="hash-link" aria-label="Direct link to 7. Strong Foundations Enable Bold Action" title="Direct link to 7. Strong Foundations Enable Bold Action">​</a></h3>
<p>Machiavelli repeatedly emphasized that leaders who inherited power without building their own foundation were the most vulnerable. Translated to business: organizations that grow rapidly without operational foundations collapse under stress.</p>
<p><strong>Application</strong>: Before pursuing aggressive growth or bold strategy, ensure your operational infrastructure can support it. Revenue without systems is fragile.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-know-when-conventional-morality-is-a-constraint-vs-a-guide">8. Know When Conventional Morality is a Constraint vs. a Guide<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#8-know-when-conventional-morality-is-a-constraint-vs-a-guide" class="hash-link" aria-label="Direct link to 8. Know When Conventional Morality is a Constraint vs. a Guide" title="Direct link to 8. Know When Conventional Morality is a Constraint vs. a Guide">​</a></h3>
<p>The most nuanced of Machiavelli's principles: there are moments when following the expected path leads to worse outcomes for everyone. A leader who fires a toxic high-performer is being "mean" to one person and compassionate to the entire team.</p>
<p><strong>Application</strong>: When facing ethical complexity, expand the frame. Whose interests are you optimizing for? The individual in front of you, or the broader group you're responsible for?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-ethical-boundary">The Ethical Boundary<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#the-ethical-boundary" class="hash-link" aria-label="Direct link to The Ethical Boundary" title="Direct link to The Ethical Boundary">​</a></h2>
<p>Machiavelli's principles are not a license for manipulation or self-serving behavior. The framework only works when applied in service of something larger than personal gain. A leader who uses these principles purely for self-aggrandizement isn't being strategic — they're being corrupt.</p>
<p>The distinction is purpose: Are you making hard calls because they serve the mission, or because they serve your ego?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-matters-now">Why This Matters Now<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#why-this-matters-now" class="hash-link" aria-label="Direct link to Why This Matters Now" title="Direct link to Why This Matters Now">​</a></h2>
<p>Modern leadership culture often swings between two extremes: toxic hustle culture that glorifies ruthlessness, and a kind of performative compassion that avoids difficult realities. Machiavelli offers a third path — one that takes both human complexity and practical outcomes seriously.</p>
<p>The leaders I most respect aren't the nicest or the toughest. They're the ones who understand the situation clearly, make decisions based on what will actually work, and take responsibility for the consequences. That's not cynicism. That's maturity.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-reading">Further Reading<a href="https://jonroosevelt.com/blog/machiavelli-strategic-principles-modern-leaders#further-reading" class="hash-link" aria-label="Direct link to Further Reading" title="Direct link to Further Reading">​</a></h2>
<ul>
<li><em>The Prince</em> by Niccolo Machiavelli — shorter and more accessible than its reputation suggests</li>
<li><em>Discourses on Livy</em> — Machiavelli's longer, more nuanced work on republican governance</li>
<li><em>The 48 Laws of Power</em> by Robert Greene — modern application (though more cynical than Machiavelli himself)</li>
<li><em>Leadership and Self-Deception</em> by The Arbinger Institute — the complementary perspective on why self-awareness matters</li>
</ul>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Philosophy" term="Philosophy"/>
        <category label="Leadership" term="Leadership"/>
        <category label="Operations" term="Operations"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How I Built a $2,300/Year RAG System That Rivals $40K OpenAI Solutions]]></title>
        <id>https://jonroosevelt.com/blog/rag-system-cost-savings</id>
        <link href="https://jonroosevelt.com/blog/rag-system-cost-savings"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In October 2025, I deployed a production RAG system that would have cost $39,600 annually using OpenAI's APIs. My actual cost? $2,300 per year. That's 94% cost savings while maintaining comparable performance.]]></summary>
        <content type="html"><![CDATA[<p>In October 2025, I deployed a production RAG system that would have cost $39,600 annually using OpenAI's APIs. My actual cost? $2,300 per year. That's 94% cost savings while maintaining comparable performance.</p>
<p>This isn't a proof-of-concept running on a laptop. It's a production system processing thousands of documents with sub-3-second query latency, deployed on AWS infrastructure, and serving real business needs.</p>
<p>Here's how I did it—and why the economics of RAG systems are fundamentally changing.</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-cost-problem-nobody-talks-about">The Cost Problem Nobody Talks About<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#the-cost-problem-nobody-talks-about" class="hash-link" aria-label="Direct link to The Cost Problem Nobody Talks About" title="Direct link to The Cost Problem Nobody Talks About">​</a></h2>
<p>Let's start with the uncomfortable truth: most production RAG systems are expensive to run at scale.</p>
<p>I've watched teams prototype beautiful RAG solutions, get excited about the results, and then hit a wall when they try to scale to production. The conversation usually goes like this:</p>
<p><strong>Engineering:</strong> "We built an amazing RAG system that answers complex questions across our entire knowledge base."</p>
<p><strong>Finance:</strong> "Great! What does it cost to run?"</p>
<p><strong>Engineering:</strong> "Well... about $3,300 per month. Maybe $3,800 during peak usage."</p>
<p><strong>Finance:</strong> "That's $40,000+ annually for a chatbot?"</p>
<p>And the project gets shelved.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-real-economics-of-api-based-rag">The Real Economics of API-Based RAG<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#the-real-economics-of-api-based-rag" class="hash-link" aria-label="Direct link to The Real Economics of API-Based RAG" title="Direct link to The Real Economics of API-Based RAG">​</a></h3>
<p>Let me break down the actual costs for a typical enterprise RAG system processing 50,000 documents with 1,000 queries per day:</p>
<p><strong>OpenAI API Approach:</strong></p>
<ul>
<li>GPT-4 for document processing &amp; entity extraction: $1,500/month</li>
<li>GPT-4 for query responses: $800/month</li>
<li>Embedding API (text-embedding-ada-002): $200/month</li>
<li>Vector database (managed service like Pinecone): $300/month</li>
<li>Graph database (Neo4j Aura for entity relationships): $500/month</li>
<li><strong>Total: $3,300/month or $39,600/year</strong></li>
</ul>
<p>Every query you add increases costs. Every document you index adds to the bill. The pricing model is fundamentally at odds with the goal of building comprehensive knowledge systems.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-alternative-local-slms--smart-architecture">The Alternative: Local SLMs + Smart Architecture<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#the-alternative-local-slms--smart-architecture" class="hash-link" aria-label="Direct link to The Alternative: Local SLMs + Smart Architecture" title="Direct link to The Alternative: Local SLMs + Smart Architecture">​</a></h2>
<p>In October 2025, I deployed a different approach using Phi-4 and LightRAG—a graph-based RAG framework designed for multi-hop reasoning.</p>
<p><strong>Self-Hosted Infrastructure:</strong></p>
<ul>
<li>Hardware: One GPU server ($6,000 one-time)</li>
<li>Operating costs: ~$190/month ($2,300/year)</li>
<li><strong>Total year one: $8,300</strong></li>
<li><strong>Ongoing annual cost: $2,300</strong></li>
</ul>
<p><strong>Break-even point: 2.3 months</strong></p>
<p>After that initial period, I'm saving $37,300 annually compared to the OpenAI approach. Over three years, the total cost of ownership is $12,900—a 67% reduction.</p>
<p>But cost is just one dimension. The real value comes from what this architecture enables.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-deep-dive-multi-storage-graph-rag">Architecture Deep Dive: Multi-Storage Graph RAG<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#architecture-deep-dive-multi-storage-graph-rag" class="hash-link" aria-label="Direct link to Architecture Deep Dive: Multi-Storage Graph RAG" title="Direct link to Architecture Deep Dive: Multi-Storage Graph RAG">​</a></h2>
<p>The system uses four specialized storage components, each optimized for specific tasks:</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-four-storage-systems">Why Four Storage Systems?<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#why-four-storage-systems" class="hash-link" aria-label="Direct link to Why Four Storage Systems?" title="Direct link to Why Four Storage Systems?">​</a></h3>
<p>When I first examined LightRAG, my instinct was to simplify. "Surely we don't need PostgreSQL AND Neo4j AND Redis," I thought. I tried running with just PostgreSQL. Failed. Tried with just Neo4j. Also failed.</p>
<p>Each storage layer serves a distinct, non-overlapping purpose:</p>
<p><strong>PostgreSQL with pgvector</strong> handles three critical functions:</p>
<ul>
<li>Vector embeddings for semantic similarity search</li>
<li>Document metadata and content storage</li>
<li>Processing status tracking with atomic updates</li>
</ul>
<p><strong>Neo4j</strong> stores the knowledge graph—the secret weapon for multi-hop reasoning. When a user asks "What security measures protect the patient data in our healthcare platform?", answering requires traversing entity relationships: Healthcare Platform → Uses Technology X → Protected By Security Measure Y. Neo4j makes these multi-hop queries fast and accurate.</p>
<p><strong>Redis</strong> provides two essential services:</p>
<ul>
<li>Response caching (60% reduction in redundant LLM calls)</li>
<li>Processing queue management for asynchronous document indexing</li>
</ul>
<p><strong>Phi-4 via Ollama</strong> is your local language model. 14 billion parameters, capable of handling complex entity extraction and query synthesis, running entirely on your infrastructure with zero per-token costs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graph-based-rag-the-performance-multiplier">Graph-Based RAG: The Performance Multiplier<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#graph-based-rag-the-performance-multiplier" class="hash-link" aria-label="Direct link to Graph-Based RAG: The Performance Multiplier" title="Direct link to Graph-Based RAG: The Performance Multiplier">​</a></h3>
<p>Traditional RAG systems use simple vector similarity: find chunks that match the query, feed them to an LLM, generate a response. This works for straightforward questions but fails for complex, multi-hop reasoning.</p>
<p>LightRAG implements graph-based RAG:</p>
<ol>
<li><strong>Entity Extraction:</strong> During indexing, Phi-4 identifies entities (people, technologies, concepts) and their relationships</li>
<li><strong>Knowledge Graph Construction:</strong> Entities and relationships are stored in Neo4j with deduplication and normalization</li>
<li><strong>Hybrid Query Processing:</strong> Queries combine vector search (semantic similarity) with graph traversal (relationship reasoning)</li>
<li><strong>Context Assembly:</strong> Retrieved information includes both similar text chunks and related entities with their relationships</li>
</ol>
<p><strong>Example query demonstrating multi-hop reasoning:</strong></p>
<p><em>"What technologies does our platform use and what security protocols protect them?"</em></p>
<p><strong>Traditional RAG response:</strong> Returns chunks mentioning technologies and chunks mentioning security, but struggles to connect them.</p>
<p><strong>Graph RAG response:</strong></p>
<ol>
<li>Identifies "platform" entity in knowledge graph</li>
<li>Traverses relationships to find connected technology entities</li>
<li>Traverses from technology entities to security protocol entities</li>
<li>Assembles comprehensive response showing explicit relationships</li>
</ol>
<p>The difference in answer quality is dramatic. Graph RAG provides structured, accurate responses that traditional approaches can't match.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="aws-deployment-architecture">AWS Deployment Architecture<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#aws-deployment-architecture" class="hash-link" aria-label="Direct link to AWS Deployment Architecture" title="Direct link to AWS Deployment Architecture">​</a></h2>
<p>For production deployment, I use AWS services mapped to each component:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Component          Local Development      Production AWS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">─────────────────  ────────────────────   ──────────────────────</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PostgreSQL         Docker container       RDS PostgreSQL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Neo4j              Docker container       EC2 + EBS (r6i.2xlarge)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Redis              Docker container       ElastiCache Redis</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Phi</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">4 Inference    Ollama on GPU         EC2 G5 instance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LightRAG App       Docker container       EC2 or ECS Fargate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Document Storage   Local filesystem       S3 + EFS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aws-cost-breakdown-production-247">AWS Cost Breakdown (Production 24/7)<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#aws-cost-breakdown-production-247" class="hash-link" aria-label="Direct link to AWS Cost Breakdown (Production 24/7)" title="Direct link to AWS Cost Breakdown (Production 24/7)">​</a></h3>
<p><strong>Monthly operating costs:</strong></p>
<ul>
<li>RDS PostgreSQL with Multi-AZ: $560</li>
<li>EC2 r6i.2xlarge for Neo4j (Reserved Instance): $300</li>
<li>ElastiCache Redis HA cluster: $280</li>
<li>EC2 G5.2xlarge for Phi-4 (Reserved Instance): $650</li>
<li>ECS Fargate for LightRAG application: $180</li>
<li>Supporting infrastructure (ALB, S3, CloudWatch): $250</li>
<li><strong>Total: $2,220/month ($26,640/year)</strong></li>
</ul>
<p><strong>Still 33% cheaper than OpenAI API approach</strong>, with these additional benefits:</p>
<ul>
<li>No rate limits or API quotas</li>
<li>Complete data sovereignty</li>
<li>Customizable entity extraction logic</li>
<li>Predictable, fixed costs regardless of query volume</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="on-premise-alternative-maximum-savings">On-Premise Alternative: Maximum Savings<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#on-premise-alternative-maximum-savings" class="hash-link" aria-label="Direct link to On-Premise Alternative: Maximum Savings" title="Direct link to On-Premise Alternative: Maximum Savings">​</a></h3>
<p>If you can deploy on-premise infrastructure, the economics get even more compelling:</p>
<p><strong>Hardware investment:</strong></p>
<ul>
<li>GPU server with RTX 4090 (24GB VRAM): $3,500</li>
<li>128GB RAM, 32-core CPU, 1TB NVMe: $2,500</li>
<li><strong>Total: $6,000 one-time</strong></li>
</ul>
<p><strong>Annual operating costs:</strong></p>
<ul>
<li>Electricity (24/7 at 500W average, $0.12/kWh): $525</li>
<li>Internet/bandwidth: $600</li>
<li>Maintenance and spare parts: $175</li>
<li><strong>Total: $1,300/year</strong></li>
</ul>
<p>Break-even vs OpenAI API: <strong>1.8 months</strong></p>
<p>Three-year total cost of ownership: <strong>$9,900</strong> (75% savings vs OpenAI)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-i-learned-building-this">What I Learned Building This<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#what-i-learned-building-this" class="hash-link" aria-label="Direct link to What I Learned Building This" title="Direct link to What I Learned Building This">​</a></h2>
<p>Let me save you some pain points.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-1-context-window-configuration-is-critical">Lesson 1: Context Window Configuration Is Critical<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#lesson-1-context-window-configuration-is-critical" class="hash-link" aria-label="Direct link to Lesson 1: Context Window Configuration Is Critical" title="Direct link to Lesson 1: Context Window Configuration Is Critical">​</a></h3>
<p>LightRAG requires at least 32K context window for proper entity extraction. Ollama models default to 8K context, which causes cryptic "context length exceeded" errors during document processing.</p>
<p>The fix is straightforward but non-obvious:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Pull the base model</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama pull phi4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create custom Modelfile with expanded context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama show --modelfile phi4 &gt; Modelfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo "PARAMETER num_ctx 32768" &gt;&gt; Modelfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama create -f Modelfile phi4-32k</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Verify</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama run phi4-32k</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or configure via API parameters:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">llm_config </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"model"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"phi4"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"options"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"num_ctx"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">32768</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"num_gpu"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Critical:</strong> If you're experiencing entity extraction failures with LightRAG, check your context window configuration first.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-2-gpu-memory-management-matters">Lesson 2: GPU Memory Management Matters<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#lesson-2-gpu-memory-management-matters" class="hash-link" aria-label="Direct link to Lesson 2: GPU Memory Management Matters" title="Direct link to Lesson 2: GPU Memory Management Matters">​</a></h3>
<p>Phi-4 14B requires approximately 18GB VRAM for inference with quantization. Without proper configuration, you'll hit out-of-memory errors when processing large documents.</p>
<p>Best practices:</p>
<ul>
<li>Use 4-bit or 8-bit quantization for inference (minimal quality loss)</li>
<li>Configure batch size based on available VRAM</li>
<li>Monitor GPU memory utilization via <code>nvidia-smi</code></li>
<li>Implement graceful degradation to CPU inference if GPU is unavailable</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-3-database-tuning-is-non-negotiable">Lesson 3: Database Tuning Is Non-Negotiable<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#lesson-3-database-tuning-is-non-negotiable" class="hash-link" aria-label="Direct link to Lesson 3: Database Tuning Is Non-Negotiable" title="Direct link to Lesson 3: Database Tuning Is Non-Negotiable">​</a></h3>
<p>Out-of-box database configurations are optimized for development, not production workloads. After indexing 10,000 documents, my query latency degraded from 2 seconds to 15+ seconds until I tuned memory settings.</p>
<p><strong>PostgreSQL tuning for 64GB system:</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- Assuming dedicated database server with 64GB RAM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shared_buffers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">8</span><span class="token plain">GB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">effective_cache_size </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">24</span><span class="token plain">GB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">maintenance_work_mem </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">GB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">work_mem </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">256</span><span class="token plain">MB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">random_page_cost </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1.1</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">-- SSD storage</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Neo4j tuning:</strong></p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">dbms.memory.heap.max_size=16G</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dbms.memory.pagecache.size=20G</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dbms.jvm.additional=-XX:+UseG1GC</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Result: 3-5x query performance improvement with proper tuning.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-4-document-processing-needs-retry-logic">Lesson 4: Document Processing Needs Retry Logic<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#lesson-4-document-processing-needs-retry-logic" class="hash-link" aria-label="Direct link to Lesson 4: Document Processing Needs Retry Logic" title="Direct link to Lesson 4: Document Processing Needs Retry Logic">​</a></h3>
<p>Production systems fail in unpredictable ways. Network timeouts, corrupted PDFs, LLM hallucinations producing invalid JSON—all cause document processing failures.</p>
<p>LightRAG includes built-in document status tracking:</p>
<ul>
<li><strong>Pending:</strong> Queued for processing</li>
<li><strong>Processing:</strong> Currently being indexed</li>
<li><strong>Completed:</strong> Successfully indexed</li>
<li><strong>Failed:</strong> Error occurred</li>
</ul>
<p>The Web UI includes a "Retry Failed Documents" feature that implements smart retry logic:</p>
<ul>
<li>Fast polling (2 seconds) during active processing</li>
<li>Adaptive polling (5-30 seconds) during idle periods</li>
<li>Automatic failure tracking with error details</li>
</ul>
<p>Build robust retry mechanisms from day one. You'll need them.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-benchmarks-phi-4-vs-gpt-4">Performance Benchmarks: Phi-4 vs GPT-4<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#performance-benchmarks-phi-4-vs-gpt-4" class="hash-link" aria-label="Direct link to Performance Benchmarks: Phi-4 vs GPT-4" title="Direct link to Performance Benchmarks: Phi-4 vs GPT-4">​</a></h2>
<p>I tested the system on a 500-document technical corpus with 50 evaluation questions ranging from simple factual queries to complex multi-hop reasoning.</p>
<p><strong>Results:</strong></p>
<table><thead><tr><th>Metric</th><th>Phi-4 + LightRAG</th><th>GPT-4 API + Standard RAG</th></tr></thead><tbody><tr><td>Answer accuracy</td><td>87%</td><td>92%</td></tr><tr><td>Multi-hop reasoning</td><td>83%</td><td>89%</td></tr><tr><td>Average query latency</td><td>2.8 seconds</td><td>1.2 seconds</td></tr><tr><td>Cost per 1,000 queries</td><td>$0 (after capex)</td><td>$12-18</td></tr><tr><td>Rate limits</td><td>None</td><td>10,000 TPM</td></tr><tr><td>Data sovereignty</td><td>Complete</td><td>None</td></tr></tbody></table>
<p><strong>Key takeaways:</strong></p>
<ol>
<li><strong>Phi-4 achieves 87% of GPT-4's accuracy</strong> at zero marginal cost per query</li>
<li><strong>Graph RAG outperforms naive RAG</strong> for both models, improving multi-hop reasoning by 40%+</li>
<li><strong>Latency is competitive</strong> especially when accounting for API overhead</li>
<li><strong>Cost advantage is overwhelming</strong> at scale</li>
</ol>
<p>For most enterprise use cases, the 5% accuracy gap is acceptable given the cost savings and data control.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="when-should-you-choose-this-approach">When Should You Choose This Approach?<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#when-should-you-choose-this-approach" class="hash-link" aria-label="Direct link to When Should You Choose This Approach?" title="Direct link to When Should You Choose This Approach?">​</a></h2>
<p>Not every organization needs self-hosted RAG. Here's my decision framework:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-choose-local-slm--lightrag-if-you">✅ Choose Local SLM + LightRAG if you:<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#-choose-local-slm--lightrag-if-you" class="hash-link" aria-label="Direct link to ✅ Choose Local SLM + LightRAG if you:" title="Direct link to ✅ Choose Local SLM + LightRAG if you:">​</a></h3>
<ul>
<li><strong>Process sensitive or proprietary data</strong> - HIPAA, GDPR, trade secrets, or anything you can't send to external APIs</li>
<li><strong>Need predictable costs at scale</strong> - 10,000+ documents with 1,000+ daily queries makes APIs expensive</li>
<li><strong>Require customization</strong> - Domain-specific entity extraction, custom graph schemas, specialized prompts</li>
<li><strong>Have DevOps resources</strong> - Can maintain databases, GPU infrastructure, and monitoring systems</li>
<li><strong>Can invest 2-4 weeks</strong> - Initial setup, testing, and hardening takes time</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-stick-with-openaiazure-apis-if-you">❌ Stick with OpenAI/Azure APIs if you:<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#-stick-with-openaiazure-apis-if-you" class="hash-link" aria-label="Direct link to ❌ Stick with OpenAI/Azure APIs if you:" title="Direct link to ❌ Stick with OpenAI/Azure APIs if you:">​</a></h3>
<ul>
<li><strong>Need fastest time to market</strong> - Can't invest 2-4 weeks in infrastructure setup</li>
<li><strong>Have limited DevOps expertise</strong> - No one comfortable managing PostgreSQL, Neo4j, GPU servers</li>
<li><strong>Process non-sensitive data</strong> - Public information, marketing content, open-source documentation</li>
<li><strong>Prefer opex over capex</strong> - Want variable per-use pricing, not fixed infrastructure costs</li>
<li><strong>Require vendor SLAs</strong> - Need guaranteed uptime and 24/7 support contracts</li>
</ul>
<p>For enterprises with significant document volumes and data governance requirements, self-hosted makes compelling sense. For startups prototyping or processing public data, APIs are simpler and faster.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="production-deployment-checklist">Production Deployment Checklist<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#production-deployment-checklist" class="hash-link" aria-label="Direct link to Production Deployment Checklist" title="Direct link to Production Deployment Checklist">​</a></h2>
<p>If you decide to pursue this approach, here's your deployment roadmap:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1-local-development-week-1">Phase 1: Local Development (Week 1)<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#phase-1-local-development-week-1" class="hash-link" aria-label="Direct link to Phase 1: Local Development (Week 1)" title="Direct link to Phase 1: Local Development (Week 1)">​</a></h3>
<ol>
<li>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>Docker and Docker Compose 2.0+</li>
<li>GPU with 24GB+ VRAM (or accept slower CPU inference)</li>
<li>500GB+ free disk space</li>
</ul>
</li>
<li>
<p><strong>Setup:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/HKUDS/LightRAG.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd LightRAG</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp env.example .env</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Edit .env with secure passwords</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker compose up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Verify:</strong></p>
<ul>
<li>Access Web UI at <a href="http://localhost:9621/webui/" target="_blank" rel="noopener noreferrer">http://localhost:9621/webui/</a></li>
<li>Upload test documents (start with 10-50)</li>
<li>Run test queries in all modes (local, global, hybrid)</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2-aws-pilot-deployment-week-2">Phase 2: AWS Pilot Deployment (Week 2)<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#phase-2-aws-pilot-deployment-week-2" class="hash-link" aria-label="Direct link to Phase 2: AWS Pilot Deployment (Week 2)" title="Direct link to Phase 2: AWS Pilot Deployment (Week 2)">​</a></h3>
<ol>
<li>
<p><strong>Infrastructure setup:</strong></p>
<ul>
<li>Deploy RDS PostgreSQL with pgvector extension</li>
<li>Launch EC2 r6i.2xlarge for Neo4j</li>
<li>Configure ElastiCache Redis cluster</li>
<li>Launch EC2 G5.2xlarge with Ollama and Phi-4</li>
</ul>
</li>
<li>
<p><strong>Networking:</strong></p>
<ul>
<li>Configure VPC with private subnets for databases</li>
<li>Set up security groups (minimum required ports only)</li>
<li>Deploy Application Load Balancer for LightRAG app</li>
<li>Configure CloudWatch logging and monitoring</li>
</ul>
</li>
<li>
<p><strong>Testing:</strong></p>
<ul>
<li>Index 1,000 representative documents</li>
<li>Run 100 evaluation queries</li>
<li>Measure query latency, accuracy, and costs</li>
<li>Validate against acceptance criteria</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3-production-hardening-week-3-4">Phase 3: Production Hardening (Week 3-4)<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#phase-3-production-hardening-week-3-4" class="hash-link" aria-label="Direct link to Phase 3: Production Hardening (Week 3-4)" title="Direct link to Phase 3: Production Hardening (Week 3-4)">​</a></h3>
<ol>
<li>
<p><strong>Security:</strong></p>
<ul>
<li>Enable encryption at rest for all databases</li>
<li>Configure AWS Secrets Manager for credentials</li>
<li>Implement API authentication (API keys or JWT)</li>
<li>Set up rate limiting and request throttling</li>
<li>Enable audit logging for compliance</li>
</ul>
</li>
<li>
<p><strong>Reliability:</strong></p>
<ul>
<li>Configure RDS Multi-AZ for high availability</li>
<li>Set up automated backups (PostgreSQL, Neo4j, Redis)</li>
<li>Implement health checks and auto-recovery</li>
<li>Test disaster recovery procedures</li>
</ul>
</li>
<li>
<p><strong>Monitoring:</strong></p>
<ul>
<li>Configure CloudWatch dashboards for key metrics</li>
<li>Set up alerts for failures, high latency, resource exhaustion</li>
<li>Implement distributed tracing for query paths</li>
<li>Deploy log aggregation (CloudWatch Logs Insights)</li>
</ul>
</li>
<li>
<p><strong>Performance optimization:</strong></p>
<ul>
<li>Tune database memory settings</li>
<li>Configure connection pooling</li>
<li>Implement query result caching in Redis</li>
<li>Optimize Neo4j indexes for common query patterns</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="roi-analysis-beyond-the-spreadsheet">ROI Analysis: Beyond the Spreadsheet<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#roi-analysis-beyond-the-spreadsheet" class="hash-link" aria-label="Direct link to ROI Analysis: Beyond the Spreadsheet" title="Direct link to ROI Analysis: Beyond the Spreadsheet">​</a></h2>
<p>Let me make the business case explicit.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="three-year-total-cost-of-ownership">Three-Year Total Cost of Ownership<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#three-year-total-cost-of-ownership" class="hash-link" aria-label="Direct link to Three-Year Total Cost of Ownership" title="Direct link to Three-Year Total Cost of Ownership">​</a></h3>
<p><strong>OpenAI API Approach:</strong></p>
<ul>
<li>Year 1: $39,600</li>
<li>Year 2: $39,600</li>
<li>Year 3: $39,600</li>
<li><strong>Total: $118,800</strong></li>
</ul>
<p><strong>Self-Hosted AWS:</strong></p>
<ul>
<li>Year 1: $26,640</li>
<li>Year 2: $26,640</li>
<li>Year 3: $26,640</li>
<li><strong>Total: $79,920</strong></li>
<li><strong>Savings: $38,880 (33%)</strong></li>
</ul>
<p><strong>Self-Hosted On-Premise:</strong></p>
<ul>
<li>Year 1: $6,000 (hardware) + $2,300 (opex) = $8,300</li>
<li>Year 2: $2,300</li>
<li>Year 3: $2,300</li>
<li><strong>Total: $12,900</strong></li>
<li><strong>Savings: $105,900 (89%)</strong></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="strategic-value-beyond-cost">Strategic Value Beyond Cost<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#strategic-value-beyond-cost" class="hash-link" aria-label="Direct link to Strategic Value Beyond Cost" title="Direct link to Strategic Value Beyond Cost">​</a></h3>
<p>The spreadsheet doesn't capture everything that matters:</p>
<p><strong>Data sovereignty:</strong> Your knowledge base never touches external APIs. For regulated industries (healthcare, finance, legal), this eliminates entire categories of compliance overhead and risk.</p>
<p><strong>Customization freedom:</strong> Fine-tune entity extraction for your domain. Optimize graph schemas for your use cases. Implement custom retrieval strategies. These capabilities simply aren't available with closed APIs.</p>
<p><strong>Predictable scaling:</strong> Infrastructure costs are fixed—they don't spike when usage grows. Scale at your own pace without budget negotiations.</p>
<p><strong>No rate limits:</strong> Process batch jobs overnight. Handle traffic spikes during product launches. No throttling, no quota requests, no surprise bills.</p>
<p><strong>Innovation velocity:</strong> Experiment freely without worrying about API costs. Test new approaches, run A/B tests, iterate rapidly.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-enhancements-im-exploring">Future Enhancements I'm Exploring<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#future-enhancements-im-exploring" class="hash-link" aria-label="Direct link to Future Enhancements I'm Exploring" title="Direct link to Future Enhancements I'm Exploring">​</a></h2>
<p>This is where things get exciting.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-modal-document-understanding">Multi-Modal Document Understanding<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#multi-modal-document-understanding" class="hash-link" aria-label="Direct link to Multi-Modal Document Understanding" title="Direct link to Multi-Modal Document Understanding">​</a></h3>
<p>Current LightRAG limitation: text-only processing. But enterprise documents contain:</p>
<ul>
<li>Architecture diagrams</li>
<li>Database schemas</li>
<li>Screenshots and UI mockups</li>
<li>Performance charts and graphs</li>
</ul>
<p>I'm experimenting with vision models (LLaVA) to extract information from images before feeding to LightRAG. Early tests show promise for understanding technical diagrams.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="natural-language-to-graph-queries">Natural Language to Graph Queries<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#natural-language-to-graph-queries" class="hash-link" aria-label="Direct link to Natural Language to Graph Queries" title="Direct link to Natural Language to Graph Queries">​</a></h3>
<p>Right now, all queries go through the RAG pipeline. I want to enable direct graph queries:</p>
<p><em>"Show me all microservices that depend on the authentication service"</em> → translates to Cypher query → returns graph visualization</p>
<p>This would expose the knowledge graph's full power for exploratory analysis.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="continuous-learning-from-feedback">Continuous Learning from Feedback<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#continuous-learning-from-feedback" class="hash-link" aria-label="Direct link to Continuous Learning from Feedback" title="Direct link to Continuous Learning from Feedback">​</a></h3>
<p>LightRAG doesn't currently learn from usage. I'm building:</p>
<ul>
<li>Thumbs up/down on answers to identify weak areas</li>
<li>User corrections for entity relationships</li>
<li>Automated fine-tuning pipeline using collected examples</li>
<li>A/B testing framework for prompt optimization</li>
</ul>
<p>The goal: knowledge base quality improves continuously based on real usage patterns.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-takeaways">Key Takeaways<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways">​</a></h2>
<p>After six months running this system in production, here's what matters:</p>
<ol>
<li>
<p><strong>Local SLMs are production-ready</strong> - Phi-4 handles complex RAG tasks previously requiring GPT-4. The performance gap is closing rapidly.</p>
</li>
<li>
<p><strong>Graph RAG significantly outperforms naive RAG</strong> - Multi-hop reasoning and entity relationships produce dramatically better answers for complex questions.</p>
</li>
<li>
<p><strong>Cost savings are transformative</strong> - 67-94% reduction in operating costs makes comprehensive knowledge systems economically viable.</p>
</li>
<li>
<p><strong>Data sovereignty matters</strong> - For enterprises with sensitive data, keeping everything in-house is worth the operational complexity.</p>
</li>
<li>
<p><strong>Setup time is the main barrier</strong> - Initial deployment takes 2-4 weeks, but ongoing maintenance is minimal (2-4 hours/month).</p>
</li>
<li>
<p><strong>Performance is competitive</strong> - Phi-4 achieves 87% of GPT-4 accuracy with graph RAG, which is sufficient for most enterprise use cases.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting Started<a href="https://jonroosevelt.com/blog/rag-system-cost-savings#getting-started" class="hash-link" aria-label="Direct link to Getting Started" title="Direct link to Getting Started">​</a></h2>
<p>If this approach resonates with your requirements, here's your next action:</p>
<ol>
<li><strong>Start small</strong> - Prove the concept locally with 1,000 documents before committing to production</li>
<li><strong>Measure baseline</strong> - Benchmark against your current solution or document set</li>
<li><strong>Calculate your economics</strong> - Use actual document counts and query volumes to build your cost model</li>
<li><strong>Plan deployment</strong> - Choose AWS vs on-premise based on compliance requirements</li>
<li><strong>Iterate gradually</strong> - Index one domain at a time, expand iteratively</li>
</ol>
<p>The era of prohibitively expensive RAG systems is ending. Local SLMs + graph-based retrieval + smart architecture = production-grade systems at sustainable costs.</p>
<hr>
<p>Have you experimented with local LLMs for RAG? What's holding you back from self-hosted infrastructure? I'd love to hear your thoughts and challenges.</p>
<p>If you found this valuable:</p>
<ul>
<li>Share this with your engineering or finance team</li>
<li>Try LightRAG with Phi-4 on a small corpus</li>
<li>Reach out if you're planning a production deployment</li>
</ul>
<p>I'm planning follow-up posts on:</p>
<ul>
<li>Fine-tuning Phi-4 for domain-specific entity extraction</li>
<li>Optimizing Neo4j query performance for large knowledge graphs</li>
<li>Building production-grade monitoring for RAG systems</li>
</ul>
<p>Which would you find most useful? Let me know.</p>
<hr>
<p><em>Jon Roosevelt is an AI architect specializing in healthcare and enterprise systems. He builds production ML systems that balance performance, cost, and data sovereignty—making powerful AI accessible through pragmatic infrastructure choices.</em></p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="LLM" term="LLM"/>
        <category label="RAG" term="RAG"/>
        <category label="Architecture" term="Architecture"/>
        <category label="Optimization" term="Optimization"/>
        <category label="AWS" term="AWS"/>
        <category label="Machine Learning" term="Machine Learning"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[What Peterson's Genesis Lectures Teach About Sacrifice: Why Abraham Waited 100 Years]]></title>
        <id>https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning</id>
        <link href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[The story of Abraham waiting 100 years for a son, only to be asked to sacrifice him, seems absurd on its face. Why would ancient cultures preserve such a psychologically brutal narrative? Dr. Jordan Peterson's Genesis lecture series offers a compelling answer: this isn't just a story about religious obedience. It's a sophisticated psychological framework for understanding how human beings navigate time, create meaning, and build civilization itself.]]></summary>
        <content type="html"><![CDATA[<p>The story of Abraham waiting 100 years for a son, only to be asked to sacrifice him, seems absurd on its face. Why would ancient cultures preserve such a psychologically brutal narrative? Dr. Jordan Peterson's Genesis lecture series offers a compelling answer: this isn't just a story about religious obedience. It's a sophisticated psychological framework for understanding how human beings navigate time, create meaning, and build civilization itself.</p>
<p><img decoding="async" loading="lazy" alt="Abraham&amp;#39;s Sacrifice and the Psychology of Delayed Gratification" src="https://jonroosevelt.com/assets/images/hero-banner-81860f7ee7bcf1a07f0530ea92fb787d.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem-ancient-stories-solve">The Problem Ancient Stories Solve<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#the-problem-ancient-stories-solve" class="hash-link" aria-label="Direct link to The Problem Ancient Stories Solve" title="Direct link to The Problem Ancient Stories Solve">​</a></h2>
<p>Before dismissing these narratives as pre-scientific mythology, consider what Peterson identifies as their actual function: <strong>they encode solutions to existential problems that human consciousness creates</strong>. Self-awareness gives us the ability to conceptualize the future, but it also creates the burden of choosing between immediate gratification and long-term flourishing.</p>
<p>The Abraham narrative isn't answering "what should I believe?" It's answering "how do I orient myself across time in a way that makes life meaningful?"</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="abrahams-100-year-wait-the-structure-of-sacrifice">Abraham's 100-Year Wait: The Structure of Sacrifice<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#abrahams-100-year-wait-the-structure-of-sacrifice" class="hash-link" aria-label="Direct link to Abraham's 100-Year Wait: The Structure of Sacrifice" title="Direct link to Abraham's 100-Year Wait: The Structure of Sacrifice">​</a></h2>
<p>In Peterson's interpretation, Abraham's century-long wait for Isaac isn't just narrative padding. It represents the psychological reality of <strong>multi-generational sacrifice</strong> — the idea that the most meaningful transformations operate on timescales that exceed individual lifespans.</p>
<p>Abraham doesn't get what he wants immediately. He doesn't get it in a reasonable timeframe. He gets it at the absolute limit of biological possibility, in his old age, through Sarah who was considered barren. The promise is fulfilled, but only after the capacity for immediate reward has been completely exhausted.</p>
<p>Then comes the binding of Isaac. Abraham is asked to sacrifice the very thing the sacrifice was for. Peterson identifies this as the deepest psychological truth about commitment: <strong>you don't know what you're really willing to give up until you're asked to give up the thing you sacrificed everything to obtain</strong>.</p>
<p>This is the difference between sacrifice and suffering.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sacrifice-vs-suffering-the-crucial-distinction">Sacrifice vs. Suffering: The Crucial Distinction<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#sacrifice-vs-suffering-the-crucial-distinction" class="hash-link" aria-label="Direct link to Sacrifice vs. Suffering: The Crucial Distinction" title="Direct link to Sacrifice vs. Suffering: The Crucial Distinction">​</a></h2>
<p>Peterson makes a distinction that transforms how we think about hardship:</p>
<ul>
<li><strong>Suffering</strong> is involuntary pain without meaning</li>
<li><strong>Sacrifice</strong> is voluntary renunciation in service of something valued more highly</li>
</ul>
<p>The same objective experience — giving something up, enduring difficulty, delaying gratification — can be either sacrifice or suffering depending on whether it's integrated into a coherent narrative of purpose.</p>
<p>When an immigrant family works three jobs to put their children through school, they're making a sacrifice. When someone works three jobs because they're trapped in debt from poor decisions, that's suffering. The external hardship looks identical. The psychological structure is completely different.</p>
<p>This distinction matters because <strong>sacrifice generates meaning; suffering generates resentment</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-marshmallow-test-and-the-prefrontal-cortex">The Marshmallow Test and the Prefrontal Cortex<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#the-marshmallow-test-and-the-prefrontal-cortex" class="hash-link" aria-label="Direct link to The Marshmallow Test and the Prefrontal Cortex" title="Direct link to The Marshmallow Test and the Prefrontal Cortex">​</a></h2>
<p>Peterson frequently references the famous marshmallow test — the Stanford experiment where children who could delay eating one marshmallow to get two later showed better life outcomes decades down the line. He connects this to the neurological battle between the prefrontal cortex (which models future states) and the limbic system (which wants immediate reward).</p>
<p>The child who eats the marshmallow isn't morally inferior. They're just dominated by the part of the brain that exists in the immediate present. The child who waits has developed — or inherited, or been taught — the capacity to conceptualize a future self and value that future self's experience.</p>
<p>This is the same psychological structure operating in the Abraham narrative, just scaled up to a multi-generational timeframe. The question isn't "can I wait 15 minutes?" It's "can I structure my entire life around something I may never see completed?"</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-generational-sacrifice-the-immigrant-paradigm">Multi-Generational Sacrifice: The Immigrant Paradigm<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#multi-generational-sacrifice-the-immigrant-paradigm" class="hash-link" aria-label="Direct link to Multi-Generational Sacrifice: The Immigrant Paradigm" title="Direct link to Multi-Generational Sacrifice: The Immigrant Paradigm">​</a></h2>
<p>Peterson uses the immigrant parent as the archetypal example of sacrifice that spans generations. A parent leaves everything familiar, works in jobs below their education level, endures cultural dislocation and economic hardship — all so their children can have opportunities they never had.</p>
<p>This is sacrifice in its purest form: <strong>voluntary acceptance of reduced present conditions to improve future conditions for someone else</strong>.</p>
<p>But here's the deeper insight: the sacrifice doesn't diminish the parent's life. It gives it meaning. The hardship is still real, but it's no longer suffering because it's in service of something they value more than their own comfort.</p>
<p>Peterson argues this is how human beings escape the nihilism inherent in self-consciousness. We become aware that we die, that pain is inevitable, that entropy increases. Without a framework that makes voluntary sacrifice meaningful, this awareness is paralyzing. But if sacrifice itself is the mechanism by which we participate in something larger than our individual existence, then the burden of consciousness becomes bearable.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-psychological-principle-what-you-sacrifice-becomes-most-valuable">The Psychological Principle: What You Sacrifice Becomes Most Valuable<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#the-psychological-principle-what-you-sacrifice-becomes-most-valuable" class="hash-link" aria-label="Direct link to The Psychological Principle: What You Sacrifice Becomes Most Valuable" title="Direct link to The Psychological Principle: What You Sacrifice Becomes Most Valuable">​</a></h2>
<p>Peterson identifies a pattern that appears throughout Genesis: <strong>what you're willing to sacrifice defines what you truly value, and that act of sacrifice imbues the thing with meaning</strong>.</p>
<p>This isn't mysticism. It's observable psychology. We value things proportionally to what we gave up to obtain them. The degree program you worked full-time to complete means more than the one your parents paid for. The business you bootstrapped means more than the one you inherited. The relationship you fought for means more than the one that came easily.</p>
<p>The Abraham narrative takes this to the extreme: he's asked to sacrifice the son he waited 100 years for, the fulfillment of the divine promise, the entire purpose of his covenant with God. And in that moment of willingness, Isaac becomes infinitely valuable — not despite the potential sacrifice, but because of it.</p>
<p>The modern application isn't literal child sacrifice. It's the recognition that <strong>commitment is demonstrated by what you're willing to give up, not by what you're willing to gain</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="speech-as-the-ordering-principle">Speech as the Ordering Principle<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#speech-as-the-ordering-principle" class="hash-link" aria-label="Direct link to Speech as the Ordering Principle" title="Direct link to Speech as the Ordering Principle">​</a></h2>
<p>One of Peterson's recurring themes across the Genesis series is that speech — articulated meaning — is how chaos is transformed into order. In the creation narrative, God speaks and the world comes into being. In the Abraham narrative, the covenant is verbal, the promise is spoken, the command to sacrifice is communicated through language.</p>
<p>This matters because sacrifice without articulation is just loss. The immigrant parent who works three jobs but never explains why, who never articulates the purpose, leaves their children with a sense of their parent's absence, not their parent's love.</p>
<p>Sacrifice becomes meaningful when it's <strong>integrated into a narrative structure that connects present action to future value</strong>. This is why Peterson emphasizes that these ancient stories aren't just describing what people should do — they're providing the linguistic framework that makes sacrifice coherent across time.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="modern-applications-where-this-actually-matters">Modern Applications: Where This Actually Matters<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#modern-applications-where-this-actually-matters" class="hash-link" aria-label="Direct link to Modern Applications: Where This Actually Matters" title="Direct link to Modern Applications: Where This Actually Matters">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="career-and-skill-development">Career and Skill Development<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#career-and-skill-development" class="hash-link" aria-label="Direct link to Career and Skill Development" title="Direct link to Career and Skill Development">​</a></h3>
<p>The person who spends evenings learning a new skill instead of relaxing isn't suffering if they have a clear purpose. They're making a sacrifice — present leisure for future capability. The quality of that sacrifice depends entirely on how well they can articulate why it matters.</p>
<p><strong>Application</strong>: Before starting a difficult learning process, write down the specific future state you're aiming for. The more concrete and meaningful the future vision, the more sustainable the sacrifice.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parenting-and-delayed-gratification">Parenting and Delayed Gratification<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#parenting-and-delayed-gratification" class="hash-link" aria-label="Direct link to Parenting and Delayed Gratification" title="Direct link to Parenting and Delayed Gratification">​</a></h3>
<p>Parents who sacrifice career advancement to be present for young children aren't losing career capital — they're making a bet that the long-term outcome (well-adjusted children, strong family relationships) is more valuable than the short-term outcome (faster promotion, higher salary).</p>
<p>But this only works if the parent can maintain the psychological frame of "sacrifice" rather than slipping into "suffering." The difference is narrative integration.</p>
<p><strong>Application</strong>: When making parenting-related career tradeoffs, explicitly name what you're choosing and why. "I'm taking this less demanding role for three years while the kids are young" is sacrifice. "I guess I'll never advance now" is suffering.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="investing-and-compound-returns">Investing and Compound Returns<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#investing-and-compound-returns" class="hash-link" aria-label="Direct link to Investing and Compound Returns" title="Direct link to Investing and Compound Returns">​</a></h3>
<p>The entire logic of investing is delayed gratification at a financial level. You give up purchasing power today in exchange for greater purchasing power later. The person who can't do this isn't morally deficient — they just haven't developed the psychological capacity to value their future self as much as their present self.</p>
<p><strong>Application</strong>: Automate the sacrifice. Set up systems that remove the decision from the moment of temptation. The child who succeeded in the marshmallow test often used distraction strategies. Adults can use automated transfers and commitment devices.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="organizational-building">Organizational Building<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#organizational-building" class="hash-link" aria-label="Direct link to Organizational Building" title="Direct link to Organizational Building">​</a></h3>
<p>Leaders who invest in infrastructure, documentation, and process instead of shipping features are making a sacrifice. Present velocity for future scalability. The teams that can sustain this are the ones with a shared narrative about why it matters.</p>
<p><strong>Application</strong>: Make infrastructure work visible. Articulate the connection between present investment and future capability. "We're building this CI/CD pipeline so that in six months we can deploy 10x as frequently with higher confidence."</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-framework-making-sacrifice-meaningful">The Framework: Making Sacrifice Meaningful<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#the-framework-making-sacrifice-meaningful" class="hash-link" aria-label="Direct link to The Framework: Making Sacrifice Meaningful" title="Direct link to The Framework: Making Sacrifice Meaningful">​</a></h2>
<p>Peterson's analysis of the Abraham narrative yields a practical framework:</p>
<ol>
<li>
<p><strong>Articulate the future state clearly</strong> — What are you aiming at? The more specific and meaningful, the more you can endure to get there.</p>
</li>
<li>
<p><strong>Make the sacrifice voluntary</strong> — Anything you do because you "have to" will generate resentment. Reframe obligations as choices aligned with your values.</p>
</li>
<li>
<p><strong>Connect present action to future value</strong> — Build the narrative bridge. "I'm doing X now because it enables Y later, and Y matters because Z."</p>
</li>
<li>
<p><strong>Orient toward something larger than yourself</strong> — Multi-generational thinking, team outcomes, civilizational progress. The bigger the frame, the more meaningful the sacrifice.</p>
</li>
<li>
<p><strong>Communicate the purpose</strong> — Don't just do it. Explain it. To yourself, to your team, to your family. Speech is the ordering principle.</p>
</li>
<li>
<p><strong>Be willing to sacrifice what you sacrificed for</strong> — This is the final test. Can you let go of the outcome if necessary? Or are you so attached to the goal that you've lost sight of the principle?</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-matters-beyond-religion">Why This Matters Beyond Religion<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#why-this-matters-beyond-religion" class="hash-link" aria-label="Direct link to Why This Matters Beyond Religion" title="Direct link to Why This Matters Beyond Religion">​</a></h2>
<p>You don't have to believe in God to find this framework useful. The psychological structure Peterson identifies operates whether you interpret it theologically or not. The capacity to delay gratification, to orient toward multi-generational outcomes, to find meaning in voluntary sacrifice — these are the mechanisms by which human beings build anything that lasts.</p>
<p>Civilizations aren't built by people optimizing for immediate reward. They're built by people willing to plant trees they'll never sit under. The ancient narratives that encode this principle survived because the cultures that internalized them outcompeted the cultures that didn't.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-hard-truth">The Hard Truth<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#the-hard-truth" class="hash-link" aria-label="Direct link to The Hard Truth" title="Direct link to The Hard Truth">​</a></h2>
<p>The Abraham narrative doesn't promise that sacrifice will always pay off in your lifetime. It promises that <strong>sacrifice is the mechanism by which you participate in something that transcends your lifetime</strong>, and that participation is what makes the burden of consciousness bearable.</p>
<p>Abraham waited 100 years. Most of what you sacrifice for won't pay off in a century, let alone a year. But the alternative — living only for immediate gratification, refusing all sacrifice, optimizing purely for present comfort — doesn't lead to happiness. It leads to meaninglessness.</p>
<p>The deepest insight from Peterson's Genesis lectures isn't that you should believe ancient stories literally. It's that <strong>the psychological truths they encode are still the ones we're navigating</strong>, and ignoring them doesn't make you more sophisticated. It just makes you more likely to confuse suffering with sacrifice, and to wonder why nothing feels meaningful.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="practical-next-steps">Practical Next Steps<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#practical-next-steps" class="hash-link" aria-label="Direct link to Practical Next Steps" title="Direct link to Practical Next Steps">​</a></h2>
<ol>
<li>
<p><strong>Identify one area where you're suffering instead of sacrificing</strong> — Where are you enduring hardship without a coherent narrative of purpose?</p>
</li>
<li>
<p><strong>Articulate why it matters</strong> — Write down the specific future state you're aiming for and why it's worth the present cost.</p>
</li>
<li>
<p><strong>Make it voluntary</strong> — Even if circumstances are constraining, reframe the choice as yours. "I'm choosing X because I value Y."</p>
</li>
<li>
<p><strong>Communicate it</strong> — If it involves other people (parenting, leadership, partnership), explain the purpose clearly.</p>
</li>
<li>
<p><strong>Build the structure that sustains it</strong> — What systems, habits, or commitments make the sacrifice automatic rather than requiring constant willpower?</p>
</li>
</ol>
<p>The question isn't whether you'll sacrifice. You'll give up things regardless. The question is whether those sacrifices will be meaningful — whether they'll connect you to something larger than immediate gratification, or whether they'll just be suffering with no purpose.</p>
<p>Abraham's story suggests the answer isn't about what you sacrifice. It's about how you integrate that sacrifice into a narrative of meaning that spans timescales beyond your individual existence.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-reading">Further Reading<a href="https://jonroosevelt.com/blog/sacrifice-abraham-peterson-genesis-meaning#further-reading" class="hash-link" aria-label="Direct link to Further Reading" title="Direct link to Further Reading">​</a></h2>
<ul>
<li><strong>Jordan Peterson's Biblical Series</strong> — All 15 Genesis lectures available on YouTube, particularly Lecture 12 on Abraham and Isaac</li>
<li><em>12 Rules for Life</em> by Jordan Peterson — Rule 7: "Pursue what is meaningful (not what is expedient)"</li>
<li><em>The Righteous Mind</em> by Jonathan Haidt — How moral psychology structures our understanding of sacrifice</li>
<li><em>Man's Search for Meaning</em> by Viktor Frankl — The ultimate exploration of how meaning transforms suffering</li>
<li><em>Thinking, Fast and Slow</em> by Daniel Kahneman — The neuroscience of present vs. future thinking</li>
</ul>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Philosophy" term="Philosophy"/>
        <category label="Psychology" term="Psychology"/>
        <category label="Meaning" term="Meaning"/>
        <category label="Personal Development" term="Personal Development"/>
        <category label="Biblical Wisdom" term="Biblical Wisdom"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The 6-Task System: How I Manage Knowledge Work with PARA + Ivy Lee Method]]></title>
        <id>https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity</id>
        <link href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[The best productivity system is the one you'll actually use. After years of experimenting with todo apps, kanban boards, and elaborate task managers, I found something that works: a hybrid of Tiago Forte's PARA methodology and the century-old Ivy Lee Method. The result is a system that reduced my inbox from 707 lines to 49 (92% reduction), eliminated decision fatigue, and lets me focus on deep work.]]></summary>
        <content type="html"><![CDATA[<p>The best productivity system is the one you'll actually use. After years of experimenting with todo apps, kanban boards, and elaborate task managers, I found something that works: a hybrid of Tiago Forte's PARA methodology and the century-old Ivy Lee Method. The result is a system that reduced my inbox from 707 lines to 49 (92% reduction), eliminated decision fatigue, and lets me focus on deep work.</p>
<p><img decoding="async" loading="lazy" alt="The 6-Task System" src="https://jonroosevelt.com/assets/images/hero-banner-063a559c84189a1d02e41bcc61fe4420.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-paradox-of-productivity-tools">The Paradox of Productivity Tools<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-paradox-of-productivity-tools" class="hash-link" aria-label="Direct link to The Paradox of Productivity Tools" title="Direct link to The Paradox of Productivity Tools">​</a></h2>
<p>Here's the uncomfortable truth about productivity systems: most of them make you less productive. I've watched brilliant engineers spend hours configuring Notion databases, building elaborate Obsidian plugins, and color-coding their calendars — all while their actual work sits untouched.</p>
<p>The problem isn't the tools. It's that we've confused <strong>organizing work</strong> with <strong>doing work</strong>. Every minute spent tweaking your task management system is a minute not spent writing code, solving problems, or creating value.</p>
<p>I fell into this trap myself. At one point, I was using:</p>
<ul>
<li>Jira for work tasks</li>
<li>Todoist for personal todos</li>
<li>Obsidian for notes</li>
<li>Google Calendar for time blocking</li>
<li>Email for follow-ups</li>
</ul>
<p>Context switching between five systems was killing my productivity. Worse, I'd spend time deciding <strong>where</strong> to put a task instead of just doing it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-6-tasks-beats-infinite-todo-lists">Why 6 Tasks Beats Infinite Todo Lists<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#why-6-tasks-beats-infinite-todo-lists" class="hash-link" aria-label="Direct link to Why 6 Tasks Beats Infinite Todo Lists" title="Direct link to Why 6 Tasks Beats Infinite Todo Lists">​</a></h2>
<p>In 1918, efficiency consultant Ivy Lee gave Bethlehem Steel president Charles Schwab a productivity method so effective that Schwab paid him $25,000 for it (equivalent to $400,000 today). The method was simple:</p>
<ol>
<li>At the end of each workday, write down the six most important tasks for tomorrow</li>
<li>Prioritize them in order of importance</li>
<li>The next day, work on task #1 until it's complete</li>
<li>Move to task #2, then #3, and so on</li>
<li>At day's end, move unfinished tasks to tomorrow's list</li>
</ol>
<p>Why does this work? Three reasons:</p>
<p><strong>Constraint breeds clarity.</strong> When you can only choose six tasks, you're forced to distinguish between "important" and "merely urgent." You can't hide from priorities.</p>
<p><strong>Sequential execution eliminates decision fatigue.</strong> You know exactly what to work on next. No debating whether to tackle email or that design doc. The decision was made yesterday.</p>
<p><strong>Evening planning removes morning friction.</strong> Your most valuable morning hours aren't wasted on planning — you wake up knowing exactly what needs to happen.</p>
<p>I've been using this method for six months. The constraint of six tasks transformed how I think about my day. Instead of a 30-item list that induces anxiety, I have six clear objectives. Most days, I complete 4-5 of them. That's actual progress, not checkbox theater.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="para-as-organizational-backbone">PARA as Organizational Backbone<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#para-as-organizational-backbone" class="hash-link" aria-label="Direct link to PARA as Organizational Backbone" title="Direct link to PARA as Organizational Backbone">​</a></h2>
<p>The Ivy Lee Method handles <strong>execution</strong>, but knowledge work requires more than a daily task list. You need a system for <strong>organizing information</strong> — the notes, documents, emails, and ideas that feed your work.</p>
<p>That's where Tiago Forte's PARA methodology comes in. PARA divides your entire digital life into four categories:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="projects">Projects<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#projects" class="hash-link" aria-label="Direct link to Projects" title="Direct link to Projects">​</a></h3>
<p><strong>Definition:</strong> A series of tasks with a goal and a deadline.
<strong>Examples:</strong> "Launch behavioral health service," "Close Nashville acquisition," "Ship blog automation"</p>
<p>Projects are time-bound and actionable. They have clear outcomes. When a project is complete, it moves to Archive.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="areas">Areas<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#areas" class="hash-link" aria-label="Direct link to Areas" title="Direct link to Areas">​</a></h3>
<p><strong>Definition:</strong> Ongoing responsibilities with standards to maintain.
<strong>Examples:</strong> "Arcs Health operations," "Biblical education," "Health &amp; fitness," "Second brain maintenance"</p>
<p>Areas never end. They're the life domains that require continuous attention. The distinction between projects and areas is critical: if it's never-ending, it's an area, not a project.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h3>
<p><strong>Definition:</strong> Topics of interest, reference material, knowledge base.
<strong>Examples:</strong> "QLA methodology notes," "Python automation scripts," "Healthcare regulations," "Leadership frameworks"</p>
<p>Resources are knowledge you might use later. They're not immediately actionable, but they're valuable for reference and learning.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="archive">Archive<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#archive" class="hash-link" aria-label="Direct link to Archive" title="Direct link to Archive">​</a></h3>
<p><strong>Definition:</strong> Completed projects and inactive items.
<strong>Examples:</strong> "2025 Q3 board deck," "Covenant Clinics acquisition documents," "Old blog drafts"</p>
<p>Archive is where projects go to rest. It keeps your active workspace clean while preserving history.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-time-based-distinction">The Time-Based Distinction<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-time-based-distinction" class="hash-link" aria-label="Direct link to The Time-Based Distinction" title="Direct link to The Time-Based Distinction">​</a></h2>
<p>The genius of PARA is that it's <strong>time-based</strong>, not category-based. Traditional organization systems use categories like "Work," "Personal," "Health" — but those categories don't tell you what to do next.</p>
<p>PARA organizes by <strong>when you need the information</strong>:</p>
<ul>
<li><strong>Projects</strong>: Need it now (active work with deadlines)</li>
<li><strong>Areas</strong>: Need it regularly (ongoing maintenance)</li>
<li><strong>Resources</strong>: Might need it eventually (reference material)</li>
<li><strong>Archive</strong>: Don't need it anymore (historical record)</li>
</ul>
<p>This temporal structure aligns perfectly with how knowledge work actually happens. When I'm working on a project, I don't want to wade through my entire knowledge base — I want exactly the resources relevant to this deadline-driven work.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="my-second-brain-structure">My Second Brain Structure<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#my-second-brain-structure" class="hash-link" aria-label="Direct link to My Second Brain Structure" title="Direct link to My Second Brain Structure">​</a></h2>
<p>Here's how I've implemented PARA in Obsidian:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">0. Foundation/          # Identity, strategy, frameworks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├── TELOS.md        # Personal mission, goals, metrics</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   └── Substrate/      # Evidence base (problems, solutions, outcomes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0. Inbox/              # Capture point (~29,000 items auto-processed)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. Projects/           # Active projects with deadlines</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├── Nashville Acquisition/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├── Behavioral Health Launch/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   └── Blog Automation/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. Areas/              # Ongoing responsibilities</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├── Arcs Health/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├── Biblical Education/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├── Health/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   └── Second Brain/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. Resources/          # Reference and learning</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├── QLA Methodology/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├── Python Scripts/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   └── Healthcare Industry/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. Archive/            # Completed projects</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├── 2025-Q3-Board-Deck/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   └── Covenant-Acquisition/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <strong>Foundation</strong> layer is my addition to PARA — it's where my identity, mission, and strategic frameworks live. This is the "why" that informs all the work below it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-evening-ritual-planning-tomorrow-today">The Evening Ritual: Planning Tomorrow Today<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-evening-ritual-planning-tomorrow-today" class="hash-link" aria-label="Direct link to The Evening Ritual: Planning Tomorrow Today" title="Direct link to The Evening Ritual: Planning Tomorrow Today">​</a></h2>
<p>Every evening, I spend 15-20 minutes planning the next day's six tasks. This isn't busywork — it's strategic thinking at the lowest-friction moment.</p>
<p>Here's the process:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-review-todays-outcomes">1. Review Today's Outcomes<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#1-review-todays-outcomes" class="hash-link" aria-label="Direct link to 1. Review Today's Outcomes" title="Direct link to 1. Review Today's Outcomes">​</a></h3>
<p>What got done? What didn't? Why? This isn't about guilt — it's about learning patterns. If task #5 keeps rolling forward, maybe it's not actually important.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-scan-active-projects">2. Scan Active Projects<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#2-scan-active-projects" class="hash-link" aria-label="Direct link to 2. Scan Active Projects" title="Direct link to 2. Scan Active Projects">​</a></h3>
<p>I open <code>1. Projects/</code> and review each active project folder. What needs to move forward tomorrow? What's blocking progress? What has the nearest deadline?</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-check-areas-for-maintenance">3. Check Areas for Maintenance<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#3-check-areas-for-maintenance" class="hash-link" aria-label="Direct link to 3. Check Areas for Maintenance" title="Direct link to 3. Check Areas for Maintenance">​</a></h3>
<p>Areas require ongoing attention. Daily: Arcs Health operations. Weekly: Biblical education reading. Monthly: Second brain cleanup. I schedule the appropriate area tasks.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-process-inbox-zero-the-real-zero">4. Process Inbox Zero (The Real Zero)<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#4-process-inbox-zero-the-real-zero" class="hash-link" aria-label="Direct link to 4. Process Inbox Zero (The Real Zero)" title="Direct link to 4. Process Inbox Zero (The Real Zero)">​</a></h3>
<p>I don't mean email inbox zero — I mean <code>0. Inbox/</code> zero. This is where all captures land: voice memos, email forwards, quick notes. I triage everything:</p>
<ul>
<li><strong>Actionable</strong> → Becomes a task or project</li>
<li><strong>Reference</strong> → Goes to Resources</li>
<li><strong>Maybe</strong> → Tagged for future review</li>
<li><strong>Junk</strong> → Archived</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-prioritize-in-strict-order">5. Prioritize in Strict Order<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#5-prioritize-in-strict-order" class="hash-link" aria-label="Direct link to 5. Prioritize in Strict Order" title="Direct link to 5. Prioritize in Strict Order">​</a></h3>
<p>This is the hard part. I write six tasks, numbered 1-6, in <strong>strict priority order</strong>. Not by ease. Not by fun. By <strong>impact</strong>.</p>
<p>The most important task gets #1. That's the task that, if I do nothing else tomorrow, will have moved the needle. Often it's the task I least want to do — which is exactly why it needs to be first.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-write-in-todaymd">6. Write in Today.md<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#6-write-in-todaymd" class="hash-link" aria-label="Direct link to 6. Write in Today.md" title="Direct link to 6. Write in Today.md">​</a></h3>
<p>Everything goes in a single file: <code>Today.md</code>. This is my single source of truth. Format:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token title important punctuation" style="color:rgb(248, 248, 242)">#</span><span class="token title important"> 2026-01-24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Priority Tasks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">1.</span><span class="token plain"> [ ] Complete Nashville financial due diligence report</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">2.</span><span class="token plain"> [ ] Draft Q1 2026 board memo (operational metrics)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">3.</span><span class="token plain"> [ ] Review behavioral health launch timeline with team</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">4.</span><span class="token plain"> [ ] Process 50 inbox captures (Python automation)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">5.</span><span class="token plain"> [ ] Update TELOS with Q4 outcomes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">6.</span><span class="token plain"> [ ] Write second brain blog post</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Nashville deal deadline: Jan 31</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Board memo due: Feb 5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Focus: Close deals, document systems</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Notes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [captures throughout the day]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This takes 15-20 minutes. It's an investment that saves hours the next morning.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="morning-execution-sequential-no-replanning">Morning Execution: Sequential, No Replanning<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#morning-execution-sequential-no-replanning" class="hash-link" aria-label="Direct link to Morning Execution: Sequential, No Replanning" title="Direct link to Morning Execution: Sequential, No Replanning">​</a></h2>
<p>When I wake up, I don't check email. I don't scan Slack. I don't review my calendar. I open <code>Today.md</code> and start on task #1.</p>
<p><strong>The rule is simple: Work on task #1 until it's complete, then move to task #2.</strong></p>
<p>No multitasking. No "quick" email checks. No deciding what feels right in the moment. The decision was made last night when I had context. Morning-me is an execution machine.</p>
<p>This is harder than it sounds. Your brain will fight you:</p>
<ul>
<li>"But this email just came in and it's urgent!"</li>
<li>"Task #3 looks more fun, let me just—"</li>
<li>"I'm not in the mood for task #1 right now."</li>
</ul>
<p>Ignore all of it. The priority order was set by yesterday-you, who had full context. Trust the system.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-if-task-1-is-blocked">What If Task #1 Is Blocked?<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#what-if-task-1-is-blocked" class="hash-link" aria-label="Direct link to What If Task #1 Is Blocked?" title="Direct link to What If Task #1 Is Blocked?">​</a></h3>
<p>If you genuinely can't make progress on task #1 (waiting for someone else, missing information), move to task #2. But be honest about whether it's truly blocked or whether you're just avoiding hard work.</p>
<p>Most "blocks" are excuses. If task #1 is truly blocked, your evening planning failed — you should have seen that coming and prioritized differently.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-about-interruptions">What About Interruptions?<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#what-about-interruptions" class="hash-link" aria-label="Direct link to What About Interruptions?" title="Direct link to What About Interruptions?">​</a></h3>
<p>Real interruptions are rare. Most "urgent" things can wait 2-4 hours. I batch all communication:</p>
<ul>
<li>Email: Checked at 11am and 4pm</li>
<li>Slack: Checked at 10am, 1pm, 4pm</li>
<li>Calls: Scheduled in afternoon blocks</li>
</ul>
<p>If something is genuinely on fire (clinic emergency, deal falling through), you'll know. Everything else can wait until you've made progress on your priorities.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-92-inbox-reduction-automation-case-study">The 92% Inbox Reduction: Automation Case Study<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-92-inbox-reduction-automation-case-study" class="hash-link" aria-label="Direct link to The 92% Inbox Reduction: Automation Case Study" title="Direct link to The 92% Inbox Reduction: Automation Case Study">​</a></h2>
<p>The evening planning ritual works, but there's a bottleneck: inbox processing. At one point, my <code>0. Inbox/</code> directory had 28,880 files — email captures, voice notes, quick thoughts. Processing that manually would take forever.</p>
<p>So I built automation. Here's the system:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-level-capture-architecture">Multi-Level Capture Architecture<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#multi-level-capture-architecture" class="hash-link" aria-label="Direct link to Multi-Level Capture Architecture" title="Direct link to Multi-Level Capture Architecture">​</a></h3>
<p>Knowledge work requires capturing information at different levels of friction:</p>
<p><strong>Level 1: Audio Capture</strong>
Voice memos while driving, walking, or thinking. These land in a transcription pipeline:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Whisper transcription + intelligent tagging</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.scripts/transcription/process_audio.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Level 2: Quick Capture</strong>
Email forwards, web clippings, rapid notes. These go straight to <code>0. Inbox/</code> with minimal metadata:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">created</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml datetime number">2026-01-24T08:15:00Z</span><span class="token front-matter-block front-matter yaml language-yaml"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">source</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> email</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Subject: Nashville seller response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">From: seller@example.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Date: 2026-01-24</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[content]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Level 3: Daily Processing</strong>
Evening ritual triages everything. Actionable items become tasks. Reference material moves to Resources. Junk gets archived.</p>
<p><strong>Level 4: Project/Area Integration</strong>
Important captures get linked to Projects or Areas and tagged with Substrate connections (data sources, claims, outcomes).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-python-automation-pipeline">The Python Automation Pipeline<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-python-automation-pipeline" class="hash-link" aria-label="Direct link to The Python Automation Pipeline" title="Direct link to The Python Automation Pipeline">​</a></h3>
<p>I wrote a Python script that processes inbox captures in batches:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># .scripts/inbox/process_capture.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># - Extracts metadata (subject, sender, date)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># - Categorizes by content (marketing, operations, personal)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># - Archives junk automatically</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># - Creates PARA notes for important items</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># - Links to Substrate evidence base</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The script uses pattern matching and keyword detection:</p>
<ul>
<li><strong>Marketing emails</strong> → Archived immediately (no manual review)</li>
<li><strong>Operations emails</strong> → Tagged for review, linked to relevant Area</li>
<li><strong>Project emails</strong> → Linked to active project, flagged for action</li>
<li><strong>Personal</strong> → Triaged based on sender and content</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-results">The Results<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-results" class="hash-link" aria-label="Direct link to The Results" title="Direct link to The Results">​</a></h3>
<p>Before automation:</p>
<ul>
<li><strong>707 lines</strong> in daily inbox processing</li>
<li><strong>2-3 hours</strong> of manual triage per week</li>
<li><strong>High friction</strong> = captures piling up unprocessed</li>
</ul>
<p>After automation:</p>
<ul>
<li><strong>49 lines</strong> in daily inbox processing (92% reduction)</li>
<li><strong>15-20 minutes</strong> of review per day</li>
<li><strong>Low friction</strong> = inbox stays current</li>
</ul>
<p>The automation doesn't make decisions for me — it filters noise and surfaces signal. I still review everything marked "important," but I'm not wading through marketing spam.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-bash-orchestration-layer">The Bash Orchestration Layer<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-bash-orchestration-layer" class="hash-link" aria-label="Direct link to The Bash Orchestration Layer" title="Direct link to The Bash Orchestration Layer">​</a></h3>
<p>A shell script orchestrates the daily automation:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># .scripts/process_inbox_with_codex.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 1. Collects unique capture dates from inbox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 2. Batches files by date (50 per batch)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 3. Processes each batch with Python pipeline</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 4. Safety checks (never moves entire inbox)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 5. Outputs summary for review</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Critical safety feature: The script has multiple guards to prevent accidentally moving the entire <code>0. Inbox/</code> directory. It only processes specific files, one at a time.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="code-workflow-capture--organize--distill--express">CODE Workflow: Capture → Organize → Distill → Express<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#code-workflow-capture--organize--distill--express" class="hash-link" aria-label="Direct link to CODE Workflow: Capture → Organize → Distill → Express" title="Direct link to CODE Workflow: Capture → Organize → Distill → Express">​</a></h2>
<p>The inbox automation is part of a larger workflow I call CODE (inspired by Tiago Forte's work):</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="capture">Capture<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#capture" class="hash-link" aria-label="Direct link to Capture" title="Direct link to Capture">​</a></h3>
<p>Collect information with <strong>minimum friction</strong>. If it takes more than 10 seconds to capture something, you won't do it consistently.</p>
<ul>
<li>Voice memos → Transcribed automatically</li>
<li>Emails → Forwarded to inbox</li>
<li>Web content → Clipped with minimal metadata</li>
<li>Quick thoughts → Rapid note in Obsidian</li>
</ul>
<p><strong>Goal:</strong> Never lose an idea because the capture mechanism was too heavy.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="organize">Organize<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#organize" class="hash-link" aria-label="Direct link to Organize" title="Direct link to Organize">​</a></h3>
<p>Move captures from <code>0. Inbox/</code> into PARA structure. This happens during evening planning.</p>
<ul>
<li><strong>Actionable</strong> → Becomes a task (maybe one of tomorrow's six)</li>
<li><strong>Project-related</strong> → Filed in <code>1. Projects/[project-name]/</code></li>
<li><strong>Reference</strong> → Filed in <code>3. Resources/[topic]/</code></li>
<li><strong>Maintenance</strong> → Linked to appropriate Area</li>
<li><strong>Junk</strong> → Archived (but preserved)</li>
</ul>
<p><strong>Goal:</strong> Inbox zero every evening. Everything has a home.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="distill">Distill<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#distill" class="hash-link" aria-label="Direct link to Distill" title="Direct link to Distill">​</a></h3>
<p>Extract the essence from captured information. Not every note needs distillation, but important ones do.</p>
<p>I use progressive summarization (another Tiago Forte technique):</p>
<ol>
<li><strong>Highlight key paragraphs</strong> on first read</li>
<li><strong>Bold important sentences</strong> on second review</li>
<li><strong>Highlight keywords</strong> in bold sentences</li>
<li><strong>Write 1-2 sentence summary</strong> at top of note</li>
<li><strong>Express in own words</strong> when using the knowledge</li>
</ol>
<p>This creates layers of detail. Quick review? Read the summary. Need more? Scan the highlights. Deep dive? Full note is preserved.</p>
<p><strong>Goal:</strong> Find information fast when you need it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="express">Express<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#express" class="hash-link" aria-label="Direct link to Express" title="Direct link to Express">​</a></h3>
<p>Transform knowledge into output. This is the payoff for all the capture, organization, and distillation.</p>
<ul>
<li>Blog posts (like this one)</li>
<li>Project documentation</li>
<li>Board memos</li>
<li>Code implementations</li>
<li>Strategic decisions</li>
</ul>
<p>Expression is how knowledge becomes valuable. A note that never gets used is just digital clutter.</p>
<p><strong>Goal:</strong> Create value from captured knowledge.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="progressive-disclosure-and-lazy-loading">Progressive Disclosure and Lazy Loading<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#progressive-disclosure-and-lazy-loading" class="hash-link" aria-label="Direct link to Progressive Disclosure and Lazy Loading" title="Direct link to Progressive Disclosure and Lazy Loading">​</a></h2>
<p>One principle that makes this system sustainable: <strong>progressive disclosure</strong>. Not everything needs the same level of detail.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lazy-loading-pattern">Lazy Loading Pattern<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#lazy-loading-pattern" class="hash-link" aria-label="Direct link to Lazy Loading Pattern" title="Direct link to Lazy Loading Pattern">​</a></h3>
<p>I borrowed this concept from software engineering. Instead of processing everything upfront, I process information <strong>when I need it</strong>, at the <strong>level of detail I need</strong>.</p>
<p><strong>Example: Email Capture</strong></p>
<p>Level 1 (Immediate):</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">source</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> email</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">date</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml datetime number">2026-01-24</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Subject: Nashville seller response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">From: seller@example.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[full email text]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Level 2 (When triaging):</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">source</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> email</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">date</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml datetime number">2026-01-24</span><span class="token front-matter-block front-matter yaml language-yaml"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">category</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> operations</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">area</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> arcs</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token front-matter-block front-matter yaml language-yaml">acquisitions</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">#</span><span class="token title important"> Nashville seller response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Seller agreed to $2.8M valuation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Due diligence deadline: Jan 31</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Next: Schedule site visit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Level 3 (When working on project):</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">project</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> nashville</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token front-matter-block front-matter yaml language-yaml">acquisition</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">status</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> active</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">next_action</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> Schedule site visit</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">#</span><span class="token title important"> Nashville Seller Agreement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Seller (Dr. Johnson) agreed to $2.8M valuation after initial ask of $3.2M.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Next Steps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [ ] Schedule site visit (week of Feb 3)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [ ] Complete financial DD report by Jan 31</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [ ] Draft LOI for board review</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Substrate Links</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [[PR-00007—Deal_Closing_Bottleneck]]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [[SO-00018—Early_Deal_Disqualification_Framework]]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Each level adds detail only when needed. This prevents front-loading effort on information that might not matter.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-8020-of-note-taking">The 80/20 of Note-Taking<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-8020-of-note-taking" class="hash-link" aria-label="Direct link to The 80/20 of Note-Taking" title="Direct link to The 80/20 of Note-Taking">​</a></h3>
<p>80% of notes need minimal processing:</p>
<ul>
<li>Quick capture</li>
<li>Filed in PARA</li>
<li>Searchable if needed later</li>
</ul>
<p>20% of notes deserve deep processing:</p>
<ul>
<li>Progressive summarization</li>
<li>Substrate linking</li>
<li>Actionable extraction</li>
</ul>
<p>The system lets you distinguish between them. Not everything deserves equal attention.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-ai-tools-claude-code-and-second-brain">Integration with AI Tools: Claude Code and Second Brain<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#integration-with-ai-tools-claude-code-and-second-brain" class="hash-link" aria-label="Direct link to Integration with AI Tools: Claude Code and Second Brain" title="Direct link to Integration with AI Tools: Claude Code and Second Brain">​</a></h2>
<p>My second brain isn't static — it's my thinking partner, powered by Claude Code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-claude-code-accesses-my-knowledge">How Claude Code Accesses My Knowledge<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#how-claude-code-accesses-my-knowledge" class="hash-link" aria-label="Direct link to How Claude Code Accesses My Knowledge" title="Direct link to How Claude Code Accesses My Knowledge">​</a></h3>
<p>Claude Code has read-access to my entire Obsidian vault. When I'm working on a project, I can ask:</p>
<blockquote>
<p>"What does my Substrate say about staffing optimization at Covenant?"</p>
</blockquote>
<p>Claude searches <code>0. Foundation/Substrate/</code>, finds relevant claims and data sources, and synthesizes an answer grounded in my evidence base.</p>
<p>This turns my second brain into an <strong>external memory system</strong> that an AI can query. I'm not just storing knowledge — I'm building a knowledge graph that AI can reason over.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-substrate-layer">The Substrate Layer<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-substrate-layer" class="hash-link" aria-label="Direct link to The Substrate Layer" title="Direct link to The Substrate Layer">​</a></h3>
<p>The Substrate is my addition to PARA — it's an evidence base that grounds my decision-making:</p>
<ul>
<li><strong>Problems</strong> (PR-00001, PR-00002...): What's broken?</li>
<li><strong>Claims</strong> (CL-00001, CL-00002...): What do I believe is true?</li>
<li><strong>Data Sources</strong> (DS-00001, DS-00002...): What evidence supports this?</li>
<li><strong>Solutions</strong> (SO-00001, SO-00002...): What are we trying?</li>
<li><strong>Outcomes</strong> (OUT-00001, OUT-00002...): What happened?</li>
</ul>
<p>Every strategic decision links back to the Substrate. This prevents me from making the same mistakes twice and builds institutional memory.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-inbox-processing-with-claude">Example: Inbox Processing with Claude<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#example-inbox-processing-with-claude" class="hash-link" aria-label="Direct link to Example: Inbox Processing with Claude" title="Direct link to Example: Inbox Processing with Claude">​</a></h3>
<p>I can delegate batch inbox processing to Claude Code:</p>
<blockquote>
<p>"Process the 50 inbox captures from 2026-01-23. Archive marketing emails, create PARA notes for Arcs-related items, and flag anything requiring my attention."</p>
</blockquote>
<p>Claude runs the Python automation, reviews each capture, and generates a summary:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Processed 50 captures:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> 32 marketing emails → Archived</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> 12 operations updates → Filed in Areas</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> 4 project updates → Linked to active projects</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> 2 requiring your review (flagged)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is the future of knowledge work: human-AI collaboration where the AI handles mechanical processing and the human focuses on judgment and strategy.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="complete-implementation-guide">Complete Implementation Guide<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#complete-implementation-guide" class="hash-link" aria-label="Direct link to Complete Implementation Guide" title="Direct link to Complete Implementation Guide">​</a></h2>
<p>Want to build this system yourself? Here's the step-by-step:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1-para-foundation-week-1">Phase 1: PARA Foundation (Week 1)<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#phase-1-para-foundation-week-1" class="hash-link" aria-label="Direct link to Phase 1: PARA Foundation (Week 1)" title="Direct link to Phase 1: PARA Foundation (Week 1)">​</a></h3>
<p><strong>Day 1-2: Structure Setup</strong>
Create four top-level folders:</p>
<ul>
<li><code>1. Projects/</code></li>
<li><code>2. Areas/</code></li>
<li><code>3. Resources/</code></li>
<li><code>4. Archive/</code></li>
</ul>
<p><strong>Day 3-4: Inventory Your Work</strong>
List everything you're working on. Distinguish:</p>
<ul>
<li>Has a deadline and outcome? → Project</li>
<li>Ongoing responsibility? → Area</li>
<li>Reference material? → Resource</li>
</ul>
<p><strong>Day 5-7: Initial Organization</strong>
Move existing notes into PARA structure. Don't obsess over perfection — you'll refine as you use the system.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2-daily-6-task-system-week-2">Phase 2: Daily 6-Task System (Week 2)<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#phase-2-daily-6-task-system-week-2" class="hash-link" aria-label="Direct link to Phase 2: Daily 6-Task System (Week 2)" title="Direct link to Phase 2: Daily 6-Task System (Week 2)">​</a></h3>
<p><strong>Day 1: Evening Planning</strong>
Tonight, before bed, write tomorrow's six tasks in priority order. Use a simple <code>Today.md</code> file.</p>
<p><strong>Day 2-7: Execution Practice</strong>
Each morning, start with task #1. Work sequentially. Notice when your brain tries to cheat the system.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3-inbox-processing-week-3-4">Phase 3: Inbox Processing (Week 3-4)<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#phase-3-inbox-processing-week-3-4" class="hash-link" aria-label="Direct link to Phase 3: Inbox Processing (Week 3-4)" title="Direct link to Phase 3: Inbox Processing (Week 3-4)">​</a></h3>
<p><strong>Week 3: Manual Triage</strong>
Create <code>0. Inbox/</code> folder. Capture everything there. Process it during evening planning using CODE workflow.</p>
<p><strong>Week 4: Automation</strong>
If you're technical, build simple automation:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Quick triage script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">for file in 0.\ Inbox/*.md; do</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if grep -q "marketing" "$file"; then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mv "$file" "4. Archive/Marketing/"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Start simple. Automate the obvious patterns first.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-4-substrate-evidence-base-ongoing">Phase 4: Substrate Evidence Base (Ongoing)<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#phase-4-substrate-evidence-base-ongoing" class="hash-link" aria-label="Direct link to Phase 4: Substrate Evidence Base (Ongoing)" title="Direct link to Phase 4: Substrate Evidence Base (Ongoing)">​</a></h3>
<p>This is advanced — only needed if you're making high-stakes decisions or building institutional memory.</p>
<p>Create:</p>
<ul>
<li><code>Problems/</code> - What's broken?</li>
<li><code>Solutions/</code> - What are we trying?</li>
<li><code>Outcomes/</code> - What happened?</li>
</ul>
<p>Link your projects and decisions to these evidence-based entries.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="templates-and-tools">Templates and Tools<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#templates-and-tools" class="hash-link" aria-label="Direct link to Templates and Tools" title="Direct link to Templates and Tools">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="todaymd-template">Today.md Template<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#todaymd-template" class="hash-link" aria-label="Direct link to Today.md Template" title="Direct link to Today.md Template">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token title important punctuation" style="color:rgb(248, 248, 242)">#</span><span class="token title important"> [Date]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Priority Tasks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">1.</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Most important task</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">2.</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Second priority</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">3.</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Third priority</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">4.</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Fourth priority</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">5.</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Fifth priority</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">6.</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Sixth priority</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Key deadline: [date]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Focus theme: [one word]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Meeting: [if any]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Notes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Captures throughout day]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Evening Review</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Completed: [count]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Rolled forward: [which tasks and why]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> Tomorrow's theme: [one word]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="project-template">Project Template<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#project-template" class="hash-link" aria-label="Direct link to Project Template" title="Direct link to Project Template">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">status</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> active</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">start_date</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> YYYY</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token front-matter-block front-matter yaml language-yaml">MM</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token front-matter-block front-matter yaml language-yaml">DD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">target_date</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> YYYY</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token front-matter-block front-matter yaml language-yaml">MM</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token front-matter-block front-matter yaml language-yaml">DD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">area</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token front-matter-block front-matter yaml language-yaml">which area this belongs to</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">#</span><span class="token title important"> [Project Name]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Goal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[What success looks like - one sentence]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Why Now</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Why this matters and why it's time-bound]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Success Metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Concrete outcome 1</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Concrete outcome 2</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Concrete outcome 3</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Next Actions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Immediate next step</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [[Link to relevant resources]]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> YYYY-MM-DD: [Progress note]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="area-template">Area Template<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#area-template" class="hash-link" aria-label="Direct link to Area Template" title="Direct link to Area Template">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">type</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> area</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">standard</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token front-matter-block front-matter yaml language-yaml">What "good" looks like</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token front-matter-block front-matter yaml language-yaml"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">review_frequency</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token front-matter-block front-matter yaml language-yaml">weekly/monthly</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token front-matter-block"></span><span class="token front-matter-block punctuation" style="color:rgb(248, 248, 242)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">#</span><span class="token title important"> [Area Name]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Purpose</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Why this area exists]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Standards</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [Standard 1]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [Standard 2]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Current Projects</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [[Project 1]]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [[Project 2]]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Maintenance Tasks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Recurring task 1</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token url">[</span><span class="token url content"> </span><span class="token url">] [</span><span class="token url variable" style="color:rgb(189, 147, 249);font-style:italic">Recurring task 2</span><span class="token url">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token title important punctuation" style="color:rgb(248, 248, 242)">##</span><span class="token title important"> Resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token list punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> [[Relevant resources]]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="common-pitfalls-and-how-to-avoid-them">Common Pitfalls and How to Avoid Them<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#common-pitfalls-and-how-to-avoid-them" class="hash-link" aria-label="Direct link to Common Pitfalls and How to Avoid Them" title="Direct link to Common Pitfalls and How to Avoid Them">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-1-organizing-instead-of-working">Pitfall 1: Organizing Instead of Working<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#pitfall-1-organizing-instead-of-working" class="hash-link" aria-label="Direct link to Pitfall 1: Organizing Instead of Working" title="Direct link to Pitfall 1: Organizing Instead of Working">​</a></h3>
<p><strong>Symptom:</strong> You spend more time organizing notes than doing actual work.</p>
<p><strong>Fix:</strong> Set a timer. Inbox processing gets 20 minutes per day, maximum. If it takes longer, your capture process is too heavy or your automation is missing.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-2-perfect-categories">Pitfall 2: Perfect Categories<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#pitfall-2-perfect-categories" class="hash-link" aria-label="Direct link to Pitfall 2: Perfect Categories" title="Direct link to Pitfall 2: Perfect Categories">​</a></h3>
<p><strong>Symptom:</strong> You agonize over whether something is a Project or an Area, or which folder it belongs in.</p>
<p><strong>Fix:</strong> Use the time-based distinction. Has a deadline? Project. Ongoing? Area. When in doubt, search works better than perfect filing anyway.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-3-task-list-bloat">Pitfall 3: Task List Bloat<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#pitfall-3-task-list-bloat" class="hash-link" aria-label="Direct link to Pitfall 3: Task List Bloat" title="Direct link to Pitfall 3: Task List Bloat">​</a></h3>
<p><strong>Symptom:</strong> Your "six" tasks expand to 10, then 15, then 20.</p>
<p><strong>Fix:</strong> Enforce the constraint ruthlessly. If seven things are important, rank them 1-7 and only put 1-6 in today's list. Task #7 goes on tomorrow's list.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-4-not-processing-inbox">Pitfall 4: Not Processing Inbox<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#pitfall-4-not-processing-inbox" class="hash-link" aria-label="Direct link to Pitfall 4: Not Processing Inbox" title="Direct link to Pitfall 4: Not Processing Inbox">​</a></h3>
<p><strong>Symptom:</strong> Your <code>0. Inbox/</code> has thousands of files and you've given up.</p>
<p><strong>Fix:</strong> Declare inbox bankruptcy. Move everything older than 30 days to Archive. Start fresh. Unprocessed old captures won't magically become important.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-5-skipping-evening-planning">Pitfall 5: Skipping Evening Planning<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#pitfall-5-skipping-evening-planning" class="hash-link" aria-label="Direct link to Pitfall 5: Skipping Evening Planning" title="Direct link to Pitfall 5: Skipping Evening Planning">​</a></h3>
<p><strong>Symptom:</strong> You wake up without a plan and waste morning hours deciding what to work on.</p>
<p><strong>Fix:</strong> Make evening planning non-negotiable. It's 20 minutes that saves 2 hours the next day. Block it on your calendar if needed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-philosophy-systems-over-willpower">The Philosophy: Systems Over Willpower<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#the-philosophy-systems-over-willpower" class="hash-link" aria-label="Direct link to The Philosophy: Systems Over Willpower" title="Direct link to The Philosophy: Systems Over Willpower">​</a></h2>
<p>The 6-Task System works because it removes decisions from the moment when willpower is lowest.</p>
<p>Morning-you is tired, distracted, and susceptible to the dopamine hit of easy wins. Morning-you will choose email over deep work every time.</p>
<p>Evening-you has context. You know what happened today, what's coming tomorrow, what really matters. Evening-you makes better decisions.</p>
<p>The system is a <strong>commitment device</strong>. You're making a promise to tomorrow-you about what matters. Then tomorrow-you honors that commitment by executing sequentially.</p>
<p>This is how you compound productivity:</p>
<ul>
<li>Better decisions (evening planning)</li>
<li>Better execution (sequential focus)</li>
<li>Better outcomes (priorities actually completed)</li>
<li>Better learning (evening review)</li>
</ul>
<p>Repeat daily. Watch the flywheel spin.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion-the-system-that-adapts">Conclusion: The System That Adapts<a href="https://jonroosevelt.com/blog/six-task-system-para-ivy-lee-productivity#conclusion-the-system-that-adapts" class="hash-link" aria-label="Direct link to Conclusion: The System That Adapts" title="Direct link to Conclusion: The System That Adapts">​</a></h2>
<p>I've been using this system for six months. It's transformed how I work. But the specifics will evolve — and yours should too.</p>
<p>The principles stay constant:</p>
<ul>
<li><strong>Constraint breeds clarity</strong> (six tasks, not infinite)</li>
<li><strong>Sequential execution</strong> (finish one before starting another)</li>
<li><strong>Evening planning</strong> (decide with context, execute with focus)</li>
<li><strong>PARA organization</strong> (time-based, not category-based)</li>
<li><strong>Progressive disclosure</strong> (process information at the level you need it)</li>
<li><strong>Automation</strong> (eliminate mechanical work)</li>
</ul>
<p>The implementation flexes. Maybe you need seven tasks, not six. Maybe your evening ritual is 30 minutes, not 20. Maybe you organize by project stage instead of PARA categories.</p>
<p>That's fine. The system serves you — you don't serve the system.</p>
<p>Start simple:</p>
<ol>
<li>Tonight, write six tasks for tomorrow</li>
<li>Tomorrow, work on them sequentially</li>
<li>Repeat</li>
</ol>
<p>Everything else — PARA, automation, Substrate — can come later. The 6-Task System is the foundation. Build from there.</p>
<p>Your most productive days aren't the ones where you checked the most boxes. They're the ones where you moved your most important work forward. Six tasks. Strict priority order. Sequential execution.</p>
<p>That's the system.</p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Productivity" term="Productivity"/>
        <category label="Knowledge Management" term="Knowledge Management"/>
        <category label="Personal Systems" term="Personal Systems"/>
        <category label="Automation" term="Automation"/>
        <category label="Second Brain" term="Second Brain"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Why Terminal Multiplexers Are an Anti-Pattern: Lessons from Kitty's Creator]]></title>
        <id>https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers</id>
        <link href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[If you're a developer, you probably use tmux or screen. You might even consider it essential infrastructure. But according to Kovid Goyal, creator of the Kitty terminal emulator, terminal multiplexers are architecturally flawed — a design pattern that creates more problems than it solves for local development. His argument isn't philosophical; it's deeply technical, and it changed how I think about my terminal workflow.]]></summary>
        <content type="html"><![CDATA[<p>If you're a developer, you probably use tmux or screen. You might even consider it essential infrastructure. But according to Kovid Goyal, creator of the Kitty terminal emulator, terminal multiplexers are architecturally flawed — a design pattern that creates more problems than it solves for local development. His argument isn't philosophical; it's deeply technical, and it changed how I think about my terminal workflow.</p>
<p><img decoding="async" loading="lazy" alt="Terminal Design Philosophy" src="https://jonroosevelt.com/assets/images/hero-banner-1f4b9cb138829d945c3f2d4293415692.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-three-fundamental-problems">The Three Fundamental Problems<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#the-three-fundamental-problems" class="hash-link" aria-label="Direct link to The Three Fundamental Problems" title="Direct link to The Three Fundamental Problems">​</a></h2>
<p>Goyal identifies three architectural issues with traditional terminal multiplexers that can't be solved by better implementation — they're inherent to the design:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-doubled-cpu-cost">1. Doubled CPU Cost<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#1-doubled-cpu-cost" class="hash-link" aria-label="Direct link to 1. Doubled CPU Cost" title="Direct link to 1. Doubled CPU Cost">​</a></h3>
<p>A terminal multiplexer works by implementing a terminal inside a terminal. Every byte of data from your application gets interpreted by <strong>two</strong> terminal emulators: first the multiplexer, then your actual terminal. This is an unavoidable doubling of processing cost. No amount of optimization in tmux's codebase can eliminate it — it's the architecture itself.</p>
<p>For simple text output, this overhead is negligible. For high-throughput scenarios (streaming logs, large file diffs, build output), it's measurable.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-ecosystem-evolution-drag">2. Ecosystem Evolution Drag<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#2-ecosystem-evolution-drag" class="hash-link" aria-label="Direct link to 2. Ecosystem Evolution Drag" title="Direct link to 2. Ecosystem Evolution Drag">​</a></h3>
<p>This is the more insidious problem that most users don't consider. For any new terminal feature to reach end users, it must be supported by <strong>both</strong> the terminal emulator and the multiplexer. The multiplexer becomes a gatekeeper for innovation.</p>
<p>Consider Kitty's graphics protocol, which allows inline image rendering in the terminal. For users running tmux, this feature requires tmux to also implement support for the protocol. Until then, those users simply can't use it — regardless of what their terminal supports.</p>
<p>This creates a dependency chain where feature adoption is bottlenecked by the slowest-moving component. And when multiplexer maintainers aren't interested in supporting new features (as happened with Kitty's attempts to coordinate with the tmux maintainer), the ecosystem stalls.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-state-machine-bridging-complexity">3. State Machine Bridging Complexity<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#3-state-machine-bridging-complexity" class="hash-link" aria-label="Direct link to 3. State Machine Bridging Complexity" title="Direct link to 3. State Machine Bridging Complexity">​</a></h3>
<p>A terminal emulator is a massive state machine: current text color, decorations, underlines, cursor modes, hundreds of escape code behaviors. A terminal multiplexer must maintain its <strong>own</strong> state machine AND translate between its state and the host terminal's state — two slightly different, enormously complex state machines that must be bridged in real-time.</p>
<p>The simplest example: a carriage return (<code>\r</code>) normally moves the cursor to the beginning of the line. In a tmux split pane, the multiplexer must intercept this and rewrite it as a cursor movement code that goes to the beginning of the <em>right pane</em> (which is actually the middle of the screen from the terminal's perspective). And carriage return is literally the simplest case.</p>
<p>Search any sophisticated terminal program's bug tracker for "tmux" and you'll find a category of bugs that only occur inside multiplexers — practical proof of this architectural complexity.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-alternative-separation-of-concerns">The Alternative: Separation of Concerns<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#the-alternative-separation-of-concerns" class="hash-link" aria-label="Direct link to The Alternative: Separation of Concerns" title="Direct link to The Alternative: Separation of Concerns">​</a></h2>
<p>If Goyal were to design a multiplexer, he'd invert the architecture:</p>
<ul>
<li><strong>The terminal handles</strong>: window management, splitting, visual display (what it's already designed for)</li>
<li><strong>The multiplexer handles</strong>: session persistence only (the one thing terminals can't do)</li>
</ul>
<p>In this model, each window gets a dedicated TTY. No state bridging required. Carriage returns "just work." Escape codes pass through unmodified. New terminal features work immediately without multiplexer support.</p>
<p>The trade-off: this approach requires the terminal to support specific features, so it's not universal like tmux. But for users who've committed to a terminal emulator, it's strictly better.</p>
<p>WezTerm has already implemented this approach with its built-in multiplexer. Kitty provides the building blocks through its remote control API.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kittys-building-block-philosophy">Kitty's Building-Block Philosophy<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#kittys-building-block-philosophy" class="hash-link" aria-label="Direct link to Kitty's Building-Block Philosophy" title="Direct link to Kitty's Building-Block Philosophy">​</a></h2>
<p>Rather than providing a monolithic multiplexer, Kitty offers composable primitives:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># List all windows with process info (JSON output)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kitten @ ls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Focus a specific window by match criteria</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kitten @ focus-window --match &lt;criteria&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Focus tabs (OS-level windows)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kitten @ focus-tab &lt;tab-id&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The philosophy: give users building blocks and let them compose their own workflows. This is fundamentally different from tmux's approach of providing a complete (but rigid) session management system.</p>
<p>For users who use tmux primarily for session switching (not persistence), Kitty's approach works:</p>
<ol>
<li>Query running sessions with <code>kitten @ ls</code></li>
<li>Parse with jq to find your target</li>
<li>Switch to the session tab if it exists, create if not</li>
<li>Wrap in a script bound to a hotkey</li>
</ol>
<p>It's more work upfront, but the result is a workflow that's exactly what you need — no more, no less.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-one-valid-use-case-for-tmux">The One Valid Use Case for tmux<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#the-one-valid-use-case-for-tmux" class="hash-link" aria-label="Direct link to The One Valid Use Case for tmux" title="Direct link to The One Valid Use Case for tmux">​</a></h2>
<p>Goyal is direct about where traditional multiplexers remain useful: <strong>remote persistence over flaky connections</strong>. When you SSH into a server and your connection might drop, you need the running process to survive the disconnection. This requires a server-side process that owns the TTY independent of your connection — exactly what tmux/screen provides.</p>
<p>For local development? Goyal's position is that multiplexers are "completely an anti-pattern." Everything you do locally with tmux can be done just as well (or better) with native terminal features.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="remote-control-beyond-local">Remote Control Beyond Local<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#remote-control-beyond-local" class="hash-link" aria-label="Direct link to Remote Control Beyond Local" title="Direct link to Remote Control Beyond Local">​</a></h2>
<p>Kitty's remote control isn't limited to the local machine:</p>
<ul>
<li>Works within Kitty (local process communication)</li>
<li>Works from outside Kitty (cross-process on the same machine)</li>
<li>Can use a TCP port (cross-machine on a local network)</li>
<li>Fully scriptable and composable</li>
</ul>
<p>This opens interesting possibilities for custom development workflows that span multiple machines without the overhead of a traditional multiplexer architecture.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-i-changed-in-my-workflow">What I Changed in My Workflow<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#what-i-changed-in-my-workflow" class="hash-link" aria-label="Direct link to What I Changed in My Workflow" title="Direct link to What I Changed in My Workflow">​</a></h2>
<p>After understanding these architectural arguments, I reconsidered my tmux dependency:</p>
<ol>
<li><strong>Local development</strong>: Switched to terminal-native window management. Splits are handled by the terminal, sessions by tabs/OS windows.</li>
<li><strong>Remote servers</strong>: Kept tmux for the one thing it's genuinely needed for — session persistence over SSH.</li>
<li><strong>Custom scripts</strong>: Built lightweight shell scripts for the session-switching behavior I actually used tmux for.</li>
</ol>
<p>The result: fewer mysterious rendering bugs, faster terminal output, and workflows that exactly match my needs instead of conforming to tmux's opinions about how I should work.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-broader-lesson">The Broader Lesson<a href="https://jonroosevelt.com/blog/terminal-design-philosophy-rethinking-multiplexers#the-broader-lesson" class="hash-link" aria-label="Direct link to The Broader Lesson" title="Direct link to The Broader Lesson">​</a></h2>
<p>The terminal multiplexer debate illustrates a pattern that shows up across software engineering: <strong>solutions that were elegant in one era become legacy drag in the next</strong>. Tmux solved real problems when terminals were dumb and couldn't manage multiple sessions. Modern terminals can do all of that natively — but we keep using the middleman out of habit.</p>
<p>The question isn't "is tmux bad?" — it's "does the architecture still make sense given what terminals can do today?" For remote persistence, yes. For everything else, it's worth asking whether you're paying an architectural tax for features your terminal already provides.</p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Developer Tools" term="Developer Tools"/>
        <category label="Architecture" term="Architecture"/>
        <category label="Performance Optimization" term="Performance Optimization"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The Universal Algorithm: How One Framework Scales from Bug Fixes to Building Companies]]></title>
        <id>https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework</id>
        <link href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[What if one algorithm could handle everything—from fixing a typo to architecting a distributed system to building an entire company? Not a vague philosophy, but a precise, verifiable framework with measurable progress tracking.]]></summary>
        <content type="html"><![CDATA[<p>What if one algorithm could handle everything—from fixing a typo to architecting a distributed system to building an entire company? Not a vague philosophy, but a precise, verifiable framework with measurable progress tracking.</p>
<p>I spent six months building Personal AI Infrastructure (PAI) v2.1, an agent execution system that uses the same algorithm whether you're debugging a function or designing multi-year product strategies. The breakthrough wasn't in finding a universal algorithm—it was in discovering that the algorithm was already universal. We just needed to see it clearly.</p>
<p><img decoding="async" loading="lazy" alt="Universal Algorithm Framework" src="https://jonroosevelt.com/assets/images/hero-banner-d43a6bb11bc77a66c13b489c626abc48.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem-with-task-specific-thinking">The Problem with Task-Specific Thinking<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#the-problem-with-task-specific-thinking" class="hash-link" aria-label="Direct link to The Problem with Task-Specific Thinking" title="Direct link to The Problem with Task-Specific Thinking">​</a></h2>
<p>Most developer tools operate on the assumption that different problems require different approaches. You have one workflow for fixing bugs, another for writing features, a third for architectural planning. Each context switch requires mental overhead—different commands, different tools, different mental models.</p>
<p>I noticed this pattern while watching myself work. When debugging, I'd follow an implicit process: observe the error, understand the code, plan a fix, implement it, verify it works. When architecting a new system, the same pattern emerged at a different scale: observe requirements, think through constraints, plan the architecture, build components, verify integration, learn from results.</p>
<p>The structure was identical. Only the scope changed.</p>
<p>This realization led to a question: what if we could formalize this pattern into a single algorithm that works at every scale?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-universal-algorithm-current--ideal-via-verifiable-iteration">The Universal Algorithm: Current → Ideal via Verifiable Iteration<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#the-universal-algorithm-current--ideal-via-verifiable-iteration" class="hash-link" aria-label="Direct link to The Universal Algorithm: Current → Ideal via Verifiable Iteration" title="Direct link to The Universal Algorithm: Current → Ideal via Verifiable Iteration">​</a></h2>
<p>The core insight is deceptively simple:</p>
<p><strong>Every task is a gap between current state and ideal state, closed through verifiable iteration.</strong></p>
<p>This translates into seven phases that repeat until completion:</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1-observe---establish-current-state">Phase 1: OBSERVE - Establish Current State<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#phase-1-observe---establish-current-state" class="hash-link" aria-label="Direct link to Phase 1: OBSERVE - Establish Current State" title="Direct link to Phase 1: OBSERVE - Establish Current State">​</a></h3>
<p>Every iteration begins with ruthless clarity about where you are. Not where you think you are, or where you should be—where you actually are.</p>
<p>For a bug fix, this means reading error messages, examining stack traces, understanding the failing behavior. For system architecture, this means auditing existing services, measuring current performance, documenting constraints.</p>
<p>The OBSERVE phase produces artifacts:</p>
<ul>
<li>Current state measurements (performance metrics, test results, user feedback)</li>
<li>Constraints (technical debt, dependencies, compliance requirements)</li>
<li>Available resources (time, budget, team capacity)</li>
</ul>
<p><strong>Critical principle:</strong> Observations must be verifiable. "The system is slow" is not an observation. "API p95 latency is 2.3 seconds, target is 500ms" is an observation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2-think---analyze-the-gap">Phase 2: THINK - Analyze the Gap<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#phase-2-think---analyze-the-gap" class="hash-link" aria-label="Direct link to Phase 2: THINK - Analyze the Gap" title="Direct link to Phase 2: THINK - Analyze the Gap">​</a></h3>
<p>With current state established, THINK identifies what's missing and why. This is pattern recognition, root cause analysis, and strategic thinking combined.</p>
<p>For a bug, THINK traces causality: what code path produces the error? What conditions trigger it? What invariants are violated?</p>
<p>For architecture, THINK examines trade-offs: what capabilities are missing? What bottlenecks exist? What technical decisions created the current constraints?</p>
<p>The THINK phase produces:</p>
<ul>
<li>Root cause analysis</li>
<li>Constraint identification</li>
<li>Alternative approaches</li>
<li>Risk assessment</li>
</ul>
<p><strong>Key insight:</strong> THINK doesn't make decisions—it surfaces options. Decision-making happens in PLAN.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3-plan---define-verifiable-steps">Phase 3: PLAN - Define Verifiable Steps<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#phase-3-plan---define-verifiable-steps" class="hash-link" aria-label="Direct link to Phase 3: PLAN - Define Verifiable Steps" title="Direct link to Phase 3: PLAN - Define Verifiable Steps">​</a></h3>
<p>PLAN converts analysis into actionable steps with explicit success criteria. Every plan must answer three questions:</p>
<ol>
<li><strong>What are we building?</strong> (Specific deliverables)</li>
<li><strong>How do we know it works?</strong> (Verification criteria)</li>
<li><strong>How much effort does this require?</strong> (Resource allocation)</li>
</ol>
<p>Plans are hierarchical. A company-building plan contains multiple system-architecture plans, which contain multiple feature-development plans, which contain multiple bug-fix plans.</p>
<p>The PLAN phase produces:</p>
<ul>
<li>Ordered task list with dependencies</li>
<li>Ideal State Criteria (ISC) for verification</li>
<li>Effort classification (TRIVIAL → DETERMINED)</li>
<li>Model selection for execution</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-4-build---create-artifacts">Phase 4: BUILD - Create Artifacts<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#phase-4-build---create-artifacts" class="hash-link" aria-label="Direct link to Phase 4: BUILD - Create Artifacts" title="Direct link to Phase 4: BUILD - Create Artifacts">​</a></h3>
<p>BUILD is where we create the things needed for execution. For code, this means writing functions, tests, documentation. For systems, this means designing APIs, data models, deployment configurations. For companies, this means drafting strategy documents, hiring plans, financial models.</p>
<p>BUILD is distinct from EXECUTE. You build a migration script (BUILD) before you run it against production (EXECUTE). You build a pitch deck (BUILD) before you present it to investors (EXECUTE).</p>
<p>The BUILD phase produces:</p>
<ul>
<li>Code, tests, configurations</li>
<li>Documentation, diagrams, specifications</li>
<li>Scripts, automation, tooling</li>
<li>Communications, presentations, reports</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-5-execute---take-action">Phase 5: EXECUTE - Take Action<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#phase-5-execute---take-action" class="hash-link" aria-label="Direct link to Phase 5: EXECUTE - Take Action" title="Direct link to Phase 5: EXECUTE - Take Action">​</a></h3>
<p>EXECUTE runs the artifacts from BUILD in the real world. This is where you actually ship code, migrate databases, deploy infrastructure, send emails, make decisions.</p>
<p>EXECUTE is the only phase that changes external state. All other phases operate on information and plans.</p>
<p>The EXECUTE phase produces:</p>
<ul>
<li>State changes (deployed code, sent messages, created resources)</li>
<li>Execution logs and traces</li>
<li>Immediate feedback from actions taken</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-6-verify---measure-progress">Phase 6: VERIFY - Measure Progress<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#phase-6-verify---measure-progress" class="hash-link" aria-label="Direct link to Phase 6: VERIFY - Measure Progress" title="Direct link to Phase 6: VERIFY - Measure Progress">​</a></h3>
<p>VERIFY compares outcomes against Ideal State Criteria defined in PLAN. This isn't subjective—every ISC is a boolean condition that evaluates to true or false.</p>
<p>For code:</p>
<ul>
<li>ISC 1: All unit tests pass</li>
<li>ISC 2: Existing features still work</li>
<li>ISC 3: API latency under 500ms at p95</li>
</ul>
<p>For architecture:</p>
<ul>
<li>ISC 1: System handles 10k concurrent users</li>
<li>ISC 2: Uptime exceeds 99.9%</li>
<li>ISC 3: All services emit metrics</li>
</ul>
<p>VERIFY produces a gap analysis: which criteria are met, which aren't, what's the delta.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-7-learn---update-context">Phase 7: LEARN - Update Context<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#phase-7-learn---update-context" class="hash-link" aria-label="Direct link to Phase 7: LEARN - Update Context" title="Direct link to Phase 7: LEARN - Update Context">​</a></h3>
<p>LEARN converts the iteration's results into knowledge that informs future iterations. This is where you update your mental model, document discoveries, refine estimates, adjust plans.</p>
<p>What worked? What didn't? What surprised you? What assumptions were wrong?</p>
<p>The LEARN phase produces:</p>
<ul>
<li>Updated context and assumptions</li>
<li>Refined estimates for remaining work</li>
<li>Documentation of decisions and rationale</li>
<li>Trigger for next iteration (continue loop or exit)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="isc-tracking-measuring-the-gap">ISC Tracking: Measuring the Gap<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#isc-tracking-measuring-the-gap" class="hash-link" aria-label="Direct link to ISC Tracking: Measuring the Gap" title="Direct link to ISC Tracking: Measuring the Gap">​</a></h2>
<p>The Ideal State Criteria (ISC) system is what makes this framework verifiable. Every task defines upfront what "done" means as a set of boolean conditions.</p>
<p>Here's a real example from a database migration task:</p>
<p><strong>Migration ISC Criteria:</strong></p>
<ol>
<li>New schema deployed to staging (verifiable via SQL query)</li>
<li>All user records migrated (count matches source table)</li>
<li>Data integrity checks pass (0 mismatches found)</li>
<li>Rollback procedure verified (returns data to original state)</li>
</ol>
<p>After each iteration, we evaluate all criteria and update status. Progress is mechanical: count of completed criteria divided by total criteria.</p>
<p>When progress reaches 100%, the task is complete. Not "probably done" or "looks good enough"—provably complete because all defined success criteria are met.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-ralph-loop-persistent-iteration-until-completion">The Ralph Loop: Persistent Iteration Until Completion<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#the-ralph-loop-persistent-iteration-until-completion" class="hash-link" aria-label="Direct link to The Ralph Loop: Persistent Iteration Until Completion" title="Direct link to The Ralph Loop: Persistent Iteration Until Completion">​</a></h2>
<p>The Universal Algorithm becomes powerful when wrapped in what I call the Ralph Loop—named after the principle of relentless pursuit until verified completion.</p>
<p>The loop executes one full cycle of the seven phases, then checks ISC status. If criteria remain unmet, it loops again. And again. Until either:</p>
<ol>
<li>All ISC criteria are satisfied (success)</li>
<li>An unresolvable blocker is encountered (requires external intervention)</li>
<li>Max iterations are reached (prevents infinite loops on time-boxed tasks)</li>
</ol>
<p>For DETERMINED tasks like building companies, max iterations is effectively infinite. The loop persists across days, weeks, months—however long it takes to satisfy all criteria.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="effort-classification-and-model-selection">Effort Classification and Model Selection<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#effort-classification-and-model-selection" class="hash-link" aria-label="Direct link to Effort Classification and Model Selection" title="Direct link to Effort Classification and Model Selection">​</a></h2>
<p>Not all tasks require the same resources. PAI defines five effort levels that determine both iteration depth and model selection:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="trivial-1-2-iterations-haiku">TRIVIAL (1-2 iterations, Haiku)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#trivial-1-2-iterations-haiku" class="hash-link" aria-label="Direct link to TRIVIAL (1-2 iterations, Haiku)" title="Direct link to TRIVIAL (1-2 iterations, Haiku)">​</a></h3>
<ul>
<li>Simple, well-defined tasks with obvious solutions</li>
<li>Examples: typo fixes, config updates, adding a log statement</li>
<li>Model: Claude Haiku (fast, cheap, sufficient for straightforward work)</li>
<li>Max iterations: 3</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quick-3-5-iterations-haikusonnet">QUICK (3-5 iterations, Haiku/Sonnet)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#quick-3-5-iterations-haikusonnet" class="hash-link" aria-label="Direct link to QUICK (3-5 iterations, Haiku/Sonnet)" title="Direct link to QUICK (3-5 iterations, Haiku/Sonnet)">​</a></h3>
<ul>
<li>Straightforward tasks requiring some analysis</li>
<li>Examples: implementing a simple function, writing a test, fixing a bug</li>
<li>Model: Haiku for OBSERVE/THINK, Sonnet for complex BUILD</li>
<li>Max iterations: 10</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="standard-5-15-iterations-sonnet">STANDARD (5-15 iterations, Sonnet)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#standard-5-15-iterations-sonnet" class="hash-link" aria-label="Direct link to STANDARD (5-15 iterations, Sonnet)" title="Direct link to STANDARD (5-15 iterations, Sonnet)">​</a></h3>
<ul>
<li>Typical feature development with moderate complexity</li>
<li>Examples: building a REST endpoint, refactoring a module, optimizing a query</li>
<li>Model: Sonnet for all phases</li>
<li>Max iterations: 25</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="thorough-15-50-iterations-sonnetopus">THOROUGH (15-50 iterations, Sonnet/Opus)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#thorough-15-50-iterations-sonnetopus" class="hash-link" aria-label="Direct link to THOROUGH (15-50 iterations, Sonnet/Opus)" title="Direct link to THOROUGH (15-50 iterations, Sonnet/Opus)">​</a></h3>
<ul>
<li>Complex features requiring deep analysis and careful verification</li>
<li>Examples: designing a new service, implementing security features, complex migrations</li>
<li>Model: Sonnet primary, Opus for critical THINK/VERIFY phases</li>
<li>Max iterations: 75</li>
<li>State persistence: checkpoint after every 5 iterations</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="determined-50-iterations-opus">DETERMINED (50+ iterations, Opus)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#determined-50-iterations-opus" class="hash-link" aria-label="Direct link to DETERMINED (50+ iterations, Opus)" title="Direct link to DETERMINED (50+ iterations, Opus)">​</a></h3>
<ul>
<li>Major initiatives with long time horizons</li>
<li>Examples: architecture overhauls, new product launches, company strategy</li>
<li>Model: Opus for all phases requiring strategic thinking</li>
<li>Max iterations: Infinite</li>
<li>State persistence: checkpoint after every iteration</li>
<li>Multi-agent collaboration enabled</li>
</ul>
<p>The effort classification controls concrete system behavior—which AI model to use for each phase, how often to checkpoint state, when to enable multi-agent coordination.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="case-study-1-bug-fix-quick---4-iterations">Case Study 1: Bug Fix (QUICK - 4 iterations)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#case-study-1-bug-fix-quick---4-iterations" class="hash-link" aria-label="Direct link to Case Study 1: Bug Fix (QUICK - 4 iterations)" title="Direct link to Case Study 1: Bug Fix (QUICK - 4 iterations)">​</a></h2>
<p>Let's trace a concrete example: fixing a bug where API requests occasionally timeout.</p>
<p><strong>Iteration 1:</strong></p>
<p><strong>OBSERVE:</strong> Review error logs, identify timeout pattern (occurs under load, p95 latency 8s, timeout set to 5s)</p>
<p><strong>THINK:</strong> Root cause hypothesis: database query missing index, causing slow table scans under load</p>
<p><strong>PLAN:</strong></p>
<ul>
<li>ISC 1: Identify slow queries in production logs</li>
<li>ISC 2: Add appropriate indexes</li>
<li>ISC 3: Verify p95 latency under 500ms</li>
<li>ISC 4: No timeouts in 1 hour of production traffic</li>
<li>Effort: QUICK (database optimization is straightforward)</li>
</ul>
<p><strong>BUILD:</strong> Write query to analyze slow query log, design index schema</p>
<p><strong>EXECUTE:</strong> Run analysis against production logs</p>
<p><strong>VERIFY:</strong> ISC 1 completed (found slow query on orders table), ISC 2-4 pending</p>
<p><strong>LEARN:</strong> Query scans 2M rows for active users, created_at column not indexed</p>
<p><strong>Iteration 2:</strong></p>
<p><strong>OBSERVE:</strong> Confirmed missing index on orders.created_at</p>
<p><strong>THINK:</strong> Adding index will speed lookups but increase write cost (acceptable trade-off)</p>
<p><strong>PLAN:</strong> Add compound index on (user_id, created_at), test in staging first</p>
<p><strong>BUILD:</strong> Migration script with rollback procedure</p>
<p><strong>EXECUTE:</strong> Run migration in staging</p>
<p><strong>VERIFY:</strong> ISC 2 completed (index created), ISC 3-4 still pending</p>
<p><strong>LEARN:</strong> Staging tests show 95% latency reduction (8s → 400ms)</p>
<p><strong>Iteration 3:</strong></p>
<p><strong>OBSERVE:</strong> Staging performing well, no issues detected</p>
<p><strong>THINK:</strong> Safe to deploy to production, monitoring critical</p>
<p><strong>PLAN:</strong> Production migration during low-traffic window, 1-hour monitoring</p>
<p><strong>BUILD:</strong> Deployment plan with rollback triggers</p>
<p><strong>EXECUTE:</strong> Deploy index to production</p>
<p><strong>VERIFY:</strong> ISC 3 completed (p95 latency 420ms), ISC 4 pending</p>
<p><strong>LEARN:</strong> Immediate latency improvement observed</p>
<p><strong>Iteration 4:</strong></p>
<p><strong>OBSERVE:</strong> 1 hour elapsed, monitoring data collected</p>
<p><strong>THINK:</strong> No timeouts observed, latency stable</p>
<p><strong>PLAN:</strong> Final verification</p>
<p><strong>BUILD:</strong> Generate monitoring report</p>
<p><strong>EXECUTE:</strong> Run verification queries</p>
<p><strong>VERIFY:</strong> ISC 4 completed (0 timeouts in 1 hour, 2,847 successful requests)</p>
<p><strong>LEARN:</strong> Index resolved the issue, document for future reference</p>
<p><strong>Result:</strong> Task complete in 4 iterations. All ISC criteria met. Time elapsed: approximately 2 hours.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="case-study-2-architecture-thorough---28-iterations">Case Study 2: Architecture (THOROUGH - 28 iterations)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#case-study-2-architecture-thorough---28-iterations" class="hash-link" aria-label="Direct link to Case Study 2: Architecture (THOROUGH - 28 iterations)" title="Direct link to Case Study 2: Architecture (THOROUGH - 28 iterations)">​</a></h2>
<p>Now let's scale up: designing a new microservice for real-time event processing.</p>
<p><strong>Iteration 1-5: OBSERVE &amp; THINK</strong></p>
<p>Early iterations focus on understanding requirements:</p>
<ul>
<li>Event volume: 50k events/second peak</li>
<li>Latency requirement: p99 under 100ms</li>
<li>Availability: 99.99% uptime</li>
<li>Data retention: 30 days</li>
<li>Integration: existing Kafka cluster, PostgreSQL, Redis</li>
</ul>
<p>Analysis surfaces constraints:</p>
<ul>
<li>Existing services use REST, need to maintain compatibility</li>
<li>Compliance requires all events logged</li>
<li>Team familiar with Node.js, new tech creates learning overhead</li>
</ul>
<p><strong>Iteration 6-10: PLAN &amp; BUILD</strong></p>
<p>Define architecture:</p>
<ul>
<li>Event consumer (Kafka → processing pipeline)</li>
<li>Processing engine (event validation, enrichment, routing)</li>
<li>State store (Redis for hot data, PostgreSQL for cold)</li>
<li>REST API (compatibility with existing services)</li>
<li>Monitoring (Prometheus, Grafana, distributed tracing)</li>
</ul>
<p>ISC defined:</p>
<ol>
<li>Handles 50k events/sec in load test</li>
<li>p99 latency under 100ms</li>
<li>99.99% uptime over 7-day test</li>
<li>All events persisted to PostgreSQL</li>
<li>Zero data loss during failover</li>
<li>REST API backward compatible</li>
<li>Full observability (metrics, logs, traces)</li>
</ol>
<p>BUILD artifacts:</p>
<ul>
<li>Architecture diagrams</li>
<li>API specifications (OpenAPI)</li>
<li>Data models</li>
<li>Infrastructure as Code (Terraform)</li>
<li>Deployment pipeline (CI/CD)</li>
</ul>
<p><strong>Iteration 11-20: EXECUTE &amp; VERIFY (incremental)</strong></p>
<p>Implement components incrementally:</p>
<ul>
<li>Iteration 11-13: Kafka consumer with basic processing</li>
<li>Iteration 14-16: State management (Redis + PostgreSQL)</li>
<li>Iteration 17-18: REST API layer</li>
<li>Iteration 19-20: Monitoring and alerting</li>
</ul>
<p>Each iteration verifies subset of ISC:</p>
<ul>
<li>After Iteration 13: ISC 4 verified (events persisted)</li>
<li>After Iteration 16: ISC 2 partially verified (p99 at 120ms, needs optimization)</li>
<li>After Iteration 18: ISC 6 verified (REST API compatible)</li>
<li>After Iteration 20: ISC 7 verified (observability complete)</li>
</ul>
<p><strong>Iteration 21-25: Optimization</strong></p>
<p>VERIFY reveals performance gaps:</p>
<ul>
<li>ISC 1: Only handles 35k events/sec (need 50k)</li>
<li>ISC 2: p99 latency 120ms (need under 100ms)</li>
</ul>
<p>THINK identifies bottlenecks:</p>
<ul>
<li>Database writes blocking event loop</li>
<li>Serialization overhead in Kafka consumer</li>
</ul>
<p>PLAN optimizations:</p>
<ul>
<li>Batch database writes</li>
<li>Use binary serialization (Protocol Buffers)</li>
<li>Add consumer parallelism</li>
</ul>
<p>EXECUTE changes, VERIFY improvements:</p>
<ul>
<li>After Iteration 23: 48k events/sec, p99 95ms</li>
<li>After Iteration 25: 52k events/sec, p99 88ms</li>
<li>ISC 1 and 2 now met</li>
</ul>
<p><strong>Iteration 26-28: Final verification</strong></p>
<p>Run extended tests:</p>
<ul>
<li>7-day load test at production volume</li>
<li>Chaos engineering (simulate node failures)</li>
<li>Security audit</li>
</ul>
<p>VERIFY remaining ISC:</p>
<ul>
<li>ISC 3: 99.993% uptime achieved (exceeds 99.99% target)</li>
<li>ISC 5: Zero data loss during 10 simulated failovers</li>
</ul>
<p>All ISC criteria met after 28 iterations. Time elapsed: 3 weeks.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="case-study-3-company-determined---200-iterations">Case Study 3: Company (DETERMINED - 200+ iterations)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#case-study-3-company-determined---200-iterations" class="hash-link" aria-label="Direct link to Case Study 3: Company (DETERMINED - 200+ iterations)" title="Direct link to Case Study 3: Company (DETERMINED - 200+ iterations)">​</a></h2>
<p>The most ambitious scale: building a company from idea to launch. This is where the Universal Algorithm truly proves its universality.</p>
<p><strong>Iterations 1-50: Problem Space (Months 1-2)</strong></p>
<p>Early iterations operate at strategic level:</p>
<p><strong>OBSERVE:</strong> Market research, customer interviews, competitive analysis</p>
<ul>
<li>Healthcare providers spend $2B annually on scheduling software</li>
<li>40% report dissatisfaction with existing solutions</li>
<li>Key pain points: complex scheduling rules, poor mobile experience, limited integrations</li>
</ul>
<p><strong>THINK:</strong> Identify market opportunity and differentiation</p>
<ul>
<li>Existing solutions built 10+ years ago, pre-mobile era</li>
<li>Modern tech stack enables better UX and performance</li>
<li>AI-powered scheduling optimization creates competitive moat</li>
</ul>
<p><strong>PLAN:</strong> Define MVP and go-to-market strategy</p>
<ul>
<li>ISC for company (high-level):<!-- -->
<ol>
<li>Product launched with 5 paying customers</li>
<li>$50k MRR achieved</li>
<li>Monthly churn under 10%</li>
<li>Net Promoter Score above 50</li>
<li>Product-market fit validated (qualitative + quantitative)</li>
</ol>
</li>
</ul>
<p><strong>BUILD:</strong> Business plan, financial model, pitch deck</p>
<p><strong>EXECUTE:</strong> Fundraise, incorporate, hire founding team</p>
<p><strong>VERIFY:</strong> $2M seed round raised, 3 engineers hired, legal entity formed</p>
<p><strong>LEARN:</strong> Investor feedback surfaced concerns about sales strategy—needs refinement</p>
<p><strong>Iterations 51-100: Product Development (Months 3-5)</strong></p>
<p>Now we recurse into product-level planning. Each major feature becomes its own THOROUGH-level task with its own ISC and Ralph Loop.</p>
<p>The company-level Universal Algorithm spawns child algorithms:</p>
<ul>
<li>Feature 1: Core scheduling engine (THOROUGH, 35 iterations)</li>
<li>Feature 2: Mobile application (THOROUGH, 42 iterations)</li>
<li>Feature 3: Integration platform (STANDARD, 18 iterations)</li>
</ul>
<p>Each feature's ISC rolls up to company ISC:</p>
<ul>
<li>Feature 1 completion → enables ISC 1 (product launch)</li>
<li>Feature 2 completion → improves ISC 4 (NPS via mobile UX)</li>
<li>Feature 3 completion → enables ISC 2 (MRR via integration upsells)</li>
</ul>
<p><strong>Iterations 101-150: Go-to-Market (Months 6-8)</strong></p>
<p><strong>OBSERVE:</strong> Beta user feedback, usage analytics, support tickets</p>
<p><strong>THINK:</strong> Initial users love mobile app, frustrated by integration limitations</p>
<p><strong>PLAN:</strong> Prioritize integration expansion, defer advanced scheduling features</p>
<p><strong>BUILD:</strong> 5 new integrations (EHR systems, payment processors)</p>
<p><strong>EXECUTE:</strong> Sales outreach, onboarding new customers</p>
<p><strong>VERIFY:</strong></p>
<ul>
<li>ISC 1: Launched with 8 paying customers (exceeded target of 5)</li>
<li>ISC 2: $28k MRR (need $50k)</li>
<li>ISC 3: 7% monthly churn (under 10% target)</li>
<li>ISC 4: NPS 62 (exceeded target of 50)</li>
<li>ISC 5: Product-market fit unclear—need more data</li>
</ul>
<p><strong>LEARN:</strong> Revenue below target but user satisfaction high—focus on customer acquisition, not product changes</p>
<p><strong>Iterations 151-200: Scale (Months 9-12)</strong></p>
<p><strong>OBSERVE:</strong> Sales funnel metrics, CAC, LTV, expansion revenue</p>
<p><strong>THINK:</strong> Current customers expanding usage, referrals strong—product works, need volume</p>
<p><strong>PLAN:</strong> Invest in marketing, optimize sales process, build referral program</p>
<p><strong>BUILD:</strong> Marketing campaigns, sales playbooks, referral incentives</p>
<p><strong>EXECUTE:</strong> Launch campaigns, hire sales reps, implement referral system</p>
<p><strong>VERIFY:</strong></p>
<ul>
<li>ISC 2: $54k MRR (exceeded $50k target)</li>
<li>ISC 5: Product-market fit validated (80% would be "very disappointed" without product)</li>
</ul>
<p><strong>Result:</strong> All company ISC criteria met after 200+ iterations spanning 12 months. Company successfully launched, product-market fit achieved, growth trajectory established.</p>
<p>The same algorithm that fixed a database index in 4 iterations built an entire company in 200+ iterations. The only difference: scope and persistence.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="memory-system-context-evolution-over-time">Memory System: Context Evolution Over Time<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#memory-system-context-evolution-over-time" class="hash-link" aria-label="Direct link to Memory System: Context Evolution Over Time" title="Direct link to Memory System: Context Evolution Over Time">​</a></h2>
<p>As tasks scale from QUICK to DETERMINED, context accumulates. The memory system manages this through a three-tier temperature model:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hot-memory-active-context">Hot Memory (Active Context)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#hot-memory-active-context" class="hash-link" aria-label="Direct link to Hot Memory (Active Context)" title="Direct link to Hot Memory (Active Context)">​</a></h3>
<ul>
<li>Current iteration state</li>
<li>Recent decisions and their rationale</li>
<li>Active ISC criteria and verification results</li>
<li>Storage: Redis (fast access, 1-hour TTL)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="warm-memory-session-context">Warm Memory (Session Context)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#warm-memory-session-context" class="hash-link" aria-label="Direct link to Warm Memory (Session Context)" title="Direct link to Warm Memory (Session Context)">​</a></h3>
<ul>
<li>Last 10 iterations of learnings</li>
<li>Task history and decision log</li>
<li>Related task connections</li>
<li>Storage: PostgreSQL (persistent, indexed)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cold-memory-long-term-knowledge">Cold Memory (Long-term Knowledge)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#cold-memory-long-term-knowledge" class="hash-link" aria-label="Direct link to Cold Memory (Long-term Knowledge)" title="Direct link to Cold Memory (Long-term Knowledge)">​</a></h3>
<ul>
<li>Completed task archives</li>
<li>Pattern libraries and reusable components</li>
<li>Strategic decisions and their outcomes</li>
<li>Storage: Vector database (semantic search enabled)</li>
</ul>
<p>This three-tier system ensures:</p>
<ul>
<li><strong>Fast access</strong> to immediately relevant context (hot)</li>
<li><strong>Learning continuity</strong> within a task session (warm)</li>
<li><strong>Pattern reuse</strong> across similar tasks (cold)</li>
</ul>
<p>Memory temperature automatically adjusts based on usage patterns. Frequently accessed warm memories get promoted to hot. Unused hot memories expire to warm. Cold memories are retrieved only via semantic similarity.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hook-system-event-driven-execution">Hook System: Event-Driven Execution<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#hook-system-event-driven-execution" class="hash-link" aria-label="Direct link to Hook System: Event-Driven Execution" title="Direct link to Hook System: Event-Driven Execution">​</a></h2>
<p>The Universal Algorithm integrates with a hook system for event-driven middleware—enabling custom logic at every phase.</p>
<p>Hooks can be registered for:</p>
<ul>
<li><strong>Pre-phase hooks:</strong> Run before each phase executes (e.g., load domain knowledge before THINK)</li>
<li><strong>Post-phase hooks:</strong> Run after each phase completes (e.g., update dashboard after OBSERVE)</li>
<li><strong>Iteration hooks:</strong> Run before/after full iterations (e.g., checkpoint state)</li>
<li><strong>Lifecycle hooks:</strong> Run at task start/completion (e.g., generate reports)</li>
</ul>
<p>This enables powerful customizations without modifying core algorithm:</p>
<ul>
<li><strong>Compliance:</strong> Add approval gates before EXECUTE for production changes</li>
<li><strong>Observability:</strong> Inject logging at every phase transition</li>
<li><strong>Cost control:</strong> Check budget before expensive THINK operations</li>
<li><strong>Integration:</strong> Notify external systems of progress</li>
<li><strong>Domain logic:</strong> Load industry-specific knowledge before THINK</li>
</ul>
<p>Hooks compose. You can stack multiple hooks per phase, each adding a layer of capability.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-guide">Implementation Guide<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#implementation-guide" class="hash-link" aria-label="Direct link to Implementation Guide" title="Direct link to Implementation Guide">​</a></h2>
<p>Ready to implement this framework? Here's the practical path:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="level-1-manual-human-driven">Level 1: Manual (Human-Driven)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#level-1-manual-human-driven" class="hash-link" aria-label="Direct link to Level 1: Manual (Human-Driven)" title="Direct link to Level 1: Manual (Human-Driven)">​</a></h3>
<p>Start by using the algorithm as a mental model. When facing any task:</p>
<ol>
<li><strong>OBSERVE:</strong> Write down current state explicitly</li>
<li><strong>THINK:</strong> Document your analysis and root causes</li>
<li><strong>PLAN:</strong> Define ISC criteria before starting work</li>
<li><strong>BUILD:</strong> Create artifacts intentionally</li>
<li><strong>EXECUTE:</strong> Take action deliberately</li>
<li><strong>VERIFY:</strong> Check progress against ISC</li>
<li><strong>LEARN:</strong> Document discoveries</li>
</ol>
<p>This alone improves task clarity and reduces false completion.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="level-2-semi-automated-tool-assisted">Level 2: Semi-Automated (Tool-Assisted)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#level-2-semi-automated-tool-assisted" class="hash-link" aria-label="Direct link to Level 2: Semi-Automated (Tool-Assisted)" title="Direct link to Level 2: Semi-Automated (Tool-Assisted)">​</a></h3>
<p>Introduce tooling to track ISC and iterations. Build a simple CLI or use task management software to:</p>
<ul>
<li>Define tasks with explicit ISC criteria</li>
<li>Track iteration count and progress</li>
<li>Log learnings from each iteration</li>
<li>Visualize completion percentage</li>
</ul>
<p>This gives you mechanical progress tracking and prevents premature completion.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="level-3-fully-automated-agent-driven">Level 3: Fully Automated (Agent-Driven)<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#level-3-fully-automated-agent-driven" class="hash-link" aria-label="Direct link to Level 3: Fully Automated (Agent-Driven)" title="Direct link to Level 3: Fully Automated (Agent-Driven)">​</a></h3>
<p>Build or integrate with an agent system that executes the algorithm autonomously. The agent handles routine execution while you focus on ISC definition and verification.</p>
<p>At this level, you're orchestrating AI agents that follow the Universal Algorithm, freeing you to work at higher levels of abstraction.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-15-pai-principles">The 15 PAI Principles<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#the-15-pai-principles" class="hash-link" aria-label="Direct link to The 15 PAI Principles" title="Direct link to The 15 PAI Principles">​</a></h2>
<p>The Universal Algorithm is one component of PAI v2.1. The full system is guided by 15 principles that ensure consistency and quality:</p>
<ol>
<li><strong>Verifiability:</strong> All progress must be measurable via ISC</li>
<li><strong>Composability:</strong> Tasks decompose into subtasks using same algorithm</li>
<li><strong>Persistence:</strong> Context survives interruptions (Ralph Loop)</li>
<li><strong>Efficiency:</strong> Match resource level to task complexity</li>
<li><strong>Clarity:</strong> State must be explicit and observable</li>
<li><strong>Adaptability:</strong> Learn from each iteration</li>
<li><strong>Completeness:</strong> Continue until ISC satisfied, not until "good enough"</li>
<li><strong>Hierarchy:</strong> Support tasks at all scales (TRIVIAL → DETERMINED)</li>
<li><strong>Traceability:</strong> Maintain decision log for all phases</li>
<li><strong>Separation:</strong> Distinguish BUILD from EXECUTE</li>
<li><strong>Hooks:</strong> Enable extension without core modification</li>
<li><strong>Memory:</strong> Manage context temperature (hot/warm/cold)</li>
<li><strong>Models:</strong> Select appropriate AI model per phase/effort</li>
<li><strong>Collaboration:</strong> Enable multi-agent coordination</li>
<li><strong>Human-in-loop:</strong> Escalate blockers requiring judgment</li>
</ol>
<p>These aren't aspirational values—they're implemented constraints that the system enforces.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-makes-this-universal">What Makes This Universal<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#what-makes-this-universal" class="hash-link" aria-label="Direct link to What Makes This Universal" title="Direct link to What Makes This Universal">​</a></h2>
<p>Three properties make this algorithm truly universal:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-scale-invariance">1. Scale Invariance<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#1-scale-invariance" class="hash-link" aria-label="Direct link to 1. Scale Invariance" title="Direct link to 1. Scale Invariance">​</a></h3>
<p>The algorithm works identically whether the task takes 30 seconds or 3 years. Only the ISC scope changes. Fixing a typo and building a company both follow:</p>
<p>OBSERVE → THINK → PLAN → BUILD → EXECUTE → VERIFY → LEARN</p>
<p>The number of iterations scales, but the structure remains constant.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-domain-independence">2. Domain Independence<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#2-domain-independence" class="hash-link" aria-label="Direct link to 2. Domain Independence" title="Direct link to 2. Domain Independence">​</a></h3>
<p>Nothing in the algorithm is specific to software. It applies equally to:</p>
<ul>
<li>Writing code (OBSERVE: read codebase, THINK: identify architecture, PLAN: design solution...)</li>
<li>Writing essays (OBSERVE: research topic, THINK: organize arguments, PLAN: outline structure...)</li>
<li>Cooking recipes (OBSERVE: check ingredients, THINK: understand technique, PLAN: sequence steps...)</li>
<li>Running companies (OBSERVE: analyze market, THINK: identify opportunity, PLAN: strategy...)</li>
</ul>
<p>The seven phases are fundamental to problem-solving itself.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-verifiable-termination">3. Verifiable Termination<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#3-verifiable-termination" class="hash-link" aria-label="Direct link to 3. Verifiable Termination" title="Direct link to 3. Verifiable Termination">​</a></h3>
<p>Unlike heuristic approaches ("keep working until it feels done"), ISC provides objective completion criteria. Tasks terminate when all criteria are met—not before, not after.</p>
<p>This eliminates both premature stopping (shipped before ISC met) and infinite iteration (working past completion).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="common-pitfalls-and-solutions">Common Pitfalls and Solutions<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#common-pitfalls-and-solutions" class="hash-link" aria-label="Direct link to Common Pitfalls and Solutions" title="Direct link to Common Pitfalls and Solutions">​</a></h2>
<p>After implementing this framework across 100+ tasks, patterns of failure emerged:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-1-vague-isc-criteria">Pitfall 1: Vague ISC Criteria<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#pitfall-1-vague-isc-criteria" class="hash-link" aria-label="Direct link to Pitfall 1: Vague ISC Criteria" title="Direct link to Pitfall 1: Vague ISC Criteria">​</a></h3>
<p><strong>Problem:</strong> "Make the API faster" is not verifiable.</p>
<p><strong>Solution:</strong> Quantify everything. "p95 API latency under 500ms measured over 1000 requests" is verifiable.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-2-skipping-observe">Pitfall 2: Skipping OBSERVE<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#pitfall-2-skipping-observe" class="hash-link" aria-label="Direct link to Pitfall 2: Skipping OBSERVE" title="Direct link to Pitfall 2: Skipping OBSERVE">​</a></h3>
<p><strong>Problem:</strong> Jumping straight to solution without understanding current state.</p>
<p><strong>Solution:</strong> Force explicit OBSERVE artifacts before allowing THINK. No measurement = no iteration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-3-buildexecute-confusion">Pitfall 3: BUILD/EXECUTE Confusion<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#pitfall-3-buildexecute-confusion" class="hash-link" aria-label="Direct link to Pitfall 3: BUILD/EXECUTE Confusion" title="Direct link to Pitfall 3: BUILD/EXECUTE Confusion">​</a></h3>
<p><strong>Problem:</strong> Making production changes (EXECUTE) while still developing solution (BUILD).</p>
<p><strong>Solution:</strong> Require explicit transition gate. BUILD produces artifacts, EXECUTE deploys them.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-4-insufficient-effort-classification">Pitfall 4: Insufficient Effort Classification<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#pitfall-4-insufficient-effort-classification" class="hash-link" aria-label="Direct link to Pitfall 4: Insufficient Effort Classification" title="Direct link to Pitfall 4: Insufficient Effort Classification">​</a></h3>
<p><strong>Problem:</strong> Using QUICK for complex architecture, running out of iterations before completion.</p>
<p><strong>Solution:</strong> Conservative classification. When uncertain, choose higher effort level.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfall-5-ignoring-learn">Pitfall 5: Ignoring LEARN<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#pitfall-5-ignoring-learn" class="hash-link" aria-label="Direct link to Pitfall 5: Ignoring LEARN" title="Direct link to Pitfall 5: Ignoring LEARN">​</a></h3>
<p><strong>Problem:</strong> Iterations repeat mistakes because learnings not captured.</p>
<p><strong>Solution:</strong> Make LEARN artifacts mandatory, reviewed before next OBSERVE.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-directions">Future Directions<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#future-directions" class="hash-link" aria-label="Direct link to Future Directions" title="Direct link to Future Directions">​</a></h2>
<p>Where does this framework evolve next?</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-agent-orchestration">Multi-Agent Orchestration<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#multi-agent-orchestration" class="hash-link" aria-label="Direct link to Multi-Agent Orchestration" title="Direct link to Multi-Agent Orchestration">​</a></h3>
<p>Currently, one agent executes one task. The next frontier: coordinating multiple agents on DETERMINED tasks.</p>
<p>Imagine building a product:</p>
<ul>
<li>Agent A: Backend architecture (THOROUGH)</li>
<li>Agent B: Frontend development (THOROUGH)</li>
<li>Agent C: Infrastructure deployment (STANDARD)</li>
</ul>
<p>Each agent runs its own Universal Algorithm instance. Coordination happens via:</p>
<ul>
<li>Shared ISC (changes in one affect others)</li>
<li>Dependency tracking (Agent C blocked until Agent A completes)</li>
<li>Context sharing (Agent B learns from Agent A's API design)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reinforcement-learning-on-isc">Reinforcement Learning on ISC<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#reinforcement-learning-on-isc" class="hash-link" aria-label="Direct link to Reinforcement Learning on ISC" title="Direct link to Reinforcement Learning on ISC">​</a></h3>
<p>The ISC system generates training data: task description → plan → ISC → outcome. This enables learning:</p>
<ul>
<li>Which ISC criteria predict success?</li>
<li>What effort classification minimizes iterations?</li>
<li>Which model selection strategy optimizes cost/quality?</li>
</ul>
<p>Over time, the system learns to define better ISC from historical patterns.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cross-domain-pattern-transfer">Cross-Domain Pattern Transfer<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#cross-domain-pattern-transfer" class="hash-link" aria-label="Direct link to Cross-Domain Pattern Transfer" title="Direct link to Cross-Domain Pattern Transfer">​</a></h3>
<p>As cold memory accumulates completed tasks, patterns emerge:</p>
<ul>
<li>"Optimization tasks typically need 3-5 iterations"</li>
<li>"Database migrations require explicit rollback verification"</li>
<li>"API design benefits from prototyping in PLAN phase"</li>
</ul>
<p>These patterns can transfer across domains. A performance optimization pattern from backend code might apply to database query optimization.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://jonroosevelt.com/blog/universal-algorithm-ai-execution-framework#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>The Universal Algorithm isn't a productivity hack or a time management technique. It's a formalization of how effective problem-solving actually works, made explicit and verifiable.</p>
<p>Every task is a gap between current and ideal. Every gap closes through iteration. Every iteration follows the same seven phases. Progress is measured mechanically through ISC. Effort scales from TRIVIAL to DETERMINED. Models match task complexity. Memory preserves context. Hooks enable extension.</p>
<p>This framework has handled everything from fixing typos to designing distributed systems to building products. The algorithm didn't change. Only the scope and persistence changed.</p>
<p>That's what makes it universal.</p>
<hr>
<p>The complete PAI v2.1 specification includes:</p>
<ul>
<li>Detailed phase execution protocols</li>
<li>ISC template library</li>
<li>Model selection matrices</li>
<li>Hook system architecture</li>
<li>Memory management implementation</li>
<li>Multi-agent coordination patterns</li>
</ul>
<p>If you're building agent systems, managing complex projects, or just want better clarity on progress, the Universal Algorithm provides a concrete, verifiable framework.</p>
<p>What problems would you apply this to? What ISC criteria matter in your domain? I'd love to hear how others adapt this framework.</p>
<hr>
<p><em>Jon Roosevelt is an AI architect building production agent systems. He specializes in making AI infrastructure practical, measurable, and reliable—turning conceptual frameworks into working systems that ship products.</em></p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Architecture" term="Architecture"/>
        <category label="Algorithms" term="Algorithms"/>
        <category label="Productivity" term="Productivity"/>
        <category label="Systems Thinking" term="Systems Thinking"/>
        <category label="Automation" term="Automation"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The Three Levels of Why: Why Surface Motivation Fails and How to Find Your Primal Drive]]></title>
        <id>https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology</id>
        <link href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology"/>
        <updated>2026-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Every January, millions of people set ambitious goals. By February, 80% have abandoned them. The conventional wisdom blames willpower, discipline, or commitment. But the real problem runs deeper: most people are operating from the wrong level of motivation. They're building on foundations that collapse under the first real pressure.]]></summary>
        <content type="html"><![CDATA[<p>Every January, millions of people set ambitious goals. By February, 80% have abandoned them. The conventional wisdom blames willpower, discipline, or commitment. But the real problem runs deeper: most people are operating from the wrong level of motivation. They're building on foundations that collapse under the first real pressure.</p>
<p>Over the past decade working with entrepreneurs, clinicians, and operators, I've observed a pattern in who sustains effort through multi-year challenges and who burns out in months. The difference isn't talent, opportunity, or resources. It's the depth of their "why" — the psychological foundation driving their work.</p>
<p><img decoding="async" loading="lazy" alt="The Three Levels of Why" src="https://jonroosevelt.com/assets/images/hero-banner-333f8e41988d9c2443315b123f44c738.jpg" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-three-levels-of-motivation">The Three Levels of Motivation<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#the-three-levels-of-motivation" class="hash-link" aria-label="Direct link to The Three Levels of Motivation" title="Direct link to The Three Levels of Motivation">​</a></h2>
<p>Not all motivation is created equal. There are three distinct levels, each with different durability under stress:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="level-1-the-social-why-collapses-first">Level 1: The Social Why (Collapses First)<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#level-1-the-social-why-collapses-first" class="hash-link" aria-label="Direct link to Level 1: The Social Why (Collapses First)" title="Direct link to Level 1: The Social Why (Collapses First)">​</a></h3>
<p>This is the answer you give at networking events. "I'm building this to disrupt healthcare." "I want to make a difference." "I'm passionate about innovation." These aren't lies — they're just incomplete. They're the socially acceptable narrative you've constructed to explain your choices to others.</p>
<p><strong>Durability</strong>: 3-6 months under moderate stress. Collapses immediately when you face serious social rejection.</p>
<p><strong>Recognition pattern</strong>: If you need external validation to continue, you're operating from a social why. If bad press, investor rejection, or criticism from peers makes you question the entire endeavor, you're on this level.</p>
<p><strong>Real example</strong>: An entrepreneur I advised was building an urgent care telemedicine platform. His social why was "improving access to healthcare for underserved communities." Noble. True. But when competitors launched faster and TechCrunch wrote about them instead of him, he spiraled. He couldn't explain why he should keep going when others were already solving the problem. Six months later, he pivoted to crypto.</p>
<p>The social why works great when things are going well. It generates compelling pitch decks and inspiring LinkedIn posts. But it's built on external validation, and external validation is unstable fuel.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="level-2-the-personal-why-fragile-under-rejection">Level 2: The Personal Why (Fragile Under Rejection)<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#level-2-the-personal-why-fragile-under-rejection" class="hash-link" aria-label="Direct link to Level 2: The Personal Why (Fragile Under Rejection)" title="Direct link to Level 2: The Personal Why (Fragile Under Rejection)">​</a></h3>
<p>This is what you tell yourself. Your actual conscious reasons. "I watched my grandmother die in an emergency room waiting 6 hours for care. I'm fixing this so no one else goes through that." This is real. This is powerful. This is still not enough.</p>
<p><strong>Durability</strong>: 12-18 months under sustained pressure. Can survive some rejection but eventually fractures.</p>
<p><strong>Recognition pattern</strong>: If you need the work to succeed in order to feel like the why was valid, you're on this level. If failure would mean "it was all for nothing," you're here.</p>
<p><strong>Real example</strong>: A physician founder lost his father to a preventable medical error. His personal why was eliminating diagnostic mistakes through AI. But after 18 months of rejected funding rounds, failed pilot programs, and hospitals saying "we're not ready for this," he couldn't sustain it. The rejection felt like the universe saying his father's death didn't matter enough to change the system. He returned to clinical practice.</p>
<p>The personal why is substantially more durable than the social why. It can carry you through investor rejection, failed launches, and even some financial hardship. But when the world repeatedly tells you "no," the personal why asks: "Maybe I'm wrong. Maybe this isn't actually important enough."</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="level-3-the-primal-why-18-month-sustainability">Level 3: The Primal Why (18+ Month Sustainability)<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#level-3-the-primal-why-18-month-sustainability" class="hash-link" aria-label="Direct link to Level 3: The Primal Why (18+ Month Sustainability)" title="Direct link to Level 3: The Primal Why (18+ Month Sustainability)">​</a></h3>
<p>This is the motivation that wakes you up at 3 AM and won't let you sleep. It's not rational. It's often not something you chose. It's the psychological wound or void that drives you whether the project succeeds or fails. It's the motivation that exists <strong>independent of outcomes</strong>.</p>
<p><strong>Durability</strong>: Indefinite. Can sustain 18+ month rejection cycles, multiple failures, and complete external skepticism.</p>
<p><strong>Recognition pattern</strong>: If you would do this work even if it was guaranteed to fail — if the act of trying is meeting a psychological need independent of the result — you've found your primal why.</p>
<p>Steve Jobs captured this in a 1994 interview: "I'm one of those people that think that Thomas Edison did a lot more to improve the world than Karl Marx and Nikos Kazantzakis put together. I'm one of those people that thinks that creation is the highest form of human activity, and that's it."</p>
<p>Notice: he didn't say "if it succeeds." He said creation itself. The primal why doesn't require external validation because it's meeting an internal psychological imperative.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-research-childhood-powerlessness-and-entrepreneurial-drive">The Research: Childhood Powerlessness and Entrepreneurial Drive<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#the-research-childhood-powerlessness-and-entrepreneurial-drive" class="hash-link" aria-label="Direct link to The Research: Childhood Powerlessness and Entrepreneurial Drive" title="Direct link to The Research: Childhood Powerlessness and Entrepreneurial Drive">​</a></h2>
<p>A 2019 University of Pennsylvania study of 478 successful entrepreneurs found that <strong>78% reported experiencing significant childhood powerlessness</strong> — poverty, parental inconsistency, health crises, family instability, or early responsibility beyond their developmental capacity.</p>
<p>The researchers found these early experiences created what they termed "compensatory drive" — a psychological need to create control, stability, or proof of capability that persists regardless of actual achievement. These entrepreneurs built companies not primarily to create value or make money, but to answer an internal question formed in childhood: "Am I capable? Can I create safety? Can I prove I'm not powerless?"</p>
<p>This isn't trauma glorification. It's pattern recognition. The study found that entrepreneurs with compensatory drive were:</p>
<ul>
<li>3.2x more likely to persist through 18+ month rejection cycles</li>
<li>2.1x more likely to restart after total failure</li>
<li>4.7x more likely to report that "stopping feels harder than continuing"</li>
</ul>
<p>Why? Because external rejection doesn't invalidate the primal why. Investor rejection doesn't answer "Am I capable?" Failed launches don't answer "Can I create control?" The primal why sustains because it exists independently of outcomes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-18-month-test-deal-rejection-cycles">The 18-Month Test: Deal Rejection Cycles<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#the-18-month-test-deal-rejection-cycles" class="hash-link" aria-label="Direct link to The 18-Month Test: Deal Rejection Cycles" title="Direct link to The 18-Month Test: Deal Rejection Cycles">​</a></h2>
<p>In private equity and healthcare acquisitions, 18 months is the standard cycle for serious deals. You identify a target, build relationships, conduct due diligence, negotiate, secure financing, navigate regulatory approval, and close. At any point, the deal can collapse. And often does.</p>
<p>I've watched dozens of acquisition teams through these cycles. The pattern is consistent:</p>
<p><strong>Months 1-3</strong>: Everyone's motivated. Social why and personal why are both firing. The deal makes sense strategically. The team is excited. The narrative is compelling.</p>
<p><strong>Months 4-8</strong>: First major rejection. Financing falls through, or the target's board says no, or regulatory issues emerge. Social why starts fracturing. "Maybe this isn't the right deal." Team members who were in it for the resume line or the learning experience start exploring other opportunities.</p>
<p><strong>Months 9-14</strong>: Multiple rejections. The personal why is under assault. "Is this actually worth it? Am I wasting time? Should I be doing something else?" The people who stay are now operating primarily from primal why, whether they've named it or not.</p>
<p><strong>Months 15-18+</strong>: Only primal why remains. The people still at the table aren't there because the deal makes sense strategically. They're there because walking away would violate something deeper. The need to finish. The need to prove capability. The need to create the outcome that compensates for the childhood wound.</p>
<p>This isn't always healthy. But it's powerful. And it's the difference between teams that close complex deals and teams that don't.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-discover-your-primal-why">How to Discover Your Primal Why<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#how-to-discover-your-primal-why" class="hash-link" aria-label="Direct link to How to Discover Your Primal Why" title="Direct link to How to Discover Your Primal Why">​</a></h2>
<p>Most people have never done this introspection. They operate from social why or personal why and wonder why motivation fluctuates. Here's the framework I use:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-5-layers-down-method">The 5 Layers Down Method<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#the-5-layers-down-method" class="hash-link" aria-label="Direct link to The 5 Layers Down Method" title="Direct link to The 5 Layers Down Method">​</a></h3>
<p>Ask yourself why you're doing the work. Then ask "why does that matter?" five times.</p>
<p><strong>Example</strong>:</p>
<ol>
<li>
<p>"Why am I building this urgent care scheduling system?"</p>
<ul>
<li><em>"To reduce patient wait times."</em></li>
</ul>
</li>
<li>
<p>"Why does reducing wait times matter to you?"</p>
<ul>
<li><em>"Because I've seen patients leave before being seen and end up in the ER."</em></li>
</ul>
</li>
<li>
<p>"Why does that bother you specifically?"</p>
<ul>
<li><em>"Because it's preventable suffering."</em></li>
</ul>
</li>
<li>
<p>"Why do you need to prevent that suffering?"</p>
<ul>
<li><em>"Because someone should. Because it's fixable."</em></li>
</ul>
</li>
<li>
<p>"Why do you need to be the one to fix it?"</p>
<ul>
<li><em>"Because if I don't, I'm complicit. Because I can't look at a solvable problem and do nothing."</em></li>
</ul>
</li>
</ol>
<p>That last answer — that's closer to primal. It's about self-concept, not outcomes. "I can't be the person who sees this and does nothing" is primal. "Patients deserve better care" is personal.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-3-am-question">The 3 AM Question<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#the-3-am-question" class="hash-link" aria-label="Direct link to The 3 AM Question" title="Direct link to The 3 AM Question">​</a></h3>
<p>If you woke up at 3 AM and knew with certainty that your project would fail — zero chance of success — but you could keep working on it anyway, would you?</p>
<p>If yes: why? That reason is primal.</p>
<p>If no: you're operating from personal or social why. Which is fine for projects that will succeed within 12 months. It's insufficient for longer campaigns.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-childhood-archaeology">The Childhood Archaeology<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#the-childhood-archaeology" class="hash-link" aria-label="Direct link to The Childhood Archaeology" title="Direct link to The Childhood Archaeology">​</a></h3>
<p>This is uncomfortable, but essential: What situation in your childhood made you feel powerless, invisible, or inadequate?</p>
<p>Then ask: How does your current work address that wound?</p>
<ul>
<li>The founder building telemedicine who grew up rural with no access to doctors.</li>
<li>The operator obsessed with efficiency who grew up in chaos and couldn't control anything.</li>
<li>The entrepreneur proving business acumen who was told they'd never amount to anything.</li>
</ul>
<p>The primal why is often the adult capable response to the childhood powerless situation. You're building what you needed then. You're proving what you couldn't prove then. You're creating the control you didn't have then.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="my-primal-why-the-integration-of-two-events">My Primal Why: The Integration of Two Events<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#my-primal-why-the-integration-of-two-events" class="hash-link" aria-label="Direct link to My Primal Why: The Integration of Two Events" title="Direct link to My Primal Why: The Integration of Two Events">​</a></h2>
<p>I can give you the social why for my work in healthcare AI and urgent care operations: "I want to improve patient access and reduce clinician burnout."</p>
<p>I can give you the personal why: "I've seen broken systems waste human potential and I know technology can fix this."</p>
<p>But my primal why comes from two specific events that I don't talk about publicly much:</p>
<p><strong>First</strong>: In 2019, I was hiking Mount Emei in China and got severe altitude sickness. I was hours from medical care, unable to breathe properly, genuinely uncertain if I'd survive the descent. The psychological experience wasn't fear of death — it was rage at the arbitrariness. "I might die because I'm in the wrong place at the wrong time and there's no system to help."</p>
<p><strong>Second</strong>: My wife and I lost a pregnancy in 2020. The medical system was clinically competent but operationally indifferent. Appointments were hard to schedule. Results took days. No one communicated proactively. The loss was hard. The bureaucratic indifference made it worse.</p>
<p>Those two experiences — the personal encounter with system absence and the personal encounter with system indifference — are why I work on urgent care access and healthcare operations. Not because I think it's a good market (though it is). Not because I'm passionate about healthcare (though I am). Because I cannot be the person who experienced those things and didn't try to build systems that would have helped.</p>
<p>That's primal. It persists regardless of outcomes. If every urgent care telemedicine company I build fails, I'll still be working on this in some form, because not working on it would violate my self-concept as someone who responds to experienced injustice with capability.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-integration-with-sacrifice-jordan-petersons-principle">The Integration With Sacrifice (Jordan Peterson's Principle)<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#the-integration-with-sacrifice-jordan-petersons-principle" class="hash-link" aria-label="Direct link to The Integration With Sacrifice (Jordan Peterson's Principle)" title="Direct link to The Integration With Sacrifice (Jordan Peterson's Principle)">​</a></h2>
<p>Jordan Peterson talks extensively about the relationship between sacrifice and meaning. His core insight: you value what you sacrifice for, not what you get easily.</p>
<p>The primal why is the psychological foundation that makes deep sacrifice possible. You can't sacrifice years of your life for a social why — it's too unstable. You can sacrifice some for a personal why, but it's fragile. The primal why makes sacrifice not only possible but psychologically necessary.</p>
<p>When you're operating from primal motivation, sacrifice doesn't feel like loss. It feels like integrity. Choosing the hard path isn't a cost — it's proof that you're the person you need to be.</p>
<p>This is why entrepreneurs with primal why often describe their hardest years as their most meaningful. Not because suffering is good, but because the suffering was in service of something that defined their identity. The sacrifice validated the why.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="when-primal-why-goes-wrong">When Primal Why Goes Wrong<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#when-primal-why-goes-wrong" class="hash-link" aria-label="Direct link to When Primal Why Goes Wrong" title="Direct link to When Primal Why Goes Wrong">​</a></h2>
<p>This framework is descriptive, not prescriptive. Having a primal why doesn't make you right. It makes you durable. And durability applied to the wrong goal can be destructive.</p>
<p><strong>The warning signs</strong>:</p>
<ol>
<li>
<p><strong>You can't stop even when the evidence is overwhelming that you should</strong>. Primal why makes it hard to quit. That's useful for 18-month rejection cycles. It's pathological when applied to fundamentally doomed pursuits.</p>
</li>
<li>
<p><strong>You're optimizing for psychological compensation, not actual outcomes</strong>. If you're building something primarily to prove a point to your childhood self, you may be solving the wrong problem.</p>
</li>
<li>
<p><strong>You're sacrificing relationships, health, or ethics</strong>. Primal why can sustain you through hardship. It doesn't justify destroying yourself or others.</p>
</li>
</ol>
<p>The primal why should be a foundation for sustainable high performance, not an excuse for self-destruction. If your primal motivation is driving you toward burnout, you need therapy, not more grit.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="practical-application">Practical Application<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#practical-application" class="hash-link" aria-label="Direct link to Practical Application" title="Direct link to Practical Application">​</a></h2>
<p>If you're building something that requires 18+ months of effort in the face of likely rejection:</p>
<ol>
<li>
<p><strong>Identify your primal why before you start</strong>. If you can't find it, the project is too ambitious for your current motivational foundation. Scale down or choose a different problem.</p>
</li>
<li>
<p><strong>Be honest about which level you're operating from</strong>. If you're at social or personal why, that's fine — just don't commit to multi-year campaigns. You'll burn out.</p>
</li>
<li>
<p><strong>Build a team with compatible primal whys</strong>. You don't all need the same wound, but you need wounds that drive you toward the same solution. Mismatched primal motivations create team dysfunction under stress.</p>
</li>
<li>
<p><strong>Use the primal why to evaluate strategic decisions</strong>. When facing a hard choice, ask: "Which option serves the primal why?" If neither does, you're off course.</p>
</li>
<li>
<p><strong>Revisit your primal why when motivation wanes</strong>. The social why fades. The personal why fractures. The primal why is durable, but it needs periodic reconnection. Remind yourself why you're actually here.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-takeaway">The Takeaway<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#the-takeaway" class="hash-link" aria-label="Direct link to The Takeaway" title="Direct link to The Takeaway">​</a></h2>
<p>Surface motivation is sufficient for surface goals. If you want to learn a new skill, read more books, or ship a side project, social or personal why will get you there.</p>
<p>But if you're attempting something genuinely difficult — building a company through 18+ month rejection cycles, pursuing a career pivot that requires years of preparation, or solving a problem that most people think is impossible — you need foundation that goes deeper.</p>
<p>You need the motivation that exists at 3 AM when no one is watching and nothing is working. You need the psychological imperative that persists independent of outcomes. You need the transformed childhood wound that drives you whether you succeed or fail.</p>
<p>That's the primal why. And once you find it, everything else is logistics.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-reading">Further Reading<a href="https://jonroosevelt.com/blog/three-levels-of-why-primal-motivation-psychology#further-reading" class="hash-link" aria-label="Direct link to Further Reading" title="Direct link to Further Reading">​</a></h2>
<ul>
<li><strong>Man's Search for Meaning</strong> by Viktor Frankl — The foundational text on meaning-driven motivation</li>
<li><strong>The Denial of Death</strong> by Ernest Becker — On how childhood experiences shape adult drives</li>
<li><strong>12 Rules for Life</strong> by Jordan Peterson — Particularly Rule 7: "Pursue what is meaningful (not what is expedient)"</li>
<li><strong>Shoe Dog</strong> by Phil Knight — Case study of primal why sustaining through rejection</li>
<li><strong>Originals</strong> by Adam Grant — Research on what drives sustained contrarian effort</li>
</ul>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Psychology" term="Psychology"/>
        <category label="Motivation" term="Motivation"/>
        <category label="Entrepreneurship" term="Entrepreneurship"/>
        <category label="Personal Development" term="Personal Development"/>
        <category label="Resilience" term="Resilience"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building Tools to Fix Real Problems: A Patient Insurance Education App]]></title>
        <id>https://jonroosevelt.com/blog/patient-insurance-education-app</id>
        <link href="https://jonroosevelt.com/blog/patient-insurance-education-app"/>
        <updated>2025-11-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I got a 4-star Google review last week that bothered me more than it should have.]]></summary>
        <content type="html"><![CDATA[<p>I got a 4-star Google review last week that bothered me more than it should have.</p>
<p>A long-time patient wrote that he'd never paid a "copay" before at our urgent care clinics, but this time we charged him $37.50 out of nowhere. He was confused and felt blindsided.</p>
<!-- -->
<p>I called our office manager. She pulled up his account and explained: his insurance has 25% coinsurance (not a copay). The visit cost $150, insurance paid $112.50, he owed $37.50. His previous visits had zero patient responsibility for different reasons—claims were denied then reprocessed, or his deductible was already met.</p>
<p>The patient wasn't wrong to be confused. Honestly? <strong>I didn't fully understand the difference between copay and coinsurance until I had to learn it running these clinics.</strong> And if I'm confused, patients definitely are.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-real-problem">The Real Problem<a href="https://jonroosevelt.com/blog/patient-insurance-education-app#the-real-problem" class="hash-link" aria-label="Direct link to The Real Problem" title="Direct link to The Real Problem">​</a></h2>
<p>My office manager told me something that stuck: "Patients don't understand the difference between copay and coinsurance. I try my best to explain it, but most don't get it."</p>
<p>This isn't just about one review. It's an operational issue:</p>
<ul>
<li>Staff time spent explaining benefits repeatedly</li>
<li>Patients surprised by bills they weren't expecting</li>
<li>Negative reviews that hurt our reputation</li>
<li>Payment collection issues when patients don't understand why they owe money</li>
</ul>
<p>I needed a way to <strong>show</strong> patients their benefits, not just tell them. Because explaining it with words clearly wasn't working—not for patients, and not for me when I first started.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-solution">The Solution<a href="https://jonroosevelt.com/blog/patient-insurance-education-app#the-solution" class="hash-link" aria-label="Direct link to The Solution" title="Direct link to The Solution">​</a></h2>
<p>I built a simple visual tool: <strong><a href="https://eob.arcs.health/" target="_blank" rel="noopener noreferrer">eob.arcs.health</a></strong></p>
<p>It's designed for front desk staff to use at check-in. They walk the patient through 4 quick steps while the patient watches a visual breakdown update in real-time:</p>
<ol>
<li><strong>Visit cost</strong> - "Your urgent care visit costs $150"</li>
<li><strong>Deductible check</strong> - "Do you have a deductible? How much is remaining?"</li>
<li><strong>Insurance coverage</strong> - "Your insurance pays 75%, you pay 25%"</li>
<li><strong>Final breakdown</strong> - Big, clear visual showing exactly what they'll pay today</li>
</ol>
<p>The key is the <strong>animated visual bar</strong> that shows the money flow:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">├──────────────────────────────┤</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│███████████████░░░░░│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ Insurance $112.50 | You $37.50 │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└──────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Patients can literally see their $150 visit split between what insurance covers and what they owe. No insurance jargon, just dollars and percentages they can understand.</p>
<p>This is the tool I wish someone had shown me when I was trying to understand my own insurance.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-matters">Why This Matters<a href="https://jonroosevelt.com/blog/patient-insurance-education-app#why-this-matters" class="hash-link" aria-label="Direct link to Why This Matters" title="Direct link to Why This Matters">​</a></h2>
<p>Sometimes you need to build tools that don't exist yet.</p>
<p>The commercial solutions for patient cost estimation are either:</p>
<ul>
<li>Too expensive for small operators</li>
<li>Too complex (requiring full EHR integration)</li>
<li>Focused on pre-visit estimates, not point-of-service education</li>
</ul>
<p>I needed something simple that front desk staff could pull up on an iPad in 30 seconds and walk a patient through before they leave. So I built it using Lovable in about two hours.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What's Next<a href="https://jonroosevelt.com/blog/patient-insurance-education-app#whats-next" class="hash-link" aria-label="Direct link to What's Next" title="Direct link to What's Next">​</a></h2>
<p>I sent the tool to my front desk team this morning and asked for honest feedback:</p>
<ul>
<li>Does it actually help or just add time?</li>
<li>What's confusing?</li>
<li>What's missing?</li>
</ul>
<p>If it works, great—we've solved a real problem. If it doesn't, I'll fix it or scrap it. The goal isn't to build perfect software; it's to solve the operational problem of patients not understanding their bills.</p>
<p>I also responded to that Google review with a link to the tool and an acknowledgment that we should have done better. Hopefully, he and other patients will find it useful.</p>
<hr>
<p><strong>For other urgent care operators:</strong> If you're dealing with the same patient confusion about benefits, feel free to use this tool. It's free and open. If you have ideas to make it better, let me know—I'm still iterating on it.</p>
<p><strong>Link:</strong> <a href="https://eob.arcs.health/" target="_blank" rel="noopener noreferrer">eob.arcs.health</a></p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Healthcare" term="Healthcare"/>
        <category label="Operations" term="Operations"/>
        <category label="Tools" term="Tools"/>
        <category label="Patient Experience" term="Patient Experience"/>
        <category label="Lovable" term="Lovable"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building an Enterprise RAG System with Local SLMs: My Journey with Phi-4 and LightRAG]]></title>
        <id>https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag</id>
        <link href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag"/>
        <updated>2025-10-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[After spending months helping enterprises build AI systems, I noticed a pattern: everyone wanted powerful RAG capabilities, but few were comfortable shipping their proprietary data to external APIs. The cost? Predictable. The compliance story? Simple. But the control and security? Gone.]]></summary>
        <content type="html"><![CDATA[<p>After spending months helping enterprises build AI systems, I noticed a pattern: everyone wanted powerful RAG capabilities, but few were comfortable shipping their proprietary data to external APIs. The cost? Predictable. The compliance story? Simple. But the control and security? Gone.</p>
<p>So I asked myself: could we build something that matches GraphRAG and Nano-GraphRAG performance using entirely local, self-hosted components?</p>
<p>The answer surprised me. Not only is it possible—it's practical, cost-effective, and production-ready. Here's what I learned building a complete Graph RAG system with Phi-4 and LightRAG.</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-local-slms--graph-rag-matter-now">Why Local SLMs + Graph RAG Matter Now<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#why-local-slms--graph-rag-matter-now" class="hash-link" aria-label="Direct link to Why Local SLMs + Graph RAG Matter Now" title="Direct link to Why Local SLMs + Graph RAG Matter Now">​</a></h2>
<p>Let me cut straight to what matters: cost, control, and compliance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-real-cost-story">The Real Cost Story<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#the-real-cost-story" class="hash-link" aria-label="Direct link to The Real Cost Story" title="Direct link to The Real Cost Story">​</a></h3>
<p>I ran the numbers for a typical enterprise knowledge base—about 50,000 documents, 1,000 queries per day. Here's what I found:</p>
<p><strong>OpenAI API approach:</strong></p>
<ul>
<li>GPT-4 for entity extraction: ~$1,500/month</li>
<li>GPT-4 for query responses: ~$800/month</li>
<li>Embedding API: ~$200/month</li>
<li>Vector database (Pinecone): ~$300/month</li>
<li>Graph database (Neo4j Aura): ~$500/month</li>
<li><strong>Total: $3,300/month or $39,600/year</strong></li>
</ul>
<p><strong>Self-hosted with Phi-4:</strong></p>
<ul>
<li>All infrastructure on AWS: ~$2,220/month or $26,640/year</li>
<li><strong>Annual savings: $12,960 (33% reduction)</strong></li>
</ul>
<p>Or go fully on-premise with a GPU server (~$6,000 upfront) and you're looking at $2,300/year in operating costs. Break-even in 2.3 months.</p>
<p>But cost isn't the whole story.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-sovereignty-changes-everything">Data Sovereignty Changes Everything<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#data-sovereignty-changes-everything" class="hash-link" aria-label="Direct link to Data Sovereignty Changes Everything" title="Direct link to Data Sovereignty Changes Everything">​</a></h3>
<p>If you're in healthcare, finance, or any regulated industry, you know the drill. Every vendor that touches your data needs:</p>
<ul>
<li>Business Associate Agreements (HIPAA)</li>
<li>Data Processing Agreements (GDPR)</li>
<li>SOC 2 audits</li>
<li>Regular security reviews</li>
<li>Incident response coordination</li>
</ul>
<p>With a self-hosted system? Your data never leaves your infrastructure. The compliance story becomes: "We don't send data anywhere." Done.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-at-your-pace">Performance at Your Pace<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#performance-at-your-pace" class="hash-link" aria-label="Direct link to Performance at Your Pace" title="Direct link to Performance at Your Pace">​</a></h3>
<p>No rate limits. No surprise throttling during usage spikes. No waiting on API quota increases.</p>
<p>You control the throughput. You optimize for your workload. You scale when ready.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-deep-dive">Architecture Deep Dive<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#architecture-deep-dive" class="hash-link" aria-label="Direct link to Architecture Deep Dive" title="Direct link to Architecture Deep Dive">​</a></h2>
<p>Let me show you what we're building:</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-four-storage-systems">Why Four Storage Systems?<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#why-four-storage-systems" class="hash-link" aria-label="Direct link to Why Four Storage Systems?" title="Direct link to Why Four Storage Systems?">​</a></h3>
<p>When I first looked at LightRAG, I thought "surely we don't need ALL of these." I tried running it with just PostgreSQL. Failed. Tried with just Neo4j. Failed.</p>
<p>Turns out, each storage system has a specific job:</p>
<p><strong>PostgreSQL with pgvector</strong> handles three critical tasks:</p>
<ul>
<li>Vector embeddings for similarity search</li>
<li>Key-value storage for document metadata</li>
<li>Document processing status tracking</li>
</ul>
<p><strong>Neo4j</strong> stores the knowledge graph—the relationships between entities that make Graph RAG powerful. This is where the magic happens: multi-hop reasoning, entity deduplication, and relationship inference.</p>
<p><strong>Redis</strong> caches LLM responses. When Phi-4 takes 2-3 seconds to extract entities from a document, you don't want to do it twice. Redis cut my processing time by 60% on repeated operations.</p>
<p><strong>Phi-4 via Ollama</strong> is your local LLM. 14 billion parameters, 128K context window (if you configure it right—more on that later), and it runs entirely on your hardware.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lightrag-the-secret-sauce">LightRAG: The Secret Sauce<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#lightrag-the-secret-sauce" class="hash-link" aria-label="Direct link to LightRAG: The Secret Sauce" title="Direct link to LightRAG: The Secret Sauce">​</a></h3>
<p>LightRAG isn't just another RAG framework. It's specifically designed for graph-based RAG with:</p>
<ul>
<li>
<p><strong>Multi-hop reasoning</strong>: "What technologies does our healthcare platform use and what security measures protect patient data?" requires jumping across multiple entity relationships.</p>
</li>
<li>
<p><strong>Entity deduplication</strong>: "AWS Lambda," "Lambda functions," and "λ" all refer to the same thing. LightRAG figures this out.</p>
</li>
<li>
<p><strong>Hybrid query modes</strong>: Choose between local search (specific entities), global search (broad patterns), or mix both for comprehensive answers.</p>
</li>
<li>
<p><strong>Document status tracking</strong>: Production systems fail. Documents get corrupted. APIs time out. LightRAG tracks every document's processing state with built-in retry capability.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="two-deployment-paths">Two Deployment Paths<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#two-deployment-paths" class="hash-link" aria-label="Direct link to Two Deployment Paths" title="Direct link to Two Deployment Paths">​</a></h2>
<p>I've deployed this system both ways. Here's what you need to know about each.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="path-1-local-linux-machine-budget-friendly">Path 1: Local Linux Machine (Budget-Friendly)<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#path-1-local-linux-machine-budget-friendly" class="hash-link" aria-label="Direct link to Path 1: Local Linux Machine (Budget-Friendly)" title="Direct link to Path 1: Local Linux Machine (Budget-Friendly)">​</a></h3>
<p>This is my development setup. One beefy Linux box in the corner of my office.</p>
<p><strong>Hardware requirements:</strong></p>
<p><em>Minimum viable (you can actually run this):</em></p>
<ul>
<li>CPU: 16 cores</li>
<li>RAM: 64GB</li>
<li>GPU: RTX 4090 (24GB VRAM)</li>
<li>Storage: 500GB NVMe SSD</li>
<li>Cost: ~$3,000-4,000</li>
</ul>
<p><em>Recommended (smooth experience):</em></p>
<ul>
<li>CPU: 24-32 cores</li>
<li>RAM: 128GB</li>
<li>GPU: A6000 (48GB VRAM) or dual RTX 4090</li>
<li>Storage: 1TB NVMe SSD</li>
<li>Cost: ~$6,000-8,000</li>
</ul>
<p><strong>Monthly operating cost:</strong> $50-150 (mostly electricity)</p>
<p>The beauty? After that initial hardware investment, you're essentially running free. No per-token charges. No usage-based billing surprises.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="path-2-aws-cloud-native-architecture">Path 2: AWS Cloud-Native Architecture<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#path-2-aws-cloud-native-architecture" class="hash-link" aria-label="Direct link to Path 2: AWS Cloud-Native Architecture" title="Direct link to Path 2: AWS Cloud-Native Architecture">​</a></h3>
<p>For production deployments, I recommend AWS. Here's the architecture:</p>
<!-- -->
<p>Here's the service mapping:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Component          Local                  AWS Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">─────────────────  ───────────────────    ─────────────────────────</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PostgreSQL         Docker Container        RDS for PostgreSQL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Neo4j              Docker Container        EC2 + EBS (Neo4j)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Redis              Docker Container        ElastiCache for Redis</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Phi</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">4 LLM          Ollama on GPU          EC2 G5 instance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LightRAG App       Docker Container        ECS Fargate / EC2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Storage            Local disk             EFS / S3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Why these specific choices?</strong></p>
<p><strong>RDS for PostgreSQL</strong> gives you managed backups, automated patching, and Multi-AZ high availability. Yes, it costs more than self-managed (~$280-560/month vs ~$100-200/month), but the operational overhead savings are worth it.</p>
<p><strong>Neo4j on EC2</strong> because there's no managed Neo4j on AWS yet. I use r6i.2xlarge (8 vCPU, 64GB RAM, ~$400/month) with gp3 EBS volumes. Reserved instances cut this to ~$300/month.</p>
<p><strong>ElastiCache for Redis</strong> (~$150-280/month) handles failover automatically. Better than self-managed for production.</p>
<p><strong>EC2 G5 for Phi-4</strong> is the interesting one. g5.2xlarge gives you 24GB GPU, enough for Phi-4. At $1.20/hour, that's <del>$900/month for 24/7 operation. But here's the trick: use Spot Instances during development for 60-70% savings. Run it only during business hours in dev environments (</del>$200-400/month).</p>
<p><strong>AWS Cost Reality Check:</strong></p>
<p>Development/testing: ~$870/month</p>
<ul>
<li>RDS PostgreSQL: $280</li>
<li>EC2 Neo4j: $200</li>
<li>ElastiCache Redis: $150</li>
<li>EC2 G5 (Spot, 8h/day): $100</li>
<li>ECS Fargate: $60</li>
<li>Storage: $50</li>
<li>Data Transfer: $30</li>
</ul>
<p>Production 24/7: ~$2,220/month</p>
<ul>
<li>RDS PostgreSQL Multi-AZ: $560</li>
<li>EC2 Neo4j Reserved: $300</li>
<li>ElastiCache Redis HA: $280</li>
<li>EC2 G5 Reserved: $650</li>
<li>ECS Fargate HA: $180</li>
<li>Infrastructure: $250</li>
</ul>
<p>Still 33% cheaper than the OpenAI API approach.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-i-learned-the-hard-way">What I Learned (The Hard Way)<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#what-i-learned-the-hard-way" class="hash-link" aria-label="Direct link to What I Learned (The Hard Way)" title="Direct link to What I Learned (The Hard Way)">​</a></h2>
<p>Let me save you some pain.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-1-git-history-and-upstream-syncing">Lesson 1: Git History and Upstream Syncing<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#lesson-1-git-history-and-upstream-syncing" class="hash-link" aria-label="Direct link to Lesson 1: Git History and Upstream Syncing" title="Direct link to Lesson 1: Git History and Upstream Syncing">​</a></h3>
<p>I forked the LightRAG repository to customize my docker-compose setup. Everything worked great until I wanted to pull upstream updates.</p>
<p><code>git merge upstream/main</code> failed spectacularly: "refusing to merge unrelated histories."</p>
<p>The problem? I'd made too many custom changes. The solution wasn't pretty:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Always backup before destructive operations</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">git branch backup-main-$(date +%Y%m%d)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Hard reset to upstream (scary but necessary)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">git reset --hard upstream/main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Cherry-pick your custom configs back</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">git checkout backup-branch -- docker-compose.yml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">git checkout backup-branch -- .env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Lesson learned:</strong> Keep your customizations in separate override files. LightRAG supports <code>docker-compose.override.yml</code> for exactly this reason.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-2-docker-service-dependencies-matter">Lesson 2: Docker Service Dependencies Matter<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#lesson-2-docker-service-dependencies-matter" class="hash-link" aria-label="Direct link to Lesson 2: Docker Service Dependencies Matter" title="Direct link to Lesson 2: Docker Service Dependencies Matter">​</a></h3>
<p>My first deployment kept failing with cryptic DNS resolution errors. The LightRAG container would start, try to connect to PostgreSQL, and fail—even though PostgreSQL was "running."</p>
<p>The issue? Service start order. PostgreSQL takes 10-15 seconds to actually become ready. LightRAG was trying to connect after 2 seconds.</p>
<p>The fix:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">lightrag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">neo4j</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">redis</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">healthcheck</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">test</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"CMD-SHELL"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"pg_isready -U postgres"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 5s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 5s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">retries</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now services wait for actual health, not just "started."</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-3-phi-4-context-window-configuration">Lesson 3: Phi-4 Context Window Configuration<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#lesson-3-phi-4-context-window-configuration" class="hash-link" aria-label="Direct link to Lesson 3: Phi-4 Context Window Configuration" title="Direct link to Lesson 3: Phi-4 Context Window Configuration">​</a></h3>
<p>This one cost me hours of debugging.</p>
<p>LightRAG needs at least 32K context window to work properly. Default Ollama models? 8K context.</p>
<p>I kept getting errors like "context length exceeded" during entity extraction. The documents weren't even that long—maybe 5,000 words.</p>
<p>The problem? Phi-4's system prompt, the document text, AND the structured output schema all fit in that context window. 8K wasn't enough.</p>
<p>The fix:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create a custom Modelfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama show --modelfile phi4 &gt; Modelfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Add this line</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo "PARAMETER num_ctx 32768" &gt;&gt; Modelfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create new model with larger context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama create -f Modelfile phi4-32k</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or set it via the API:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">llm_model_kwargs </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"options"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"num_ctx"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">32768</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Critical:</strong> If you're running LightRAG and seeing entity extraction failures, check your context window first.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-4-document-processing-needs-robust-retry-logic">Lesson 4: Document Processing Needs Robust Retry Logic<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#lesson-4-document-processing-needs-robust-retry-logic" class="hash-link" aria-label="Direct link to Lesson 4: Document Processing Needs Robust Retry Logic" title="Direct link to Lesson 4: Document Processing Needs Robust Retry Logic">​</a></h3>
<p>Production systems fail. API calls timeout. LLMs hallucinate invalid JSON. Documents get corrupted during upload.</p>
<p>I discovered LightRAG has a "Retry Failed Documents" button in the Web UI (in <code>lightrag_webui/src/features/DocumentManager.tsx</code>). It implements smart polling:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Fast polling during active retry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">startPollingInterval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// After 15 seconds, switch to adaptive polling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">setTimeout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> normalInterval </span><span class="token operator">=</span><span class="token plain"> hasActiveDocuments </span><span class="token operator">?</span><span class="token plain"> </span><span class="token number">5000</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">30000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">startPollingInterval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">normalInterval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">15000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This pattern—fast polling during active work, slow polling otherwise—is brilliant for managing client-side resource usage while maintaining responsiveness.</p>
<p>I adopted the same pattern for monitoring batch document uploads.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-5-memory-tuning-is-non-negotiable">Lesson 5: Memory Tuning Is Non-Negotiable<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#lesson-5-memory-tuning-is-non-negotiable" class="hash-link" aria-label="Direct link to Lesson 5: Memory Tuning Is Non-Negotiable" title="Direct link to Lesson 5: Memory Tuning Is Non-Negotiable">​</a></h3>
<p>Out-of-the-box configurations are sized for development, not production.</p>
<p>After indexing about 10,000 documents, my query performance degraded from 2 seconds to 15+ seconds. The culprit? Default memory settings.</p>
<p><strong>PostgreSQL tuning:</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- Assuming 64GB system RAM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shared_buffers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">8</span><span class="token plain">GB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">effective_cache_size </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">24</span><span class="token plain">GB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">maintenance_work_mem </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">GB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">work_mem </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">256</span><span class="token plain">MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Neo4j tuning:</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">dbms.memory.heap.max_size = 16G</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dbms.memory.pagecache.size = 20G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Result? Query performance improved 3-5x. Worth the 30 minutes to configure properly.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started-30-minute-quick-start">Getting Started: 30-Minute Quick Start<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#getting-started-30-minute-quick-start" class="hash-link" aria-label="Direct link to Getting Started: 30-Minute Quick Start" title="Direct link to Getting Started: 30-Minute Quick Start">​</a></h2>
<p>Let me walk you through the setup. This assumes you have Docker, Docker Compose, and either a GPU with 24GB+ VRAM or patience for CPU inference.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-prerequisites-check">Step 1: Prerequisites Check<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-1-prerequisites-check" class="hash-link" aria-label="Direct link to Step 1: Prerequisites Check" title="Direct link to Step 1: Prerequisites Check">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Docker and Docker Compose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker --version  # Should be 20.10+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker compose version  # Should be 2.0+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># GPU check (if using GPU)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nvidia-smi  # Should show your GPU</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Disk space</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">df -h  # Need 500GB+ free</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-clone-and-configure">Step 2: Clone and Configure<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-2-clone-and-configure" class="hash-link" aria-label="Direct link to Step 2: Clone and Configure" title="Direct link to Step 2: Clone and Configure">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/HKUDS/LightRAG.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd LightRAG</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp env.example .env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-set-up-phi-4-with-ollama">Step 3: Set Up Phi-4 with Ollama<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-3-set-up-phi-4-with-ollama" class="hash-link" aria-label="Direct link to Step 3: Set Up Phi-4 with Ollama" title="Direct link to Step 3: Set Up Phi-4 with Ollama">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Install Ollama</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -fsSL https://ollama.com/install.sh | sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Pull Phi-4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama pull phi4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Configure for 32K context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama show --modelfile phi4 &gt; Modelfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo "PARAMETER num_ctx 32768" &gt;&gt; Modelfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama create -f Modelfile phi4-32k</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Verify</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ollama run phi4-32k "Test message"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-configure-environment-variables">Step 4: Configure Environment Variables<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-4-configure-environment-variables" class="hash-link" aria-label="Direct link to Step 4: Configure Environment Variables" title="Direct link to Step 4: Configure Environment Variables">​</a></h3>
<p>Edit your <code>.env</code> file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># LLM Configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LLM_BINDING=ollama</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LLM_MODEL=phi4-32k</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EMBEDDING_MODEL=nomic-embed-text</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EMBEDDING_DIM=768</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Database Configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">POSTGRES_PASSWORD=your_secure_password_here</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NEO4J_PASSWORD=your_secure_password_here</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">REDIS_PASSWORD=your_secure_password_here</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Optional: API authentication</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LIGHTRAG_API_KEY=your_api_key_here</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Security note:</strong> Change those passwords. Seriously. I've seen production systems compromised because someone left the default "password123."</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-launch-the-stack">Step 5: Launch the Stack<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-5-launch-the-stack" class="hash-link" aria-label="Direct link to Step 5: Launch the Stack" title="Direct link to Step 5: Launch the Stack">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Start all services</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker compose up -d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Watch the logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker compose logs -f</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Wait for all services to be healthy (2-3 minutes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker compose ps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should see all services with status "Up (healthy)".</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-6-verify-deployment">Step 6: Verify Deployment<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-6-verify-deployment" class="hash-link" aria-label="Direct link to Step 6: Verify Deployment" title="Direct link to Step 6: Verify Deployment">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Check LightRAG API health</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl http://localhost:9621/health</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Should return: {"status": "healthy"}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Access Web UI</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">open http://localhost:9621/webui/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you see the Web UI, you're ready to start indexing documents.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="real-world-use-case-indexing-technical-documentation">Real-World Use Case: Indexing Technical Documentation<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#real-world-use-case-indexing-technical-documentation" class="hash-link" aria-label="Direct link to Real-World Use Case: Indexing Technical Documentation" title="Direct link to Real-World Use Case: Indexing Technical Documentation">​</a></h2>
<p>Let me show you a practical example. I recently indexed my company's entire technical documentation—about 500 Markdown files covering architecture, APIs, deployment guides, and runbooks.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-prepare-your-documents">Step 1: Prepare Your Documents<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-1-prepare-your-documents" class="hash-link" aria-label="Direct link to Step 1: Prepare Your Documents" title="Direct link to Step 1: Prepare Your Documents">​</a></h3>
<p>Export your documentation as plain text, Markdown, or PDF. Place files in an <code>inputs</code> directory:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir inputs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Copy your docs here</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-bulk-insert-via-api">Step 2: Bulk Insert via API<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-2-bulk-insert-via-api" class="hash-link" aria-label="Direct link to Step 2: Bulk Insert via API" title="Direct link to Step 2: Bulk Insert via API">​</a></h3>
<p>Here's a Python script I use for batch uploads:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> pathlib </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LIGHTRAG_URL </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"http://localhost:9621"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">API_KEY </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"your-api-key"</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># If authentication enabled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">headers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"Authorization"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Bearer </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">API_KEY</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"Content-Type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"application/json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">index_directory</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input_dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Index all text files in a directory"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    documents </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> file_path </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> Path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input_dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rglob</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"*.md"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"r"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> encoding</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"utf-8"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            content </span><span class="token operator">=</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            documents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"file_path"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"metadata"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token string" style="color:rgb(255, 121, 198)">"source"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"technical_docs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token string" style="color:rgb(255, 121, 198)">"category"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Batch insert (chunk if &gt;100 documents)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    batch_size </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">documents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> batch_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        batch </span><span class="token operator">=</span><span class="token plain"> documents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">i </span><span class="token operator">+</span><span class="token plain"> batch_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response </span><span class="token operator">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">post</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">LIGHTRAG_URL</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/documents/insert"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            headers</span><span class="token operator">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            json</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"documents"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> batch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">status_code </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">200</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Inserted batch </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation operator">//</span><span class="token string-interpolation interpolation">batch_size </span><span class="token string-interpolation interpolation operator">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number">1</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation builtin" style="color:rgb(189, 147, 249)">len</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation interpolation">batch</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> documents"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Error: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">response</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">status_code</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> - </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">response</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">text</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> __name__ </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"__main__"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    index_directory</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"./inputs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-monitor-processing">Step 3: Monitor Processing<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-3-monitor-processing" class="hash-link" aria-label="Direct link to Step 3: Monitor Processing" title="Direct link to Step 3: Monitor Processing">​</a></h3>
<p>Open the Web UI at <code>http://localhost:9621/webui/</code> and navigate to the Documents tab.</p>
<p>You'll see each document's processing status:</p>
<ul>
<li><strong>Pending</strong>: Queued for processing</li>
<li><strong>Processing</strong>: Currently extracting entities and relationships</li>
<li><strong>Completed</strong>: Successfully indexed</li>
<li><strong>Failed</strong>: Error occurred (check logs)</li>
</ul>
<p>For failed documents, click "Retry Failed Documents" to reprocess them.</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-query-your-knowledge-base">Step 4: Query Your Knowledge Base<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#step-4-query-your-knowledge-base" class="hash-link" aria-label="Direct link to Step 4: Query Your Knowledge Base" title="Direct link to Step 4: Query Your Knowledge Base">​</a></h3>
<p>Now for the fun part—querying:</p>
<!-- -->
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">query_knowledge_base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"hybrid"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    Query modes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    - local: Entity-focused, specific questions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    - global: High-level summaries, broad patterns</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    - hybrid: Combines both approaches</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    - naive: Traditional RAG (baseline comparison)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    - mix: Weighted combination of local and global</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response </span><span class="token operator">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">post</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">LIGHTRAG_URL</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/api/query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        headers</span><span class="token operator">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        json</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"mode"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"top_k"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">40</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Number of relevant chunks to retrieve</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    result </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"\n**Question:** </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">query</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"\n**Answer:**\n</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">'answer'</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"\n**Sources:** </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation builtin" style="color:rgb(189, 147, 249)">len</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation interpolation string" style="color:rgb(255, 121, 198)">'sources'</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> documents"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Example queries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">query_knowledge_base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"What is our microservices deployment strategy?"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mode</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"hybrid"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">query_knowledge_base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"How do we handle authentication across services?"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mode</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"local"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">query_knowledge_base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"Summarize our cloud infrastructure architecture"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mode</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"global"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="results-in-my-testing">Results in My Testing<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#results-in-my-testing" class="hash-link" aria-label="Direct link to Results in My Testing" title="Direct link to Results in My Testing">​</a></h3>
<p>On my 500-document technical documentation corpus:</p>
<ul>
<li><strong>Indexing time:</strong> ~45 minutes (with Phi-4 on RTX 4090)</li>
<li><strong>Query latency:</strong> 2-4 seconds for hybrid queries</li>
<li><strong>Answer quality:</strong> Consistently better than naive RAG, on par with GPT-4 + GraphRAG</li>
<li><strong>Cost:</strong> Zero per query (after infrastructure investment)</li>
</ul>
<p>The "hybrid" mode performed best for most questions, combining specific entity lookups with broader pattern recognition.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="production-considerations">Production Considerations<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#production-considerations" class="hash-link" aria-label="Direct link to Production Considerations" title="Direct link to Production Considerations">​</a></h2>
<p>Taking this from prototype to production requires thinking about security, monitoring, and reliability.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-hardening">Security Hardening<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#security-hardening" class="hash-link" aria-label="Direct link to Security Hardening" title="Direct link to Security Hardening">​</a></h3>
<p><strong>Network isolation is critical:</strong></p>
<ol>
<li>
<p><strong>VPC architecture</strong> (if on AWS):</p>
<ul>
<li>Private subnets for databases (no internet access)</li>
<li>Application subnet behind ALB</li>
<li>VPN or bastion host for admin access</li>
<li>Security groups limiting port access by source</li>
</ul>
</li>
<li>
<p><strong>Secret management:</strong></p>
<ul>
<li>Use AWS Secrets Manager or HashiCorp Vault</li>
<li>Rotate database passwords quarterly</li>
<li>Never commit <code>.env</code> files to git (add to <code>.gitignore</code>)</li>
<li>Use IAM roles instead of access keys where possible</li>
</ul>
</li>
<li>
<p><strong>API authentication:</strong></p>
<ul>
<li>Enable <code>LIGHTRAG_API_KEY</code> for production</li>
<li>Implement JWT tokens for user authentication</li>
<li>Add rate limiting (I recommend 100 requests/minute per user)</li>
<li>Log all API access for audit trails</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitoring-and-observability">Monitoring and Observability<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#monitoring-and-observability" class="hash-link" aria-label="Direct link to Monitoring and Observability" title="Direct link to Monitoring and Observability">​</a></h3>
<p>You can't fix what you can't see. Here's what I monitor:</p>
<p><strong>Application metrics:</strong></p>
<ul>
<li>Document processing throughput (documents/hour)</li>
<li>Query latency (p50, p95, p99 percentiles)</li>
<li>Error rates by operation type</li>
<li>LLM token usage (context window utilization)</li>
</ul>
<p><strong>Infrastructure metrics:</strong></p>
<ul>
<li>Database query performance (slow query logs)</li>
<li>Knowledge graph size (nodes/edges over time)</li>
<li>Disk space (especially for Neo4j graph data)</li>
<li>GPU utilization and memory (if using GPU inference)</li>
</ul>
<p><strong>Recommended tools:</strong></p>
<ul>
<li>Prometheus + Grafana for metrics visualization</li>
<li>ELK stack (Elasticsearch, Logstash, Kibana) for log aggregation</li>
<li>CloudWatch if on AWS (integrated with RDS, ECS, etc.)</li>
</ul>
<p><strong>Alerting rules I use:</strong></p>
<ul>
<li>Failed document processing count &gt; 10 in 1 hour</li>
<li>Query latency p95 &gt; 10 seconds</li>
<li>Database connection pool exhaustion</li>
<li>Disk space &lt; 20% remaining</li>
<li>GPU out-of-memory errors</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backup-and-disaster-recovery">Backup and Disaster Recovery<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#backup-and-disaster-recovery" class="hash-link" aria-label="Direct link to Backup and Disaster Recovery" title="Direct link to Backup and Disaster Recovery">​</a></h3>
<p>Data loss in a knowledge base is catastrophic. Your entire organization's institutional knowledge, gone.</p>
<p><strong>My backup strategy:</strong></p>
<p><strong>PostgreSQL:</strong></p>
<ul>
<li>Automated daily snapshots (RDS handles this automatically)</li>
<li>Point-in-time recovery enabled (up to 7 days)</li>
<li>Monthly backups exported to S3 for long-term retention</li>
</ul>
<p><strong>Neo4j:</strong></p>
<ul>
<li>Weekly full backups using <code>neo4j-admin backup</code></li>
<li>Daily incremental backups</li>
<li>Store backups in separate S3 bucket with versioning</li>
</ul>
<p><strong>Redis:</strong></p>
<ul>
<li>AOF (Append-Only File) persistence enabled</li>
<li>RDB snapshots every 6 hours</li>
<li>Redis data is cache—can be rebuilt from PostgreSQL if lost</li>
</ul>
<p><strong>S3 document storage:</strong></p>
<ul>
<li>Versioning enabled (recover accidentally deleted files)</li>
<li>Cross-region replication for disaster recovery</li>
<li>Lifecycle policies to archive old versions to Glacier</li>
</ul>
<p><strong>Recovery objectives:</strong></p>
<ul>
<li>RTO (Recovery Time Objective): &lt; 4 hours</li>
<li>RPO (Recovery Point Objective): &lt; 24 hours</li>
</ul>
<p>Test your recovery process quarterly. I learned this the hard way when a junior engineer accidentally dropped a Neo4j database. Took us 6 hours to restore because we'd never practiced the procedure.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaling-strategies">Scaling Strategies<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#scaling-strategies" class="hash-link" aria-label="Direct link to Scaling Strategies" title="Direct link to Scaling Strategies">​</a></h3>
<p>Start small, scale based on actual usage metrics.</p>
<!-- -->
<p><strong>Vertical scaling (do this first):</strong></p>
<ul>
<li>Increase PostgreSQL instance size (more RAM = better vector search performance)</li>
<li>Add more RAM to Neo4j (graph traversal is memory-intensive)</li>
<li>Upgrade to larger GPU for Phi-4 (faster inference)</li>
</ul>
<p><strong>Horizontal scaling (when vertical hits limits):</strong></p>
<ul>
<li>PostgreSQL read replicas for query traffic</li>
<li>Neo4j Causal Cluster for high availability (Enterprise Edition required)</li>
<li>Multiple LightRAG application instances behind ALB</li>
<li>Consider dedicated Phi-4 inference endpoints per workload</li>
</ul>
<p><strong>Performance optimization tricks:</strong></p>
<ul>
<li>Enable aggressive query result caching in Redis</li>
<li>Use pgvector HNSW indexing (better than IVFFlat for most cases)</li>
<li>Batch document processing during off-peak hours</li>
<li>Implement connection pooling (PgBouncer for PostgreSQL)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="roi-and-business-case">ROI and Business Case<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#roi-and-business-case" class="hash-link" aria-label="Direct link to ROI and Business Case" title="Direct link to ROI and Business Case">​</a></h2>
<p>Let me break down the economics for your CFO.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-month-cost-comparison">12-Month Cost Comparison<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#12-month-cost-comparison" class="hash-link" aria-label="Direct link to 12-Month Cost Comparison" title="Direct link to 12-Month Cost Comparison">​</a></h3>
<p><strong>OpenAI API Approach (baseline):</strong></p>
<table><thead><tr><th>Component</th><th>Monthly</th><th>Annual</th></tr></thead><tbody><tr><td>GPT-4 API (entity extraction)</td><td>$1,500</td><td>$18,000</td></tr><tr><td>GPT-4 API (query responses)</td><td>$800</td><td>$9,600</td></tr><tr><td>Embedding API</td><td>$200</td><td>$2,400</td></tr><tr><td>Vector database (Pinecone)</td><td>$300</td><td>$3,600</td></tr><tr><td>Graph database (Neo4j Aura)</td><td>$500</td><td>$6,000</td></tr><tr><td><strong>TOTAL</strong></td><td><strong>$3,300</strong></td><td><strong>$39,600</strong></td></tr></tbody></table>
<p><strong>Self-Hosted on AWS:</strong></p>
<table><thead><tr><th>Component</th><th>Monthly</th><th>Annual</th></tr></thead><tbody><tr><td>RDS PostgreSQL</td><td>$560</td><td>$6,720</td></tr><tr><td>EC2 Neo4j (Reserved)</td><td>$300</td><td>$3,600</td></tr><tr><td>ElastiCache Redis</td><td>$280</td><td>$3,360</td></tr><tr><td>EC2 G5 Phi-4 (Reserved)</td><td>$650</td><td>$7,800</td></tr><tr><td>ECS Fargate LightRAG</td><td>$180</td><td>$2,160</td></tr><tr><td>Infrastructure (ALB, S3, etc)</td><td>$250</td><td>$3,000</td></tr><tr><td><strong>TOTAL</strong></td><td><strong>$2,220</strong></td><td><strong>$26,640</strong></td></tr></tbody></table>
<p><strong>Annual savings: $12,960 (33% reduction)</strong></p>
<p><strong>Self-Hosted On-Premise:</strong></p>
<table><thead><tr><th>Component</th><th>Initial</th><th>Annual Operating</th></tr></thead><tbody><tr><td>Hardware (GPU server)</td><td>$6,000</td><td>-</td></tr><tr><td>Electricity (24/7)</td><td>-</td><td>$1,200</td></tr><tr><td>Internet/Bandwidth</td><td>-</td><td>$600</td></tr><tr><td>Maintenance/Upgrades</td><td>-</td><td>$500</td></tr><tr><td><strong>TOTAL</strong></td><td><strong>$6,000 upfront</strong></td><td><strong>$2,300/year</strong></td></tr></tbody></table>
<p><strong>Break-even vs OpenAI: 2.3 months</strong>
<strong>3-year TCO: $12,900 (67% savings vs OpenAI)</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="beyond-cost-strategic-value">Beyond Cost: Strategic Value<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#beyond-cost-strategic-value" class="hash-link" aria-label="Direct link to Beyond Cost: Strategic Value" title="Direct link to Beyond Cost: Strategic Value">​</a></h3>
<p>The spreadsheet tells part of the story. Here's the rest:</p>
<p><strong>Data sovereignty:</strong> Your proprietary knowledge base never touches third-party APIs. For healthcare, finance, or legal firms, this eliminates entire categories of compliance concerns.</p>
<p><strong>Predictable scaling:</strong> No surprise bills when usage spikes. Your infrastructure costs are fixed—scale at your own pace.</p>
<p><strong>Customization freedom:</strong> Fine-tune Phi-4 on your domain-specific data. Optimize prompt templates for your use cases. Implement custom entity extraction logic. Good luck doing that with a closed API.</p>
<p><strong>Performance guarantees:</strong> No rate limits. No throttling. No waiting on quota increases. You control throughput and optimize for your specific workload.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="when-should-you-choose-this-approach">When Should You Choose This Approach?<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#when-should-you-choose-this-approach" class="hash-link" aria-label="Direct link to When Should You Choose This Approach?" title="Direct link to When Should You Choose This Approach?">​</a></h2>
<p>Not every organization needs self-hosted RAG. Here's my decision framework:</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-choose-local--lightrag-if-you">✅ Choose Local + LightRAG if you:<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#-choose-local--lightrag-if-you" class="hash-link" aria-label="Direct link to ✅ Choose Local + LightRAG if you:" title="Direct link to ✅ Choose Local + LightRAG if you:">​</a></h3>
<ul>
<li><strong>Have proprietary/sensitive data</strong> - HIPAA, GDPR, trade secrets, or anything you can't ethically send to third parties</li>
<li><strong>Need predictable costs at scale</strong> - Processing 50K+ documents with 10K+ queries/day makes APIs expensive fast</li>
<li><strong>Require customization</strong> - Domain-specific entity extraction, custom graph schemas, specialized prompts</li>
<li><strong>Want infrastructure control</strong> - Security policies require on-premise or specific cloud configurations</li>
<li><strong>Can invest in setup</strong> - Initial deployment takes 2-4 weeks with proper testing and hardening</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-stick-with-apis-if-you">❌ Stick with APIs if you:<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#-stick-with-apis-if-you" class="hash-link" aria-label="Direct link to ❌ Stick with APIs if you:" title="Direct link to ❌ Stick with APIs if you:">​</a></h3>
<ul>
<li><strong>Need fastest time to market</strong> - Can't wait 2-4 weeks for infrastructure setup</li>
<li><strong>Have limited DevOps resources</strong> - No one on staff comfortable managing databases and GPU inference</li>
<li><strong>Process non-sensitive data</strong> - Public information, marketing content, open-source docs</li>
<li><strong>Prefer variable opex over fixed capex</strong> - Want to pay per use, not maintain infrastructure</li>
<li><strong>Require vendor support SLAs</strong> - Need 24/7 support with guaranteed response times</li>
</ul>
<p>For most enterprises with &gt;10K documents and serious data governance requirements, self-hosted makes sense. For startups prototyping or teams processing public data, APIs are faster and simpler.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-enhancements-im-exploring">Future Enhancements I'm Exploring<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#future-enhancements-im-exploring" class="hash-link" aria-label="Direct link to Future Enhancements I'm Exploring" title="Direct link to Future Enhancements I'm Exploring">​</a></h2>
<p>This is where things get exciting.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-modal-rag">Multi-Modal RAG<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#multi-modal-rag" class="hash-link" aria-label="Direct link to Multi-Modal RAG" title="Direct link to Multi-Modal RAG">​</a></h3>
<p>Current limitation: LightRAG processes text only. But most technical documentation includes:</p>
<ul>
<li>Architecture diagrams</li>
<li>Database schemas</li>
<li>Screenshots of UIs</li>
<li>Performance graphs</li>
</ul>
<p>I'm experimenting with integrating vision models (like LLaVA) to extract information from images before feeding to LightRAG. Early tests show promise for understanding architecture diagrams.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-query-capabilities">Advanced Query Capabilities<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#advanced-query-capabilities" class="hash-link" aria-label="Direct link to Advanced Query Capabilities" title="Direct link to Advanced Query Capabilities">​</a></h3>
<p>Right now, queries are natural language with keyword extraction. I want:</p>
<ul>
<li><strong>Natural language to Cypher</strong> - "Show me all services that depend on the authentication API" → translated to Neo4j Cypher query</li>
<li><strong>Temporal queries</strong> - "How has our deployment strategy evolved over the past year?"</li>
<li><strong>Multi-hop reasoning visualization</strong> - See the graph traversal that produced an answer</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="continuous-learning-pipeline">Continuous Learning Pipeline<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#continuous-learning-pipeline" class="hash-link" aria-label="Direct link to Continuous Learning Pipeline" title="Direct link to Continuous Learning Pipeline">​</a></h3>
<p>LightRAG doesn't learn from user feedback yet. I'm building:</p>
<ul>
<li>Thumbs up/down on answers to identify weak areas</li>
<li>User corrections of entity relationships</li>
<li>Automated fine-tuning pipeline for Phi-4 on corrected examples</li>
</ul>
<p>The goal: knowledge base quality improves over time based on actual usage.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-takeaways">Key Takeaways<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways">​</a></h2>
<p>After six months of building, deploying, and refining this system, here's what matters:</p>
<ol>
<li>
<p><strong>Local SLMs are production-ready</strong> - Phi-4 handles complex RAG tasks that I previously thought required GPT-4. The performance gap is closing fast.</p>
</li>
<li>
<p><strong>Graph RAG outperforms naive RAG</strong> - Multi-hop reasoning and entity relationships produce substantially better answers for complex questions. The difference is dramatic.</p>
</li>
<li>
<p><strong>Cost savings are real</strong> - 30-60% reduction in operating costs compared to API-based approaches. More importantly, costs are predictable and don't scale with usage.</p>
</li>
<li>
<p><strong>Control matters more than convenience</strong> - For enterprises with sensitive data, the ability to keep everything in-house is worth the operational complexity.</p>
</li>
<li>
<p><strong>Setup time is the main barrier</strong> - Initial deployment takes 2-4 weeks. But once running, maintenance is minimal (2-4 hours/month).</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="get-started-today">Get Started Today<a href="https://jonroosevelt.com/blog/production-rag-system-phi4-lightrag#get-started-today" class="hash-link" aria-label="Direct link to Get Started Today" title="Direct link to Get Started Today">​</a></h2>
<p>If you're convinced this approach makes sense for your organization, here's your next steps:</p>
<ol>
<li>
<p><strong>Start with development deployment</strong> - Prove the concept on a subset of your documents (~1,000) before committing to production infrastructure</p>
</li>
<li>
<p><strong>Measure baseline performance</strong> - Index documents and run representative queries. Benchmark against your current solution (if any).</p>
</li>
<li>
<p><strong>Calculate your economics</strong> - Use your actual document count and query volume to build a cost model. Factor in setup time and maintenance.</p>
</li>
<li>
<p><strong>Plan your production architecture</strong> - Decide on AWS vs on-premise based on your compliance requirements and existing infrastructure.</p>
</li>
<li>
<p><strong>Gradually migrate</strong> - Don't try to index everything at once. Start with one domain (e.g., engineering docs) and expand iteratively.</p>
</li>
</ol>
<hr>
<p>Have you experimented with local LLMs for RAG? I'd love to hear about your experiences—what worked, what didn't, and what surprised you.</p>
<p>If you found this helpful:</p>
<ul>
<li>⭐ Star the <a href="https://github.com/HKUDS/LightRAG" target="_blank" rel="noopener noreferrer">LightRAG repository</a></li>
<li>📢 Share this with your engineering team</li>
<li>💬 Drop a comment with your implementation challenges</li>
</ul>
<p>I'm planning follow-up posts on:</p>
<ul>
<li>Fine-tuning Phi-4 for domain-specific entity extraction</li>
<li>Optimizing Neo4j query performance for large knowledge graphs</li>
<li>Building a Claude Code MCP integration for querying from your editor</li>
</ul>
<p>Which would you find most valuable? Let me know.</p>
<hr>
<p><em>Jon Roosevelt is an AI architect specializing in healthcare and enterprise systems. He's helped organizations build production ML systems handling millions of documents and has a particular interest in making powerful AI accessible through self-hosted infrastructure.</em></p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="LLM" term="LLM"/>
        <category label="RAG" term="RAG"/>
        <category label="Healthcare" term="Healthcare"/>
        <category label="Cloud" term="Cloud"/>
        <category label="Architecture" term="Architecture"/>
        <category label="Data" term="Data"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building an AI Analysis Agent in Hours - A No-Code Approach with Lovable and N8N]]></title>
        <id>https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n</id>
        <link href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n"/>
        <updated>2025-05-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I used to spend 6+ hours writing Analysis of Alternatives reports. Last week, I built an AI agent that does it in minutes - and you can too, without writing complex code.]]></summary>
        <content type="html"><![CDATA[<p>I used to spend 6+ hours writing Analysis of Alternatives reports. Last week, I built an AI agent that does it in minutes - and you can too, without writing complex code.</p>
<!-- -->
<p><img decoding="async" loading="lazy" alt="AOA Agent Demo Interface" src="https://jonroosevelt.com/assets/images/aoa-interface-906fdc850049132a5a8217ac3f698445.png" width="2752" height="1536" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-10000-analysis-problem">The $10,000 Analysis Problem<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#the-10000-analysis-problem" class="hash-link" aria-label="Direct link to The $10,000 Analysis Problem" title="Direct link to The $10,000 Analysis Problem">​</a></h2>
<p>Every time a client needed an Analysis of Alternatives (AOA) report, I'd block out an entire day. Research competitors, analyze features, evaluate pricing models, compile citations - it was a necessary but exhausting process. At my consulting rate, each report effectively cost thousands of dollars in time.</p>
<p>Then it hit me at 2 AM during yet another report marathon: What if an AI could handle the research and compilation, while I focused on strategy and insights?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-were-building-today">What We're Building Today<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#what-were-building-today" class="hash-link" aria-label="Direct link to What We're Building Today" title="Direct link to What We're Building Today">​</a></h2>
<p>Before diving into the how, let me show you what's possible. I built an agent that:</p>
<ul>
<li><strong>Researches any topic</strong> using Perplexity AI's real-time web search</li>
<li><strong>Writes comprehensive reports</strong> with 15-30 citations for deep research</li>
<li><strong>Self-evaluates and improves</strong> through an automated feedback loop</li>
<li><strong>Delivers in minutes</strong> what used to take hours</li>
</ul>
<p><strong><a href="https://aoa.jonroosevelt.com/" target="_blank" rel="noopener noreferrer">Try the live demo here →</a></strong>
<strong><a href="https://www.loom.com/share/d0d05614c00447f79b2fc6f5edb2a6cf" target="_blank" rel="noopener noreferrer">Watch tutorial →</a></strong></p>
<p>The agent offers two modes:</p>
<ul>
<li><strong>Pro Mode</strong>: 2-4 minute reports with 5 citations (perfect for quick comparisons)</li>
<li><strong>Deep Research Mode</strong>: 10+ minute reports with 15-30 citations (for thorough analysis)</li>
</ul>
<p>Here's where it gets interesting - I built this entire system in a matter of hours using visual tools, not months of coding.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-no-code-stack-that-makes-it-magic">The No-Code Stack That Makes It Magic<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#the-no-code-stack-that-makes-it-magic" class="hash-link" aria-label="Direct link to The No-Code Stack That Makes It Magic" title="Direct link to The No-Code Stack That Makes It Magic">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="meet-your-new-best-friends">Meet Your New Best Friends<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#meet-your-new-best-friends" class="hash-link" aria-label="Direct link to Meet Your New Best Friends" title="Direct link to Meet Your New Best Friends">​</a></h3>
<p><strong><a href="https://lovable.dev/" target="_blank" rel="noopener noreferrer">Lovable</a></strong> - Your AI UI Assistant</p>
<ul>
<li>Transforms ideas into working interfaces through chat</li>
<li>No React knowledge needed (though it helps)</li>
<li>Handles all the complex frontend setup</li>
<li>Free tier available to get started</li>
</ul>
<p><strong><a href="https://n8n.io/" target="_blank" rel="noopener noreferrer">N8N</a></strong> - The Workflow Wizard</p>
<ul>
<li>Visual workflow automation that actually makes sense</li>
<li>Connects to any API without code</li>
<li>Self-hostable (I run mine on a VPS)</li>
<li>Think Zapier, but with superpowers</li>
</ul>
<p>The magic happens when these two tools work together. Lovable creates the user interface, N8N handles the AI orchestration, and they communicate through a simple webhook.</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-creating-the-ui-with-lovable">Part 1: Creating the UI with Lovable<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#part-1-creating-the-ui-with-lovable" class="hash-link" aria-label="Direct link to Part 1: Creating the UI with Lovable" title="Direct link to Part 1: Creating the UI with Lovable">​</a></h2>
<p>Getting started with Lovable takes literally 30 seconds. Here's how I built the search interface:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-the-initial-prompt">Step 1: The Initial Prompt<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#step-1-the-initial-prompt" class="hash-link" aria-label="Direct link to Step 1: The Initial Prompt" title="Direct link to Step 1: The Initial Prompt">​</a></h3>
<p>I started with this simple request:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Create a search interface with two modes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Pro mode (2-4 minutes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Deep Research mode (10+ minutes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Include a text input for the search query and a search button.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Lovable immediately generated a clean React interface. But here's the clever part...</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-adding-the-api-connection">Step 2: Adding the API Connection<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#step-2-adding-the-api-connection" class="hash-link" aria-label="Direct link to Step 2: Adding the API Connection" title="Direct link to Step 2: Adding the API Connection">​</a></h3>
<p>The real magic happens when you connect to your backend:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Lovable generated this for me</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">handleSearch</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">fetch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'https://your-n8n-webhook-url/aoa'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'POST'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'application/json'</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">body</span><span class="token operator">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">stringify</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token literal-property property">task</span><span class="token operator">:</span><span class="token plain"> searchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token plain"> searchMode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">setReport</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">report</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-making-it-beautiful">Step 3: Making It Beautiful<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#step-3-making-it-beautiful" class="hash-link" aria-label="Direct link to Step 3: Making It Beautiful" title="Direct link to Step 3: Making It Beautiful">​</a></h3>
<p>Lovable's AI understands design principles. I simply asked:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Make this look professional with a modern gradient background </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">and smooth animations when the report loads</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Within minutes, I had a polished interface that looked like it took weeks to build.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-building-the-brain-with-n8n">Part 2: Building the Brain with N8N<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#part-2-building-the-brain-with-n8n" class="hash-link" aria-label="Direct link to Part 2: Building the Brain with N8N" title="Direct link to Part 2: Building the Brain with N8N">​</a></h2>
<p>This is where your agent gets its intelligence. N8N's visual interface makes complex workflows surprisingly intuitive.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-workflow-architecture">The Workflow Architecture<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#the-workflow-architecture" class="hash-link" aria-label="Direct link to The Workflow Architecture" title="Direct link to The Workflow Architecture">​</a></h3>
<p><img decoding="async" loading="lazy" alt="N8N Workflow Overview" src="https://jonroosevelt.com/assets/images/n8n-workflow-e8da74ae367356bd3a457b01378292d9.png" width="2752" height="1536" class="img_ev3q"></p>
<p>Here's how the workflow processes each request:</p>
<ol>
<li><strong>Webhook Trigger</strong>: Receives the search query from Lovable</li>
<li><strong>Mode Branch</strong>: Routes to different prompts based on Pro/Deep mode</li>
<li><strong>Perplexity Research</strong>: Performs web research with citations</li>
<li><strong>Report Writing</strong>: Claude crafts the analysis</li>
<li><strong>Quality Evaluation</strong>: Checks if the report meets standards</li>
<li><strong>Retry Logic</strong>: Improves the report if needed</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-research-phase">The Research Phase<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#the-research-phase" class="hash-link" aria-label="Direct link to The Research Phase" title="Direct link to The Research Phase">​</a></h3>
<p>The Perplexity integration is straightforward but powerful:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// N8N expression in the Perplexity node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string-property property">"model"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"sonar"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string-property property">"messages"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string-property property">"role"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">Write a thorough report on: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">json</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation property-access">body</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation property-access">task</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="smart-prompt-engineering">Smart Prompt Engineering<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#smart-prompt-engineering" class="hash-link" aria-label="Direct link to Smart Prompt Engineering" title="Direct link to Smart Prompt Engineering">​</a></h3>
<p>For Deep Research mode, I provide extensive instructions:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">instructions</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Write an Analysis of Alternatives report with:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Length: 4000-5000 words</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Citations: 15-30 sources</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Sections: Executive Summary, Evaluation Criteria, </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Detailed Analysis, Recommendations</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">instructions</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">example</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[One-shot example of a high-quality report]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">example</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This XML structure (following OpenAI's latest guidelines) ensures consistent, high-quality output.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-the-secret-sauce---quality-control-loop">Part 3: The Secret Sauce - Quality Control Loop<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#part-3-the-secret-sauce---quality-control-loop" class="hash-link" aria-label="Direct link to Part 3: The Secret Sauce - Quality Control Loop" title="Direct link to Part 3: The Secret Sauce - Quality Control Loop">​</a></h2>
<p>Here's what sets this agent apart - it doesn't just generate content, it critiques and improves it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-evaluator-pattern">The Evaluator Pattern<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#the-evaluator-pattern" class="hash-link" aria-label="Direct link to The Evaluator Pattern" title="Direct link to The Evaluator Pattern">​</a></h3>
<p>After generating a report, the workflow runs it through an evaluator:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Simplified evaluation logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> evaluationCriteria </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">hasExecutiveSummary</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">citationCount</span><span class="token operator">:</span><span class="token plain"> mode </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'deep'</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token number">15</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">wordCount</span><span class="token operator">:</span><span class="token plain"> mode </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'deep'</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token number">4000</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">sectionsComplete</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">meetsAllCriteria</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Retry with specific feedback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">retryWithFeedback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">evaluation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">rationale</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-retry-mechanism">The Retry Mechanism<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#the-retry-mechanism" class="hash-link" aria-label="Direct link to The Retry Mechanism" title="Direct link to The Retry Mechanism">​</a></h3>
<p>If the report doesn't meet standards, the agent:</p>
<ol>
<li>Captures the evaluator's feedback</li>
<li>Adds it to the prompt: "Your previous attempt failed because..."</li>
<li>Regenerates with improvements</li>
<li>Limits retries to 5 attempts to prevent infinite loops</li>
</ol>
<p>This self-improvement loop typically produces excellent results within 1-2 iterations.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-optimization">Performance Optimization<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#performance-optimization" class="hash-link" aria-label="Direct link to Performance Optimization" title="Direct link to Performance Optimization">​</a></h3>
<p>To keep costs down and speed up development:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Pin successful outputs during testing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">testMode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">saveOutput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">perplexityResult</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> pinnedOutput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Skip API call</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This "pinned data" approach saved me hundreds of dollars during development.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-your-own-in-5-minutes">Deploy Your Own in 5 Minutes<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#deploy-your-own-in-5-minutes" class="hash-link" aria-label="Direct link to Deploy Your Own in 5 Minutes" title="Direct link to Deploy Your Own in 5 Minutes">​</a></h2>
<p>Ready to build your own AI agent? Here's your quickstart guide:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="requirements-checklist">Requirements Checklist<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#requirements-checklist" class="hash-link" aria-label="Direct link to Requirements Checklist" title="Direct link to Requirements Checklist">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Lovable account (free tier works)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->N8N instance (cloud or self-hosted)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Perplexity API key ($5 gets you started)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->OpenRouter account for Claude access</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quick-deployment-steps">Quick Deployment Steps<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#quick-deployment-steps" class="hash-link" aria-label="Direct link to Quick Deployment Steps" title="Direct link to Quick Deployment Steps">​</a></h3>
<ol>
<li>
<p><strong>Clone the Lovable template</strong>:</p>
<ul>
<li>Start a new Lovable project</li>
<li>Copy the UI code from my examples</li>
<li>Update the webhook URL</li>
</ul>
</li>
<li>
<p><strong>Import the N8N workflow</strong>:</p>
<ul>
<li>Download the <a href="https://github.com/yourusername/aoa-agent" target="_blank" rel="noopener noreferrer">workflow template</a></li>
<li>Import into your N8N instance</li>
<li>Add your API keys</li>
</ul>
</li>
<li>
<p><strong>Configure the connection</strong>:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// In Lovable, update this line:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">WEBHOOK_URL</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'https://your-n8n-domain.com/webhook/aoa'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Test with a simple query</strong>:</p>
<ul>
<li>Try: "Compare the best CRM tools for small businesses"</li>
<li>You should see results in 2-4 minutes</li>
</ul>
</li>
<li>
<p><strong>Customize for your needs</strong>:</p>
<ul>
<li>Adjust the prompt templates</li>
<li>Modify evaluation criteria</li>
<li>Add your own examples</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-customizations">Common Customizations<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#common-customizations" class="hash-link" aria-label="Direct link to Common Customizations" title="Direct link to Common Customizations">​</a></h3>
<p><strong>For Legal/Compliance Reports</strong>:</p>
<ul>
<li>Add regulatory citation requirements</li>
<li>Include risk assessment sections</li>
<li>Enforce specific formatting standards</li>
</ul>
<p><strong>For Technical Comparisons</strong>:</p>
<ul>
<li>Emphasize performance metrics</li>
<li>Add code examples</li>
<li>Include architecture diagrams</li>
</ul>
<p><strong>For Business Analysis</strong>:</p>
<ul>
<li>Focus on ROI calculations</li>
<li>Add market size data</li>
<li>Include competitor pricing</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What's Next?<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#whats-next" class="hash-link" aria-label="Direct link to What's Next?" title="Direct link to What's Next?">​</a></h2>
<p>This agent is just the beginning. Here are some enhancements you could add:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enhancement-ideas">Enhancement Ideas<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#enhancement-ideas" class="hash-link" aria-label="Direct link to Enhancement Ideas" title="Direct link to Enhancement Ideas">​</a></h3>
<ul>
<li><strong>Multi-language support</strong>: Translate reports automatically</li>
<li><strong>PDF generation</strong>: Export polished documents</li>
<li><strong>Team collaboration</strong>: Share and edit reports</li>
<li><strong>Historical tracking</strong>: Compare analyses over time</li>
<li><strong>Custom templates</strong>: Industry-specific formats</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="join-the-community">Join the Community<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#join-the-community" class="hash-link" aria-label="Direct link to Join the Community" title="Direct link to Join the Community">​</a></h3>
<p>Building AI agents shouldn't be a solo journey:</p>
<ul>
<li><strong><a href="https://discord.gg/lovable" target="_blank" rel="noopener noreferrer">Lovable Discord</a></strong>: Get UI help and share creations</li>
<li><strong><a href="https://community.n8n.io/" target="_blank" rel="noopener noreferrer">N8N Community</a></strong>: Find workflows and troubleshooting</li>
<li><strong><a href="https://github.com/RooseveltAdvisors" target="_blank" rel="noopener noreferrer">My GitHub</a></strong>: Access the full source code</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resources-to-level-up">Resources to Level Up<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#resources-to-level-up" class="hash-link" aria-label="Direct link to Resources to Level Up" title="Direct link to Resources to Level Up">​</a></h3>
<ul>
<li><strong><a href="https://www.loom.com/share/d0d05614c00447f79b2fc6f5edb2a6cf" target="_blank" rel="noopener noreferrer">Loom Video Tutorial</a></strong>: Watch me build this step-by-step</li>
<li><strong><a href="https://docs.perplexity.ai/" target="_blank" rel="noopener noreferrer">Perplexity API Docs</a></strong>: Master advanced search features</li>
<li><strong><a href="https://platform.openai.com/docs/guides/prompt-engineering" target="_blank" rel="noopener noreferrer">Prompt Engineering Guide</a></strong>: Write better AI instructions</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="your-turn">Your Turn<a href="https://jonroosevelt.com/blog/building-aoa-agent-lovable-n8n#your-turn" class="hash-link" aria-label="Direct link to Your Turn" title="Direct link to Your Turn">​</a></h2>
<p>The best part about this approach? You can build your own specialized agent this weekend. Whether it's market research, technical documentation, or competitive analysis, the pattern remains the same:</p>
<ol>
<li><strong>Design</strong> a simple UI with Lovable</li>
<li><strong>Build</strong> the logic flow in N8N</li>
<li><strong>Connect</strong> to AI services</li>
<li><strong>Iterate</strong> based on results</li>
</ol>
<p>Stop spending days on repetitive analysis. Start building agents that work while you sleep.</p>
<p><strong>Ready to begin? <a href="https://aoa.jonroosevelt.com/" target="_blank" rel="noopener noreferrer">Try the live demo</a> and see what's possible.</strong></p>
<hr>
<p><em>Have questions or want to share what you built? <a href="https://www.linkedin.com/in/jonroosevelt/" target="_blank" rel="noopener noreferrer">Find me on LinkedIn</a> or <a href="https://jonroosevelt.com/" target="_blank" rel="noopener noreferrer">visit my website</a>. I'd love to see your AI agents in action!</em></p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="No-Code" term="No-Code"/>
        <category label="Lovable" term="Lovable"/>
        <category label="n8n" term="n8n"/>
        <category label="Automation" term="Automation"/>
        <category label="Agents" term="Agents"/>
        <category label="Perplexity" term="Perplexity"/>
        <category label="Claude" term="Claude"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Supporting SSE for Model Context Protocol (MCP) in Python - Introducing fastapi-mcp-client]]></title>
        <id>https://jonroosevelt.com/blog/fastapi-mcp-client</id>
        <link href="https://jonroosevelt.com/blog/fastapi-mcp-client"/>
        <updated>2025-04-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I've been working on a project to support SSE for MCP. Couldn't find any good example on the client in Python for supporting SSE with FastAPI MCP. So I wrote it up myself and thought I will share everyone. Hope everyone find it useful.]]></summary>
        <content type="html"><![CDATA[<p>I've been working on a project to support SSE for MCP. Couldn't find any good example on the client in Python for supporting SSE with FastAPI MCP. So I wrote it up myself and thought I will share everyone. Hope everyone find it useful.</p>
<p><img decoding="async" loading="lazy" alt="MCP overview" src="https://jonroosevelt.com/assets/images/mcp-70674788784fd9dba658f0575ab136b3.png" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<p>Model Context Protocol (MCP) is an emerging standard for communication between
applications and AI models or services. It provides a structured way to:</p>
<ol>
<li><strong>Establish a session</strong> between client and server</li>
<li><strong>Call model-powered tools</strong> with parameters</li>
<li><strong>Process streaming results</strong> in a standardized format</li>
<li><strong>Maintain context</strong> across multiple interactions</li>
</ol>
<p>This protocol is particularly valuable for applications that need to interact with AI services while
supporting streaming responses - a pattern that's becoming increasingly common as models
generate content incrementally.</p>
<h1>The MCP Flow: How It Works</h1>
<p>MCP over Server-Sent Events (SSE) creates a robust pattern for streaming AI responses:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌────────┐                                   ┌────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │  </span><span class="token number">1.</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">GET</span><span class="token plain"> </span><span class="token operator">/</span><span class="token function" style="color:rgb(80, 250, 123)">mcp</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token constant" style="color:rgb(189, 147, 249)">SSE</span><span class="token plain"> connection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">     │        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │ ─────────────────────────────────►│        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │                                   │        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │  </span><span class="token number">2.</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">SSE</span><span class="token operator">:</span><span class="token plain"> session_id</span><span class="token operator">=</span><span class="token constant" style="color:rgb(189, 147, 249)">XXX</span><span class="token plain">           │        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │ ◄─────────────────────────────────│        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │                                   │        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │  </span><span class="token number">3.</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">POST</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">mcp</span><span class="token operator">/</span><span class="token plain">messages</span><span class="token operator">/</span><span class="token operator">?</span><span class="token plain">session_id│        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ </span><span class="token maybe-class-name">Client</span><span class="token plain"> │    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"initialize"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">         │ </span><span class="token maybe-class-name">Server</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │ ─────────────────────────────────►│        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │                                   │        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │  </span><span class="token number">4.</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">POST</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">mcp</span><span class="token operator">/</span><span class="token plain">messages</span><span class="token operator">/</span><span class="token operator">?</span><span class="token plain">session_id│        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"tools/call"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">    │        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │ ─────────────────────────────────►│        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │                                   │        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │  </span><span class="token number">5.</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">SSE</span><span class="token operator">:</span><span class="token plain"> streamed results         │        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│        │ ◄─────────────────────────────────│        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└────────┘                                   └────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This pattern allows for efficient, one-way streaming from server to client with a persistent
connection, ideal for AI-generated content.</p>
<h1>The Gap in the Python Ecosystem</h1>
<p>While FastAPI supports SSE and the MCP server implementation exists, there was a significant
gap:</p>
<ul>
<li>No dedicated Python client libraries for MCP over SSE</li>
<li>Challenges in maintaining session state across requests</li>
<li>Lack of examples showing proper error handling for stream interruptions</li>
<li>No standardized approach for processing the streamed events</li>
</ul>
<p>These gaps meant developers had to implement complex, error-prone boilerplate code to
interact with MCP servers.</p>
<h1>Introducing fastapi-mcp-client</h1>
<p>The fastapi-mcp-client library solves these problems with a clean, async-first API that
handles all the complexities of the MCP protocol:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> fastapi_mcp_client </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> MCPClient</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">main</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> MCPClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"http://localhost:8000"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Standard call - simple and clean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">call_operation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"echo"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"message"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Hello, MCP!"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Echo result: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Streaming call - same simple interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        stream </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">call_operation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"generate_numbers"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"count"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            stream</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> event </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> stream</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Event: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">asyncio</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">main</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The library takes care of:</p>
<ul>
<li>Establishing and maintaining the SSE connection</li>
<li>Session management</li>
<li>Protocol message formatting</li>
<li>Error handling</li>
<li>Processing streaming responses</li>
</ul>
<h1>Real-World Use Cases</h1>
<p>This client excels in several scenarios:</p>
<ol>
<li><strong>AI-Powered Chat Applications</strong>: Stream token-by-token responses directly to users</li>
<li><strong>Document Search Systems</strong>: Display search results as they're discovered</li>
<li><strong>Content Generation</strong>: Show incremental progress for long-running generation tasks</li>
<li><strong>Data Processing Pipelines</strong>: Stream processed chunks rather than waiting for full completion</li>
</ol>
<h1>Getting Started</h1>
<p>Installation is straightforward with either pip or uv:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Install with pip</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pip install fastapi-mcp-client</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Or with UV</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">uv add fastapi-mcp-client</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The repository includes example servers and clients to help you get started quickly.</p>
<p>Check out the <a href="https://github.com/RooseveltAdvisors/fastapi-mcp-client" target="_blank" rel="noopener noreferrer">GitHub repository</a> for more examples and documentation.</p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Python" term="Python"/>
        <category label="SSE" term="SSE"/>
        <category label="FastAPI" term="FastAPI"/>
        <category label="MCP" term="MCP"/>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Architecting Extensible AI Agents - A Modular Core with Pluggable Skills and SSE Communication]]></title>
        <id>https://jonroosevelt.com/blog/architecting-modular-ai-agents</id>
        <link href="https://jonroosevelt.com/blog/architecting-modular-ai-agents"/>
        <updated>2025-04-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Learn how to architect AI agent systems with a modular, skill-based approach and implement real-time communication using Server-Sent Events (SSE).]]></summary>
        <content type="html"><![CDATA[<p>Learn how to architect AI agent systems with a modular, skill-based approach and implement real-time communication using Server-Sent Events (SSE).</p>
<p><img decoding="async" loading="lazy" alt="Modular AI Agent Architecture" src="https://jonroosevelt.com/assets/images/modular-agents-header-236580a955f2c533f3ee3b655e339790.png" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<p>AI agents have become increasingly sophisticated, but their architecture often struggles to scale as complexity increases. Monolithic agent designs, where all capabilities are tightly coupled into a single codebase, become unwieldy as feature requirements expand. In this post, I'll share a modular approach to AI agent architecture that addresses these challenges by separating core orchestration logic from specialized "skills" and implementing efficient real-time communication using Server-Sent Events (SSE).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem-with-monolithic-agents">The Problem with Monolithic Agents<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#the-problem-with-monolithic-agents" class="hash-link" aria-label="Direct link to The Problem with Monolithic Agents" title="Direct link to The Problem with Monolithic Agents">​</a></h2>
<p>Before diving into the solution, let's understand why traditional monolithic agent designs become problematic:</p>
<ol>
<li><strong>Tight Coupling</strong>: When all capabilities are intertwined, changes to one feature risk breaking others.</li>
<li><strong>Poor Scalability</strong>: Both technical (codebase complexity) and team (developer coordination) scalability suffer.</li>
<li><strong>Limited Extensibility</strong>: Adding new capabilities often requires modifying core agent code.</li>
<li><strong>Deployment Challenges</strong>: The entire agent must be redeployed for any change, increasing downtime risk.</li>
<li><strong>Technology Lock-in</strong>: Using different technologies for different capabilities becomes difficult.</li>
</ol>
<p>As we developed more sophisticated AI agents with multiple capabilities, these limitations became increasingly apparent. We needed a better approach.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-modular-skill-based-architecture">A Modular, Skill-Based Architecture<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#a-modular-skill-based-architecture" class="hash-link" aria-label="Direct link to A Modular, Skill-Based Architecture" title="Direct link to A Modular, Skill-Based Architecture">​</a></h2>
<p>The solution is a modular architecture that separates concerns and enables independent development and deployment of agent capabilities. At its core, this architecture has three main components:</p>
<ol>
<li><strong>Agent Core</strong>: Handles orchestration, state management, and communication.</li>
<li><strong>Skills</strong>: Independent modules that implement specific capabilities.</li>
<li><strong>Communication Layer</strong>: Enables real-time interaction between the core and skills.</li>
</ol>
<p>Let's look at the implementation of each component:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-agent-core">The Agent Core<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#the-agent-core" class="hash-link" aria-label="Direct link to The Agent Core" title="Direct link to The Agent Core">​</a></h3>
<p>The agent core functions as a central hub, responsible for:</p>
<ul>
<li>Managing the overall agent state</li>
<li>Orchestrating skill execution</li>
<li>Handling user interactions</li>
<li>Providing a unified API for clients</li>
</ul>
<p>Here's a simplified implementation of the agent core:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">AgentCore</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">skills </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Registered skills</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)"># Agent state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">session_store </span><span class="token operator">=</span><span class="token plain"> SessionStore</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># For persisting sessions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">register_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> skill_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> skill_endpoint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Register a skill with the agent core."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">skills</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">skill_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> skill_endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Registered skill: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">skill_name</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> at </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">skill_endpoint</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">execute_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> skill_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> input_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Execute a specific skill and return results."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> skill_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">skills</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> SkillNotFoundError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Skill '</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">skill_name</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">' not registered"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        skill_endpoint </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">skills</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">skill_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Create SSE client to receive real-time updates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> SSEClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">skill_endpoint</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">/execute"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Send initial request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">send_request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Process SSE events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> event </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                event_data </span><span class="token operator">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                event_type </span><span class="token operator">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">event </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">or</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"update"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)"># Handle different event types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> event_type </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> event_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"data"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> event_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">elif</span><span class="token plain"> event_type </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"thinking"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"thinking"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"data"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> event_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">elif</span><span class="token plain"> event_type </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"result"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"last_result"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> event_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"result"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"data"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> event_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">elif</span><span class="token plain"> event_type </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"error"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"error"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"data"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> event_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"message"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">process_request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> user_request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Process a user request, determining which skill to use."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Determine appropriate skill based on request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        skill_name </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">determine_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Execute the skill and stream results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> update </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">execute_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">skill_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> user_request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">determine_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Determine which skill should handle a request."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># This could use LLM-based routing, rule-based matching, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Simplified implementation for demonstration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"translate"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"action"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"translation"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">elif</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"ground"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"action"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"grounding"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"default"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="skills-as-independent-services">Skills as Independent Services<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#skills-as-independent-services" class="hash-link" aria-label="Direct link to Skills as Independent Services" title="Direct link to Skills as Independent Services">​</a></h3>
<p>Skills are implemented as standalone services with their own API endpoints. Each skill:</p>
<ul>
<li>Has a well-defined interface for communication with the core</li>
<li>Manages its own dependencies and resources</li>
<li>Can be developed, tested, and deployed independently</li>
<li>Exposes an SSE endpoint for real-time updates</li>
</ul>
<p>Here's an example of a grounding skill that helps validate inputs against reliable sources:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">GroundingSkill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">llm_client </span><span class="token operator">=</span><span class="token plain"> LLMClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># LLM service client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search_client </span><span class="token operator">=</span><span class="token plain"> SearchClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Web search client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ground</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> statement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> search_results</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Ground a statement using search results or by performing a search."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Get search results if not provided</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> search_results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            search_results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search_client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">statement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Use LLM to evaluate statement against search results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        evaluation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">llm_client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">evaluate_grounding</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            statement</span><span class="token operator">=</span><span class="token plain">statement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sources</span><span class="token operator">=</span><span class="token plain">search_results</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"statement"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> statement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"is_grounded"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> evaluation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"is_grounded"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"confidence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> evaluation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"confidence"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"sources"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> evaluation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"relevant_sources"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"reasoning"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> evaluation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"reasoning"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">process_grounding_request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> sse_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Process a grounding request with SSE updates."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        statement </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"statement"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Send status update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> sse_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data</span><span class="token operator">=</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Searching for relevant information"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            event</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Perform search</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        search_results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search_client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">statement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Send thinking update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> sse_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data</span><span class="token operator">=</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Analyzing search results for relevant information"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            event</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"thinking"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Ground the statement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ground</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">statement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> search_results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Send final result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> sse_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data</span><span class="token operator">=</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            event</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"result"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This skill can be deployed as a separate microservice with FastAPI:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> fastapi </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> sse_starlette</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sse </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> EventSourceResponse</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">app </span><span class="token operator">=</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">grounding_skill </span><span class="token operator">=</span><span class="token plain"> GroundingSkill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@app</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">post</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"/execute"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">execute_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Execute the grounding skill with SSE updates."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    request_data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">event_generator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> grounding_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">process_grounding_request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SSEResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Send error event</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> SSEResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                data</span><span class="token operator">=</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"message"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                event</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"error"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> EventSourceResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">event_generator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SSEResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Helper class to send SSE events."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> event</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"event"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"data"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"data"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sse-for-real-time-communication">SSE for Real-Time Communication<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#sse-for-real-time-communication" class="hash-link" aria-label="Direct link to SSE for Real-Time Communication" title="Direct link to SSE for Real-Time Communication">​</a></h3>
<p>A critical aspect of this architecture is the real-time communication between the agent core and skills. We chose Server-Sent Events (SSE) over alternatives like WebSockets for several reasons:</p>
<ol>
<li><strong>Simplicity</strong>: SSE is simpler to implement than WebSockets, especially for one-way communication.</li>
<li><strong>HTTP-Based</strong>: SSE works over standard HTTP, making it easier to deploy and debug.</li>
<li><strong>Automatic Reconnection</strong>: Browsers handle reconnection for SSE automatically.</li>
<li><strong>Message Types</strong>: SSE supports named events, which helps organize different update types.</li>
</ol>
<p>Our implementation includes custom SSE classes for both client and server sides:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SSEClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Client for connecting to SSE endpoints and sending initial requests."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">url </span><span class="token operator">=</span><span class="token plain"> url</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">session </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__aenter__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">session </span><span class="token operator">=</span><span class="token plain"> aiohttp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ClientSession</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__aexit__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> exc_type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> exc_val</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> exc_tb</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">session</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">session</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">send_request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Send initial request to the SSE endpoint."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        headers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"Content-Type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"application/json"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"Accept"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"text/event-stream"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">session</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">post</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            json</span><span class="token operator">=</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            headers</span><span class="token operator">=</span><span class="token plain">headers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__aiter__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Iterate through SSE events."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Process the SSE stream</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin" style="color:rgb(189, 147, 249)">buffer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> line </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            line </span><span class="token operator">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'utf-8'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin" style="color:rgb(189, 147, 249)">buffer</span><span class="token plain"> </span><span class="token operator">+=</span><span class="token plain"> line</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">endswith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'\n\n'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                event </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_parse_event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin" style="color:rgb(189, 147, 249)">buffer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">_parse_event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Parse an SSE event from string data."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        lines </span><span class="token operator">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'\n'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        event_data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> line </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> lines</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">startswith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'data:'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                event_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'data'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">elif</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">startswith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'event:'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                event_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'event'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">elif</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">startswith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'id:'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                event_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'id'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> event_data </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'data'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> event_data </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token boolean">None</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-translation-skill-a-case-study">The Translation Skill: A Case Study<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#the-translation-skill-a-case-study" class="hash-link" aria-label="Direct link to The Translation Skill: A Case Study" title="Direct link to The Translation Skill: A Case Study">​</a></h2>
<p>Let's look at a complete example of another skill implementation - the translation skill:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">TranslationSkill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Skill for translating text between languages."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">llm_client </span><span class="token operator">=</span><span class="token plain"> LLMClient</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">supported_languages </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_load_supported_languages</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">_load_supported_languages</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Load supported language codes and names."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># In practice, this would load from a configuration file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"en"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"English"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"es"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Spanish"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"fr"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"French"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"de"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"German"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"zh"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Chinese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"ja"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Japanese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># ... more languages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">translate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> source_lang</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> target_lang</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Translate text from source language to target language."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Validate languages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> source_lang </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">supported_languages</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Unsupported source language: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">source_lang</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> target_lang </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">supported_languages</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Unsupported target language: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">target_lang</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Use LLM for translation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        prompt </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"""</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        Translate the following text from </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">supported_languages</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation">source_lang</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> to </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">supported_languages</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string-interpolation interpolation">target_lang</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">text</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        Provide only the translated text without any additional explanation.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">llm_client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">generate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"original_text"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"translated_text"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"source_language"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> source_lang</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"target_language"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> target_lang</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">process_translation_request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> sse_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Process a translation request with SSE updates."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        text </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"text"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        source_lang </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"source_lang"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"auto"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        target_lang </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"target_lang"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"en"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># If source language is auto, detect it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> source_lang </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"auto"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> sse_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                data</span><span class="token operator">=</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Detecting language"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                event</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            source_lang </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_detect_language</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Send status update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> sse_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data</span><span class="token operator">=</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Translating from </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">supported_languages</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation interpolation">source_lang</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string-interpolation interpolation"> source_lang</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> to </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">supported_languages</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation interpolation">target_lang</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string-interpolation interpolation"> target_lang</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            event</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Send thinking update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> sse_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data</span><span class="token operator">=</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Processing translation request..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            event</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"thinking"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Perform translation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">translate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> source_lang</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> target_lang</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Send final result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> sse_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data</span><span class="token operator">=</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            event</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"result"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">_detect_language</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Detect the language of the input text."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        prompt </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"""</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        Identify the language of the following text. Respond with only the ISO 639-1 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        language code (e.g., 'en' for English, 'es' for Spanish):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">text</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">llm_client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">generate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        detected_lang </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Default to English if detection fails</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> detected_lang </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">supported_languages</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"en"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> detected_lang</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-mcp-protocol">Integration with MCP Protocol<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#integration-with-mcp-protocol" class="hash-link" aria-label="Direct link to Integration with MCP Protocol" title="Direct link to Integration with MCP Protocol">​</a></h2>
<p>For our implementation, we integrated the skills with the MCP (Model Control Protocol) for consistent message formatting and handling. MCP provides a standardized way for models and agents to communicate with clients:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">MCPHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Handles MCP protocol formatting for SSE events."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@staticmethod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">format_thinking</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">thinking_text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Format thinking update in MCP format."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"thinking"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> thinking_text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"timestamp"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@staticmethod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">format_status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">status_text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Format status update in MCP format."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> status_text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"timestamp"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@staticmethod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">format_result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Format final result in MCP format."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"result"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> result_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"timestamp"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@staticmethod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">format_error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">error_message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Format error in MCP format."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"error"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"message"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> error_message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"timestamp"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="client-implementation">Client Implementation<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#client-implementation" class="hash-link" aria-label="Direct link to Client Implementation" title="Direct link to Client Implementation">​</a></h2>
<p>Clients can connect to the agent core and receive real-time updates through SSE:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Client-side JavaScript for connecting to the agent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">connectToAgent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">fetch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'/api/agent/process'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'POST'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'application/json'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string-property property">'Accept'</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'text/event-stream'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">body</span><span class="token operator">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">stringify</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> reader </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">getReader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> decoder </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">TextDecoder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Process the SSE stream</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> done</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> reader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">read</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">done</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> chunk </span><span class="token operator">=</span><span class="token plain"> decoder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">decode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> events </span><span class="token operator">=</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">split</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'\n\n'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token known-class-name class-name">Boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> eventText </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> eventData </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">parseSSEEvent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eventText</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eventData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'status'</span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">updateStatus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eventData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'thinking'</span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">updateThinking</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eventData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">content</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'result'</span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">displayResult</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eventData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'error'</span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">showError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">eventData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">parseSSEEvent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">eventText</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> lines </span><span class="token operator">=</span><span class="token plain"> eventText</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">split</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'\n'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> eventData </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> line </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">of</span><span class="token plain"> lines</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">startsWith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'event: '</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            eventData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">substring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">startsWith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'data: '</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            eventData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">data</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">parse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">substring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> eventData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-and-scaling">Deployment and Scaling<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#deployment-and-scaling" class="hash-link" aria-label="Direct link to Deployment and Scaling" title="Direct link to Deployment and Scaling">​</a></h2>
<p>This modular architecture simplifies deployment and scaling. Each component can be deployed independently:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Example docker-compose.yml for deploying the system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'3'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">agent-core</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ./agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">core</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"8080:8080"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> GROUNDING_SKILL_URL=http</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//grounding</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> TRANSLATION_SKILL_URL=http</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//translation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">8082</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> grounding</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">skill</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> translation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">skill</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">grounding-skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ./grounding</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">skill</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"8081:8081"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> OPENAI_API_KEY=$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">OPENAI_API_KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">translation-skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ./translation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">skill</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"8082:8082"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> OPENAI_API_KEY=$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">OPENAI_API_KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">agent-network</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">driver</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> bridge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For Kubernetes deployment, we use Helm charts to manage the deployment of each component:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Simplified Helm values.yaml example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">replicaCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">agentCore</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">groundingSkill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">translationSkill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">images</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">repository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">agentCore</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">core</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">groundingSkill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> grounding</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">skill</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">translationSkill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> translation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">skill</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">pullPolicy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="benefits-of-this-architecture">Benefits of this Architecture<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#benefits-of-this-architecture" class="hash-link" aria-label="Direct link to Benefits of this Architecture" title="Direct link to Benefits of this Architecture">​</a></h2>
<p>This modular architecture with SSE communication provides numerous benefits:</p>
<ol>
<li><strong>Independent Development</strong>: Teams can work on different skills without affecting each other.</li>
<li><strong>Flexible Scaling</strong>: Each skill can be scaled independently based on usage patterns.</li>
<li><strong>Technology Flexibility</strong>: Different skills can use different technologies or languages as needed.</li>
<li><strong>Incremental Deployment</strong>: New skills can be added without redeploying the entire system.</li>
<li><strong>Enhanced Resilience</strong>: Failures in one skill don't affect the entire system.</li>
<li><strong>Real-Time Updates</strong>: SSE provides efficient streaming of updates to clients.</li>
<li><strong>Simplified Testing</strong>: Skills can be tested in isolation with mock dependencies.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="challenges-and-considerations">Challenges and Considerations<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#challenges-and-considerations" class="hash-link" aria-label="Direct link to Challenges and Considerations" title="Direct link to Challenges and Considerations">​</a></h2>
<p>While this architecture offers significant advantages, there are challenges to consider:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-increased-operational-complexity">1. Increased Operational Complexity<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#1-increased-operational-complexity" class="hash-link" aria-label="Direct link to 1. Increased Operational Complexity" title="Direct link to 1. Increased Operational Complexity">​</a></h3>
<p>Managing multiple services instead of a monolith increases operational complexity. We addressed this with:</p>
<ul>
<li>Comprehensive monitoring and logging</li>
<li>Automated deployment pipelines</li>
<li>Service discovery mechanisms</li>
<li>Centralized configuration management</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-consistency-across-skills">2. Consistency Across Skills<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#2-consistency-across-skills" class="hash-link" aria-label="Direct link to 2. Consistency Across Skills" title="Direct link to 2. Consistency Across Skills">​</a></h3>
<p>Ensuring consistent behavior across independently developed skills requires:</p>
<ul>
<li>Clear interface definitions</li>
<li>Shared utilities for common functions</li>
<li>Style guides and code standards</li>
<li>Regular cross-team reviews</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-error-handling">3. Error Handling<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#3-error-handling" class="hash-link" aria-label="Direct link to 3. Error Handling" title="Direct link to 3. Error Handling">​</a></h3>
<p>Distributed systems need robust error handling:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Example of error handling in the agent core</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">execute_skill_with_fallback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> primary_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> fallback_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> input_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Execute a skill with fallback if it fails."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> update </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">execute_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">primary_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> input_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> SkillExecutionError </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Primary skill </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">primary_skill</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> failed: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation builtin" style="color:rgb(189, 147, 249)">str</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Falling back to </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">fallback_skill</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Notify the client of the fallback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"data"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"status"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Falling back to alternative approach"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Execute fallback skill</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> update </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">execute_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">fallback_skill</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> input_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-state-management">4. State Management<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#4-state-management" class="hash-link" aria-label="Direct link to 4. State Management" title="Direct link to 4. State Management">​</a></h3>
<p>Handling state across distributed components requires careful design:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SharedStateManager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Manages shared state across skills."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> redis_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">redis </span><span class="token operator">=</span><span class="token plain"> aioredis</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">from_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">redis_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">set_state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> session_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ttl</span><span class="token operator">=</span><span class="token number">3600</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Set a state value with expiration."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        state_key </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"session:</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">session_id</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">:</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">key</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">redis</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ex</span><span class="token operator">=</span><span class="token plain">ttl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> session_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Get a state value."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        state_key </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"session:</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">session_id</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">:</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">key</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        value </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">redis</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">state_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> value </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token boolean">None</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-and-monitoring">Performance and Monitoring<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#performance-and-monitoring" class="hash-link" aria-label="Direct link to Performance and Monitoring" title="Direct link to Performance and Monitoring">​</a></h2>
<p>With distributed components communicating via SSE, monitoring performance becomes crucial:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Example monitoring middleware for FastAPI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@app</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">middleware</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"http"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">add_performance_monitoring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> call_next</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start_time </span><span class="token operator">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Track request by type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    metrics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">increment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"requests.</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">request</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">path</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Execute the request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> call_next</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Record duration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    duration </span><span class="token operator">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> start_time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    metrics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">timing</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"request_duration.</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">request</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">path</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Track response codes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    metrics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">increment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"responses.</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">response</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">status_code</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> response</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://jonroosevelt.com/blog/architecting-modular-ai-agents#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>The modular AI agent architecture with pluggable skills and SSE communication provides a scalable, flexible approach to building complex AI systems. By separating the core orchestration logic from specialized capabilities, we've created a system that can evolve more gracefully over time.</p>
<p>This architecture has enabled us to:</p>
<ol>
<li><strong>Scale development across multiple teams</strong></li>
<li><strong>Add new capabilities without disrupting existing ones</strong></li>
<li><strong>Provide real-time feedback to users during processing</strong></li>
<li><strong>Deploy and scale components independently</strong></li>
<li><strong>Choose the right technologies for each specific skill</strong></li>
</ol>
<p>While it introduces some additional complexity in terms of deployment and communication, the benefits far outweigh the costs for sophisticated AI agent systems with diverse capabilities.</p>
<p>The combination of a strong orchestration core, independently deployable skills, and efficient SSE communication creates a foundation that can support increasingly advanced AI applications as they evolve.</p>
<p>For teams building complex AI agents, we strongly recommend considering this modular, skill-based approach with real-time communication to create systems that can grow and adapt to changing requirements.</p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="AI Agents" term="AI Agents"/>
        <category label="Microservices" term="Microservices"/>
        <category label="SSE" term="SSE"/>
        <category label="Architecture" term="Architecture"/>
        <category label="Modular Design" term="Modular Design"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building Reliable AI Agents - Implementing Advanced Evaluation with Azure AI SDK and Custom APIM Integration]]></title>
        <id>https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration</id>
        <link href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration"/>
        <updated>2025-04-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Learn how to implement robust evaluation for AI agents using Azure AI Evaluation SDK when working with Azure API Management (APIM), overcoming authentication and integration challenges.]]></summary>
        <content type="html"><![CDATA[<p>Learn how to implement robust evaluation for AI agents using Azure AI Evaluation SDK when working with Azure API Management (APIM), overcoming authentication and integration challenges.</p>
<p><img decoding="async" loading="lazy" alt="Azure AI Evaluation with APIM" src="https://jonroosevelt.com/assets/images/azure-eval-header-4e62e43c21a3dc455f6b62ad56034085.png" width="2752" height="1536" class="img_ev3q"></p>
<!-- -->
<p>In enterprise environments, evaluating the performance of AI agents is crucial for ensuring quality, reliability, and compliance. Microsoft's Azure AI Evaluation SDK provides powerful tools for this purpose—but what happens when your AI services are accessed through Azure API Management (APIM) with custom authentication requirements? This post details our journey implementing a robust evaluation system for an AI research agent deployed behind APIM, sharing solutions to challenges that aren't covered in the standard documentation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-evaluation-challenge-beyond-standard-setups">The Evaluation Challenge: Beyond Standard Setups<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#the-evaluation-challenge-beyond-standard-setups" class="hash-link" aria-label="Direct link to The Evaluation Challenge: Beyond Standard Setups" title="Direct link to The Evaluation Challenge: Beyond Standard Setups">​</a></h2>
<p>While Azure AI Evaluation SDK works seamlessly with direct Azure OpenAI endpoints, enterprise deployments often route API calls through Azure API Management (APIM) to:</p>
<ol>
<li><strong>Enforce Security Policies</strong>: Custom authentication, rate limiting, IP filtering</li>
<li><strong>Add Business Logic</strong>: Request transformation, logging, monitoring</li>
<li><strong>Manage Multiple Services</strong>: Unified access point across various AI services</li>
</ol>
<p>This architectural choice creates significant challenges when trying to use standard evaluation tools:</p>
<!-- -->
<p>Our research agent required evaluation across multiple metrics, including:</p>
<ul>
<li>Groundedness (factual accuracy)</li>
<li>Answer relevancy</li>
<li>Contextual precision and recall</li>
<li>Faithfulness to sources</li>
<li>Fluency and coherence</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-apim-roadblock">The APIM Roadblock<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#the-apim-roadblock" class="hash-link" aria-label="Direct link to The APIM Roadblock" title="Direct link to The APIM Roadblock">​</a></h2>
<p>The standard evaluators from Azure AI Evaluation SDK failed when pointed at our APIM endpoint due to:</p>
<ol>
<li><strong>Authentication Failure</strong>: Azure AD token authentication wasn't being properly passed through</li>
<li><strong>Missing Headers</strong>: Required custom headers (<code>mkl-User-name</code>, <code>username</code>) weren't included</li>
<li><strong>Incompatible Response Handling</strong>: APIM response transformations broke evaluator expectations</li>
</ol>
<p>Here's what a typical failure looked like:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Standard approach - fails with APIM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">evaluators </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"groundedness"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> GroundednessEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"relevance"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> RelevanceEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">results </span><span class="token operator">=</span><span class="token plain"> evaluate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    evaluators</span><span class="token operator">=</span><span class="token plain">evaluators</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    target_function</span><span class="token operator">=</span><span class="token plain">run_research_agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    test_cases</span><span class="token operator">=</span><span class="token plain">test_scenarios</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Even when providing correct APIM URL, it fails with auth errors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    azure_endpoint</span><span class="token operator">=</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"AZURE_APIM_URI"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This would consistently result in <code>401 Unauthorized</code> or <code>403 Forbidden</code> errors, even when environment variables for authentication were correctly set.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution-part-1-custom-apim-aware-evaluators">Solution Part 1: Custom APIM-Aware Evaluators<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#solution-part-1-custom-apim-aware-evaluators" class="hash-link" aria-label="Direct link to Solution Part 1: Custom APIM-Aware Evaluators" title="Direct link to Solution Part 1: Custom APIM-Aware Evaluators">​</a></h2>
<p>Our first step was to create custom evaluator classes that could handle the APIM authentication and header requirements:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">APIMEvaluatorBase</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Base class for custom APIM-compatible evaluators."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> metric_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> apim_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_metric_name </span><span class="token operator">=</span><span class="token plain"> metric_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config </span><span class="token operator">=</span><span class="token plain"> apim_config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Get OpenAI client with proper auth for APIM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">client </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_create_apim_client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">_create_apim_client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Get Azure AD token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        credential </span><span class="token operator">=</span><span class="token plain"> DefaultAzureCredential</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        token </span><span class="token operator">=</span><span class="token plain"> credential</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"https://cognitiveservices.azure.com/.default"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Create client with custom headers for APIM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        client </span><span class="token operator">=</span><span class="token plain"> AzureOpenAI</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            azure_endpoint</span><span class="token operator">=</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">endpoint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            api_version</span><span class="token operator">=</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">api_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            api_key</span><span class="token operator">=</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Using token as API key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Add required APIM headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        headers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"mkl-User-name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">username</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"username"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">username</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Apply headers to all requests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        client </span><span class="token operator">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">with_additional_headers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__call__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Evaluate with our APIM-aware client."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Implementation depends on specific metric</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> NotImplementedError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We then created specific subclasses for each evaluation metric:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">APIMGroundednessEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">APIMEvaluatorBase</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Evaluates groundedness using APIM-compatible client."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    _metric_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"groundedness"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> apim_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin" style="color:rgb(189, 147, 249)">super</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_metric_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> apim_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__call__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">        Evaluates if the response is grounded in the provided context.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        prompt </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"""</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        You are evaluating the factual accuracy of an AI assistant's response.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        Query: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">query</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        Context (ground truth):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">context</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        Response to evaluate:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">response</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        Evaluate whether the response contains only information that is present in the context.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        Score from 0-5, where:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        0: Completely ungrounded, containing major hallucinations</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        1: Mostly ungrounded with several inaccuracies</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        2: Partially grounded, but with notable inaccuracies</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        3: Mostly grounded with minor inaccuracies</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        4: Almost completely grounded, with very minor inaccuracies</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        5: Completely grounded, only containing information from the context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        Format your response as a JSON object with the following keys:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        - score: The numerical score (0-5)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        - reasoning: Your step-by-step evaluation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Call Azure OpenAI via APIM with our authenticated client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            response </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                model</span><span class="token operator">=</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">deployment_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                messages</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"role"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"user"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"content"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> prompt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                temperature</span><span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                response_format</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"type"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"json_object"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Parse JSON response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            content </span><span class="token operator">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">content</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            result </span><span class="token operator">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Return properly formatted result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"score"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"score"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"reasoning"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"reasoning"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Error evaluating groundedness: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">"score"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"reasoning"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Evaluation failed: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation builtin" style="color:rgb(189, 147, 249)">str</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We implemented similar classes for the other metrics: <code>APIMRelevanceEvaluator</code>, <code>APIMContextualPrecisionEvaluator</code>, etc.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution-part-2-the-manual-evaluation-loop">Solution Part 2: The Manual Evaluation Loop<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#solution-part-2-the-manual-evaluation-loop" class="hash-link" aria-label="Direct link to Solution Part 2: The Manual Evaluation Loop" title="Direct link to Solution Part 2: The Manual Evaluation Loop">​</a></h2>
<p>While our custom evaluators solved the authentication and header issues, we encountered an unexpected problem when trying to use them with the SDK's <code>evaluate()</code> function. Even though our individual evaluators worked correctly, the evaluation framework couldn't properly aggregate their results.</p>
<p>After extensive debugging, we found that the SDK's <code>evaluate()</code> function has limitations when handling custom evaluators that use direct API calls with custom authentication. The inner workings of the function assume certain behavior that our APIM-aware evaluators couldn't satisfy.</p>
<p>Our solution was to implement a manual evaluation loop:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">run_manual_evaluation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">test_scenarios</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> apim_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Run evaluation manually with custom APIM-aware evaluators."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Initialize our custom evaluators</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    evaluators </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"groundedness"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> APIMGroundednessEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">apim_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"relevance"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> APIMRelevanceEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">apim_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"contextual_precision"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> APIMContextualPrecisionEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">apim_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"faithfulness"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> APIMFaithfulnessEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">apim_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"fluency"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> APIMFluencyEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">apim_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Define threshold for each metric</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    thresholds </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"groundedness"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">3.5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"relevance"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">3.5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"contextual_precision"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">3.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"faithfulness"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">3.5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"fluency"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">3.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Store results for each scenario and metric</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    all_results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Process each test scenario</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> scenario </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> test_scenarios</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Run the agent to get a response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        agent_response </span><span class="token operator">=</span><span class="token plain"> run_research_agent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            query</span><span class="token operator">=</span><span class="token plain">scenario</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            additional_context</span><span class="token operator">=</span><span class="token plain">scenario</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"additional_context"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Evaluate with each metric</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        scenario_results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> scenario</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"response"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> agent_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"metrics"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> metric_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> evaluator </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> evaluators</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">items</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Skip metrics not required for this scenario</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> metric_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> scenario</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"evaluation_metrics"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">list</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">evaluators</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">keys</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Run evaluation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            result </span><span class="token operator">=</span><span class="token plain"> evaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                response</span><span class="token operator">=</span><span class="token plain">agent_response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                context</span><span class="token operator">=</span><span class="token plain">scenario</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"context"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                query</span><span class="token operator">=</span><span class="token plain">scenario</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Store result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            scenario_results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"metrics"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">metric_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"score"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"score"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"reasoning"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"reasoning"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"threshold"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> thresholds</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">metric_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"pass"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"score"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">&gt;=</span><span class="token plain"> thresholds</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">metric_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        all_results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">scenario_results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Calculate overall metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    summary </span><span class="token operator">=</span><span class="token plain"> calculate_evaluation_summary</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">all_results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> thresholds</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Save results to file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    save_evaluation_results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">all_results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> summary</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> all_results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> summary</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This manual approach gave us complete control over the evaluation process, while still using the custom evaluators we created to interface with APIM.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-metrics-in-practice">Key Metrics in Practice<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#key-metrics-in-practice" class="hash-link" aria-label="Direct link to Key Metrics in Practice" title="Direct link to Key Metrics in Practice">​</a></h2>
<p>Let's look at how some of the key metrics worked in real-world evaluation of our research agent:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="groundedness-evaluation">Groundedness Evaluation<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#groundedness-evaluation" class="hash-link" aria-label="Direct link to Groundedness Evaluation" title="Direct link to Groundedness Evaluation">​</a></h3>
<p>Groundedness measures whether the AI's response contains information that's supported by the provided context:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Example scenario with groundedness evaluation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">scenario </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"What are the main environmental risks for offshore drilling?"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"context"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> "Offshore drilling poses several environmental risks including</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               oil spills that can damage marine ecosystems</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               disruption of marine habitats during drilling</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               underwater noise pollution affecting marine mammals</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> greenhouse gas emissions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> flaring operations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"evaluation_metrics"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"groundedness"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"relevance"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Agent response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">response </span><span class="token operator">=</span><span class="token plain"> "Offshore drilling presents significant environmental concerns</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            The primary risks include catastrophic oil spills that damage marine ecosystems</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            physical disruption of seafloor habitats during drilling operations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            noise pollution that can disorient </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> harm marine mammals like whales </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> dolphins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> substantial greenhouse gas emissions </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> gas flaring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Evaluator assessment (simplified)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"score"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">5.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Perfect score - all information is grounded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"reasoning"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> "The response accurately reflects </span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token plain"> environmental risks mentioned </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> the context without adding unsupported claims</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="relevance-evaluation">Relevance Evaluation<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#relevance-evaluation" class="hash-link" aria-label="Direct link to Relevance Evaluation" title="Direct link to Relevance Evaluation">​</a></h3>
<p>Relevance assesses how well the response addresses the specific query:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Example with lower relevance score</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">scenario </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"What regulations govern offshore drilling safety?"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"context"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> "Offshore drilling </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token plain"> regulated by several frameworks including </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               the BSEE regulations </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> the US</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> which mandate safety equipment like blowout preventers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               The SEMS rule requires safety management systems</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               International operations often follow IMO guidelines </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> regional regulations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Less relevant response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">response </span><span class="token operator">=</span><span class="token plain"> "Offshore drilling has strict regulations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> Companies must follow </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            environmental protection standards </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> obtain permits before drilling</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Environmental impact assessments are required </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> many jurisdictions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Evaluator assessment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"score"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">2.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Low score - response doesn't address safety regulations specifically</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">"reasoning"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> "The response discusses regulations but focuses on environmental permits</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 rather than the safety regulations mentioned </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> the context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 It doesn't address BSEE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SEMS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">or</span><span class="token plain"> IMO guidelines specifically asked about </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> the query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-insights">Implementation Insights<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#implementation-insights" class="hash-link" aria-label="Direct link to Implementation Insights" title="Direct link to Implementation Insights">​</a></h2>
<p>During our implementation, we discovered several important insights:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-typeddict-for-response-typing">1. TypedDict for Response Typing<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#1-typeddict-for-response-typing" class="hash-link" aria-label="Direct link to 1. TypedDict for Response Typing" title="Direct link to 1. TypedDict for Response Typing">​</a></h3>
<p>Azure AI Evaluation expects specific return types from evaluator <code>__call__</code> methods. Using Python's <code>TypedDict</code> ensures compatibility:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> TypedDict</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Dict</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">GroundednessResult</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    score</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">float</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reasoning</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">APIMGroundednessEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">APIMEvaluatorBase</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__call__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> GroundednessResult</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-error-handling-for-api-stability">2. Error Handling for API Stability<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#2-error-handling-for-api-stability" class="hash-link" aria-label="Direct link to 2. Error Handling for API Stability" title="Direct link to 2. Error Handling for API Stability">​</a></h3>
<p>Our APIM calls occasionally encountered timeout or transient errors. Adding robust error handling improved stability:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">safe_api_call</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> max_retries</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Make API call with retry logic."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> attempt </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">max_retries</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">APITimeoutError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ServiceUnavailableError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> attempt </span><span class="token operator">==</span><span class="token plain"> max_retries </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">**</span><span class="token plain"> attempt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># Exponential backoff</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-caching-for-performance">3. Caching for Performance<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#3-caching-for-performance" class="hash-link" aria-label="Direct link to 3. Caching for Performance" title="Direct link to 3. Caching for Performance">​</a></h3>
<p>Evaluation can be time-consuming and expensive. We implemented caching to avoid redundant API calls:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">CachingEvaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Wrapper for evaluators that caches results."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> evaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cache_file</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">evaluator </span><span class="token operator">=</span><span class="token plain"> evaluator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cache_file </span><span class="token operator">=</span><span class="token plain"> cache_file </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">or</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation builtin" style="color:rgb(189, 147, 249)">type</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation interpolation">evaluator</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">__name__</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">_cache.json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cache </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_load_cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">_load_cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cache_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cache_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'r'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">_save_cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cache_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'w'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__call__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Create cache key from inputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        key </span><span class="token operator">=</span><span class="token plain"> hashlib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">md5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">query</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">|</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">context</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">|</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">response</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">hexdigest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> key </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Call underlying evaluator</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        result </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">evaluator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Cache result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_save_cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> result</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lessons-learned-and-recommendations">Lessons Learned and Recommendations<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#lessons-learned-and-recommendations" class="hash-link" aria-label="Direct link to Lessons Learned and Recommendations" title="Direct link to Lessons Learned and Recommendations">​</a></h2>
<p>Based on our experience, here are key recommendations for implementing evaluation with APIM:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-microsoft">For Microsoft<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#for-microsoft" class="hash-link" aria-label="Direct link to For Microsoft" title="Direct link to For Microsoft">​</a></h3>
<ol>
<li><strong>Better APIM Documentation</strong>: Add specific guidance for using evaluation tools with APIM-protected endpoints.</li>
<li><strong>Authentication Flexibility</strong>: Enhance the SDK to support Azure AD token auth and custom headers.</li>
<li><strong>Extension Points</strong>: Provide clearer hooks for extending evaluators with custom authentication.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-developers">For Developers<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#for-developers" class="hash-link" aria-label="Direct link to For Developers" title="Direct link to For Developers">​</a></h3>
<ol>
<li><strong>Start Simple</strong>: Test individual evaluator classes before attempting to use the full evaluate() framework.</li>
<li><strong>Error Logging</strong>: Implement verbose logging for evaluation failures to identify auth/header issues.</li>
<li><strong>Manual Control</strong>: Don't hesitate to implement your own evaluation loop for complex scenarios.</li>
<li><strong>Test Environment</strong>: Create a test environment without APIM to validate evaluation logic before adding APIM complexity.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-evaluation-results">Example Evaluation Results<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#example-evaluation-results" class="hash-link" aria-label="Direct link to Example Evaluation Results" title="Direct link to Example Evaluation Results">​</a></h2>
<p>We ran our custom evaluation system against a research agent tasked with investigating various companies. Here's a sample of the results:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"summary"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"groundedness"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"average_score"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4.7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"pass_rate"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0.95</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"threshold"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"relevance"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"average_score"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4.5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"pass_rate"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0.92</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"threshold"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"contextual_precision"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"average_score"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4.2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"pass_rate"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0.89</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"threshold"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"faithfulness"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"average_score"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4.6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"pass_rate"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0.94</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"threshold"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"fluency"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"average_score"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4.8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"pass_rate"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0.98</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">"threshold"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"overall_pass_rate"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0.91</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These results helped identify weaknesses in our agent and guided improvements to the prompts, retrieval strategies, and overall system design.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://jonroosevelt.com/blog/azure-ai-evaluation-apim-integration#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Implementing advanced evaluation for AI agents in an enterprise environment with APIM presents unique challenges, but the effort is worthwhile. Our custom APIM-aware evaluators and manual evaluation loop provided comprehensive quality assessment capabilities while working within the constraints of our enterprise architecture.</p>
<p>By sharing our approach, challenges, and solutions, we hope to help others implement robust evaluation systems for their AI agents, even when the standard tools don't fit perfectly with their enterprise architecture.</p>
<p>The quality of AI systems depends not just on their capabilities, but on our ability to reliably measure their performance. With the right evaluation approach, we can build AI agents that are not only powerful but trustworthy and reliable in enterprise contexts.</p>]]></content>
        <author>
            <name>Jon Roosevelt</name>
            <uri>https://jonroosevelt.com</uri>
        </author>
        <category label="Azure" term="Azure"/>
        <category label="OpenAI" term="OpenAI"/>
        <category label="Evaluation" term="Evaluation"/>
        <category label="APIM" term="APIM"/>
        <category label="LLM" term="LLM"/>
        <category label="Testing" term="Testing"/>
    </entry>
</feed>